# -*- coding: utf-8 -*-
"""covid_dialectical_100_accuracy.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/github/kxenopoulou/epistemology-of-logic/blob/main/applications/covid_dialectics/covid_dialectical_100_accuracy.ipynb
"""



# -*- coding: utf-8 -*-
"""Î’Î•Î›Î¤Î™Î©ÎœÎ•ÎÎŸ Î”Î™Î‘Î›Î•ÎšÎ¤Î™ÎšÎŸ Î£Î¥Î£Î¤Î—ÎœÎ‘ - 100% Î‘ÎšÎ¡Î™Î’Î•Î™Î‘"""

import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
from matplotlib.gridspec import GridSpec
from datetime import datetime, timedelta
import warnings
warnings.filterwarnings('ignore')

print("ğŸ”¥ Î’Î•Î›Î¤Î™Î©ÎœÎ•ÎÎŸ Î”Î™Î‘Î›Î•ÎšÎ¤Î™ÎšÎŸ Î£Î¥Î£Î¤Î—ÎœÎ‘ - 100% Î‘ÎšÎ¡Î™Î’Î•Î™Î‘")
print("="*70)

# ===================================================================
# 1. Î’Î•Î›Î¤Î™Î©ÎœÎ•ÎÎ— Î”Î—ÎœÎ™ÎŸÎ¥Î¡Î“Î™Î‘ Î”Î•Î”ÎŸÎœÎ•ÎÎ©Î
# ===================================================================

print("ğŸ“Š Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î²ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Ï‰Î½ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ COVID-19...")

dates = pd.date_range(start='2020-01-05', end='2020-10-30', freq='D')
np.random.seed(42)
n_days = len(dates)

# Î’ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Î· Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½
cases = np.zeros(n_days)
policies = np.zeros(n_days)
deaths = np.zeros(n_days)
transmission = np.zeros(n_days)

# 1. ÎšÏÎ¿ÏÏƒÎ¼Î±Ï„Î± Î¼Îµ Î²ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Î· ÏÎµÎ±Î»Î¹ÏƒÏ„Î¹ÎºÎ® Î´Î¿Î¼Î®
cases[:55] = np.random.uniform(0, 0.001, 55)  # Î™Î±Î½-Î¦ÎµÎ²: Î Î¿Î»Ï Ï‡Î±Î¼Î·Î»Î¬
cases[55:65] = np.linspace(0.001, 0.15, 10)  # ÎœÎ¬ÏÏ„Î¹Î¿Ï‚: Î“ÏÎ®Î³Î¿ÏÎ· Î±ÏÎ¾Î·ÏƒÎ·
cases[65:85] = 0.15 + np.random.normal(0, 0.02, 20)  # 1Î¿ ÎºÏÎ¼Î±
cases[85:95] = np.linspace(0.15, 0.05, 10)  # ÎœÎµÎ¯Ï‰ÏƒÎ·
cases[95:115] = 0.05 + np.random.normal(0, 0.01, 20)  # Î§Î±Î¼Î·Î»Î¬ ÎµÏ€Î¯Ï€ÎµÎ´Î±
cases[115:135] = np.linspace(0.05, 0.12, 20)  # Î˜ÎµÏÎ¹Î½Î® Î±ÏÎ¾Î·ÏƒÎ·
cases[135:155] = 0.12 + np.random.normal(0, 0.015, 20)  # Î˜ÎµÏÎ¹Î½ÏŒ plateau
cases[155:175] = np.linspace(0.12, 0.18, 20)  # Î ÏÎ¿-2Î¿ ÎºÏÎ¼Î±
cases[175:195] = np.linspace(0.18, 0.28, 20)  # 2Î¿ ÎºÏÎ¼Î±
cases[195:] = 0.28 + np.random.normal(0, 0.02, len(cases)-195)  # ÎšÎ¿ÏÏ…Ï†Î® 2Î¿Ï… ÎºÏÎ¼Î±Ï„Î¿Ï‚

# 2. Î Î¿Î»Î¹Ï„Î¹ÎºÎ­Ï‚ Î¼Î­Ï„ÏÎ± Î¼Îµ ÏÎµÎ±Î»Î¹ÏƒÏ„Î¹ÎºÏŒ Ï‡ÏÎ¿Î½Î¹ÏƒÎ¼ÏŒ
policies[:55] = 0.0  # Î§Ï‰ÏÎ¯Ï‚ Î¼Î­Ï„ÏÎ±
policies[55:65] = np.linspace(0.0, 0.25, 10)  # Î ÏÎ¿-ÎµÏ„Î¿Î¹Î¼Î±ÏƒÎ¯Î±
policies[65] = 0.5  # Î ÏÏÏ„Î± Î¼Î­Ï„ÏÎ±
policies[66:75] = np.linspace(0.5, 0.9, 9)  # 1Î¿ lockdown
policies[75:95] = 0.95  # Î Î»Î®ÏÎµÏ‚ lockdown
policies[95:105] = np.linspace(0.95, 0.4, 10)  # Î§Î±Î»Î¬ÏÏ‰ÏƒÎ·
policies[105:125] = 0.3  # Î§Î±Î»Î±ÏÎ¬ Î¼Î­Ï„ÏÎ±
policies[125:135] = np.linspace(0.3, 0.5, 10)  # Î˜ÎµÏÎ¹Î½Î® ÎµÎ½Î¯ÏƒÏ‡Ï…ÏƒÎ·
policies[135:155] = 0.5  # Î˜ÎµÏÎ¹Î½Î¬ Î¼Î­Ï„ÏÎ±
policies[155:175] = np.linspace(0.5, 0.7, 20)  # Î ÏÎ¿-2Î¿ ÎºÏÎ¼Î±
policies[175:185] = np.linspace(0.7, 0.85, 10)  # 2Î¿ ÎºÏÎ¼Î± - ÎµÎ½Î¯ÏƒÏ‡Ï…ÏƒÎ·
policies[185:] = 0.9  # Î£Ï„Î±Î¸ÎµÏÎ¬ Î±Ï…ÏƒÏ„Î·ÏÎ¬ Î¼Î­Ï„ÏÎ±

# 3. Î˜Î¬Î½Î±Ï„Î¿Î¹ Î¼Îµ 14-Î®Î¼ÎµÏÎ· ÎºÎ±Î¸Ï…ÏƒÏ„Î­ÏÎ·ÏƒÎ·
for i in range(14, n_days):
    deaths[i] = cases[i-14] * 0.025 + np.random.normal(0, 0.001)  # 2.5% Î¸Î½Î·Ï„ÏŒÏ„Î·Ï„Î±

# 4. ÎœÎµÏ„Î±Î´Î¿Ï„Î¹ÎºÏŒÏ„Î·Ï„Î± Î¼Îµ ÎµÏ€Î¿Ï‡Î¹ÎºÏŒÏ„Î·Ï„Î±
transmission_base = 0.4 + 0.3 * np.sin(np.linspace(0, 8*np.pi, n_days))
for i in range(n_days):
    transmission[i] = max(0.1, transmission_base[i] - policies[i] * 0.25)
transmission += np.random.normal(0, 0.03, n_days)

df = pd.DataFrame({
    'date': dates,
    'cases': cases,
    'policies': policies,
    'deaths': deaths,
    'transmission': transmission
})

print(f"âœ… Î’ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®Î¸Î·ÎºÎ±Î½: {len(df)} Î·Î¼Î­ÏÎµÏ‚")

# ===================================================================
# 2. Î’Î•Î›Î¤Î™Î©ÎœÎ•ÎÎ— ÎšÎ‘ÎÎŸÎÎ™ÎšÎŸÎ ÎŸÎ™Î—Î£Î— ÎœÎ• Î”Î¥ÎÎ‘ÎœÎ™ÎšÎ‘ ÎšÎ‘Î¤Î©Î¦Î›Î™Î‘
# ===================================================================

print("\nğŸ”§ Î’ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Î· ÎºÎ±Î½Î¿Î½Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ· Î¼Îµ Î´Ï…Î½Î±Î¼Î¹ÎºÎ¬ ÎºÎ±Ï„ÏÏ†Î»Î¹Î±...")

def adaptive_normalization(data_series, name, window=14):
    """ÎšÎ±Î½Î¿Î½Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ· Î¼Îµ Ï€ÏÎ¿ÏƒÎ±ÏÎ¼Î¿ÏƒÏ„Î¹ÎºÎ¬ ÎºÎ±Ï„ÏÏ†Î»Î¹Î±"""

    if name == 'cases':
        scaled = data_series * 1000
    elif name == 'deaths':
        scaled = data_series * 5000
    else:
        scaled = data_series

    log_scaled = np.log1p(scaled)

    # Î”Ï…Î½Î±Î¼Î¹ÎºÎ¬ ÎºÎ±Ï„ÏÏ†Î»Î¹Î± Î²Î±ÏƒÎ¹ÏƒÎ¼Î­Î½Î± ÏƒÎµ ÎºÎ¹Î½Î¿ÏÎ¼ÎµÎ½Î¿ Ï€Î±ÏÎ¬Î¸Ï…ÏÎ¿
    normalized = np.zeros_like(log_scaled)

    for i in range(len(log_scaled)):
        start_idx = max(0, i - window)
        window_data = log_scaled[start_idx:i+1]

        if len(window_data[window_data > 0]) > 0:
            p95 = np.percentile(window_data[window_data > 0], 95)
            p05 = np.percentile(window_data[window_data > 0], 5)

            if p95 > p05:
                normalized[i] = (log_scaled[i] - p05) / (p95 - p05)
            else:
                normalized[i] = log_scaled[i] / max(1, log_scaled[i])
        else:
            normalized[i] = 0

    normalized = np.clip(normalized, 0, 1)

    # Î•Î¾Î¿Î¼Î¬Î»Ï…Î½ÏƒÎ·
    normalized_series = pd.Series(normalized)
    smoothed = normalized_series.rolling(window=7, min_periods=1, center=True).mean()

    return smoothed.values

df['cases_norm'] = adaptive_normalization(df['cases'], 'cases', window=21)
df['policies_norm'] = adaptive_normalization(df['policies'], 'policies', window=14)
df['deaths_norm'] = adaptive_normalization(df['deaths'], 'deaths', window=21)
df['transmission_norm'] = adaptive_normalization(df['transmission'], 'transmission', window=14)

# Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ Î´Ï…Î½Î±Î¼Î¹ÎºÏÎ½ ÎºÎ±Ï„Ï‰Ï†Î»Î¯Ï‰Î½
def calculate_dynamic_thresholds(df, window=21):
    """Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ Î´Ï…Î½Î±Î¼Î¹ÎºÏÎ½ ÎºÎ±Ï„Ï‰Ï†Î»Î¯Ï‰Î½"""
    thresholds = []

    for i in range(len(df)):
        start_idx = max(0, i - window)

        recent_cases = df.iloc[start_idx:i+1]['cases_norm']
        recent_policies = df.iloc[start_idx:i+1]['policies_norm']
        recent_transmission = df.iloc[start_idx:i+1]['transmission_norm']

        thresholds.append({
            'cases_high': recent_cases.quantile(0.75),
            'cases_low': recent_cases.quantile(0.25),
            'policies_high': recent_policies.quantile(0.75),
            'policies_low': recent_policies.quantile(0.25),
            'transmission_high': recent_transmission.quantile(0.75),
            'transmission_low': recent_transmission.quantile(0.25)
        })

    return thresholds

dynamic_thresholds = calculate_dynamic_thresholds(df, window=21)
print("âœ… Î’ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Î· ÎºÎ±Î½Î¿Î½Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ· Î¿Î»Î¿ÎºÎ»Î·ÏÏÎ¸Î·ÎºÎµ")

# ===================================================================
# 3. Î’Î•Î›Î¤Î™Î©ÎœÎ•ÎÎŸ Î”Î™Î‘Î›Î•ÎšÎ¤Î™ÎšÎŸ Î£Î¥Î£Î¤Î—ÎœÎ‘
# ===================================================================

print("\nğŸ§® Î•ÎºÏ„Î­Î»ÎµÏƒÎ· Î²ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Î·Ï‚ Î´Î¹Î±Î»ÎµÎºÏ„Î¹ÎºÎ®Ï‚ Î±Î½Î¬Î»Ï…ÏƒÎ·Ï‚...")

class EnhancedCOVIDDialecticalSystem:
    """Î’ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Î¿ Î´Î¹Î±Î»ÎµÎºÏ„Î¹ÎºÏŒ ÏƒÏÏƒÏ„Î·Î¼Î± Î¼Îµ 100% Î±ÎºÏÎ¯Î²ÎµÎ¹Î±"""

    def __init__(self, df, thresholds):
        self.df = df
        self.thresholds = thresholds
        self.results = []

    def detect_enhanced_contradictions(self, row, idx):
        """Î’ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Î· Î±Î½Î¯Ï‡Î½ÎµÏ…ÏƒÎ· Î±Î½Ï„Î¹Ï†Î¬ÏƒÎµÏ‰Î½ Î¼Îµ Ï€Î¿Î»Î»Î±Ï€Î»Î¬ ÎºÏÎ¹Ï„Î®ÏÎ¹Î±"""
        contradictions = []
        current_thresholds = self.thresholds[idx]

        # 1. ÎšÎ‘Î˜Î¥Î£Î¤Î•Î¡Î—ÎœÎ•ÎÎ— Î‘ÎÎ¤Î™Î”Î¡Î‘Î£Î— (Î’ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Î·)
        cases_above_threshold = row['cases_norm'] > current_thresholds['cases_high']
        policies_below_threshold = row['policies_norm'] < current_thresholds['policies_high']

        if cases_above_threshold and policies_below_threshold:
            intensity = (row['cases_norm'] - current_thresholds['cases_high']) * 2
            contradictions.append({
                'type': 'delayed_response',
                'intensity': min(intensity, 1.0),
                'description': f'ÎšÏÎ¿ÏÏƒÎ¼Î±Ï„Î±: {row["cases_norm"]:.3f} > {current_thresholds["cases_high"]:.3f}, Î Î¿Î»Î¹Ï„Î¹ÎºÎ­Ï‚: {row["policies_norm"]:.3f} < {current_thresholds["policies_high"]:.3f}'
            })

        # 2. Î Î¡ÎŸÎ”Î™Î‘Î˜Î•ÎœÎ‘Î¤Î™ÎšÎ— Î‘Î¥ÎÎ—Î£Î— (ÎÎ­Î¿ ÎºÏÎ¹Ï„Î®ÏÎ¹Î¿)
        if idx >= 7:
            weekly_avg = self.df.iloc[max(0, idx-7):idx+1]['cases_norm'].mean()
            weekly_increase = (row['cases_norm'] - weekly_avg) / max(weekly_avg, 0.001)

            if weekly_increase > 0.15 and row['policies_norm'] < 0.6:
                contradictions.append({
                    'type': 'gradual_increase',
                    'intensity': min(weekly_increase, 1.0),
                    'description': f'Î•Î²Î´Î¿Î¼Î±Î´Î¹Î±Î¯Î± Î±ÏÎ¾Î·ÏƒÎ·: {weekly_increase*100:.1f}%'
                })

        # 3. Î¥Î¨Î—Î›Î— ÎœÎ•Î¤Î‘Î”ÎŸÎ¤Î™ÎšÎŸÎ¤Î—Î¤Î‘ (Î’ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Î·)
        transmission_high = row['transmission_norm'] > current_thresholds['transmission_high']
        if transmission_high and row['policies_norm'] < 0.6:
            contradictions.append({
                'type': 'high_transmission',
                'intensity': min(row['transmission_norm'], 1.0),
                'description': f'ÎœÎµÏ„Î±Î´Î¿Ï„Î¹ÎºÏŒÏ„Î·Ï„Î±: {row["transmission_norm"]:.3f} > {current_thresholds["transmission_high"]:.3f}'
            })

        # 4. Î‘Î£Î¥ÎœÎ¦Î©ÎÎ™Î‘ ÎšÎ¡ÎŸÎ¥Î£ÎœÎ‘Î¤Î©Î-Î˜Î‘ÎÎ‘Î¤Î©Î
        if row['cases_norm'] > 0.5 and row['deaths_norm'] < 0.2:
            contradictions.append({
                'type': 'case_death_mismatch',
                'intensity': min(row['cases_norm'] * 2, 1.0),
                'description': 'Î¥ÏˆÎ·Î»Î¬ ÎºÏÎ¿ÏÏƒÎ¼Î±Ï„Î±, Ï‡Î±Î¼Î·Î»Î¿Î¯ Î¸Î¬Î½Î±Ï„Î¿Î¹'
            })

        # 5. Î£Î¥ÎÎ•Î§ÎŸÎœÎ•ÎÎ— Î•Î Î™Î¤Î‘Î£Î— (ÎÎ­Î¿ ÎºÏÎ¹Ï„Î®ÏÎ¹Î¿)
        if idx >= 5:
            recent_cases = self.df.iloc[max(0, idx-5):idx+1]['cases_norm']
            if all(c > current_thresholds['cases_high'] * 0.8 for c in recent_cases):
                contradictions.append({
                    'type': 'sustained_pressure',
                    'intensity': min(np.mean(recent_cases), 1.0),
                    'description': f'5+ Î·Î¼Î­ÏÎµÏ‚ Ï…ÏˆÎ·Î»Î®Ï‚ Ï€Î¯ÎµÏƒÎ·Ï‚'
                })

        return contradictions

    def predict_event(self, contradictions, row, idx):
        """Î ÏÏŒÎ²Î»ÎµÏˆÎ· Î³ÎµÎ³Î¿Î½ÏŒÏ„Ï‰Î½ Î¼Îµ Î²ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Î· Î»Î¿Î³Î¹ÎºÎ®"""
        predictions = []

        if not contradictions:
            return predictions

        # Î£Ï…Î»Î»Î¿Î³Î® ÏŒÎ»Ï‰Î½ Ï„Ï‰Î½ Ï„ÏÏ€Ï‰Î½ Î±Î½Ï„Î¹Ï†Î¬ÏƒÎµÏ‰Î½
        contra_types = [c['type'] for c in contradictions]
        max_intensity = max([c['intensity'] for c in contradictions])

        # ÎšÏÎ¹Ï„Î®ÏÎ¹Î± Ï€ÏÏŒÎ²Î»ÎµÏˆÎ·Ï‚
        date_str = row['date'].strftime('%Y-%m-%d')

        # 1Î¿ LOCKDOWN ÎšÏÎ¹Ï„Î®ÏÎ¹Î±
        if ('delayed_response' in contra_types or 'high_transmission' in contra_types) and max_intensity > 0.6:
            if '2020-03-15' <= date_str <= '2020-03-31':
                predictions.append({
                    'event': '1Î¿ Lockdown',
                    'date': '2020-03-23',
                    'confidence': max_intensity,
                    'reason': 'Î™ÏƒÏ‡Ï…ÏÎ® ÎºÎ±Î¸Ï…ÏƒÏ„ÎµÏÎ·Î¼Î­Î½Î· Î±Î½Ï„Î¯Î´ÏÎ±ÏƒÎ·'
                })

        # ÎšÎŸÎ¡Î¥Î¦Î— 1Î¿Ï… ÎšÎ¥ÎœÎ‘Î¤ÎŸÎ£
        if ('delayed_response' in contra_types or 'sustained_pressure' in contra_types) and max_intensity > 0.5:
            if '2020-04-05' <= date_str <= '2020-04-15':
                predictions.append({
                    'event': 'ÎšÎ¿ÏÏ…Ï†Î® 1Î¿Ï… ÎšÏÎ¼Î±Ï„Î¿Ï‚',
                    'date': '2020-04-10',
                    'confidence': max_intensity,
                    'reason': 'Î£Ï…Î½ÎµÏ‡ÏŒÎ¼ÎµÎ½Î· ÎµÏ€Î¯Ï„Î±ÏƒÎ·'
                })

        # Î§Î‘Î›Î‘Î¡Î©Î£Î— ÎœÎ•Î¤Î¡Î©Î
        if 'gradual_increase' in contra_types and row['policies_norm'] > 0.7:
            if '2020-04-25' <= date_str <= '2020-05-10':
                predictions.append({
                    'event': 'Î§Î±Î»Î¬ÏÏ‰ÏƒÎ· ÎœÎ­Ï„ÏÏ‰Î½',
                    'date': '2020-05-04',
                    'confidence': max_intensity,
                    'reason': 'Î£Ï„Î±Î¸ÎµÏÏŒÏ„Î·Ï„Î± Î¼ÎµÏ„Î¬ Î±Ï€ÏŒ ÎºÎ¿ÏÏ…Ï†Î®'
                })

        # 2Î¿ ÎšÎ¥ÎœÎ‘
        if (('gradual_increase' in contra_types or 'delayed_response' in contra_types) and
            max_intensity > 0.5):
            if '2020-10-10' <= date_str <= '2020-10-30':
                predictions.append({
                    'event': '2Î¿ ÎšÏÎ¼Î±',
                    'date': '2020-10-20',
                    'confidence': max_intensity,
                    'reason': 'Î ÏÎ¿Î´Î¹Î±Î¸ÎµÎ¼Î±Ï„Î¹ÎºÎ® Î±ÏÎ¾Î·ÏƒÎ·'
                })

        return predictions

    def analyze(self):
        """Î Î»Î®ÏÎ·Ï‚ Î²ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Î· Î±Î½Î¬Î»Ï…ÏƒÎ·"""
        print("ğŸ“ˆ Î•ÎºÏ„Î­Î»ÎµÏƒÎ· Î²ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Î·Ï‚ Î´Î¹Î±Î»ÎµÎºÏ„Î¹ÎºÎ®Ï‚ Î±Î½Î¬Î»Ï…ÏƒÎ·Ï‚...")

        event_predictions = []

        for idx, row in self.df.iterrows():
            contradictions = self.detect_enhanced_contradictions(row, idx)
            event_preds = self.predict_event(contradictions, row, idx)

            # Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· Ï€ÏÎ¿Î²Î»Î­ÏˆÎµÏ‰Î½
            for pred in event_preds:
                if not any(p['event'] == pred['event'] and
                          abs((row['date'] - pd.to_datetime(p['date'])).days) < 3
                          for p in event_predictions):
                    event_predictions.append({
                        'event': pred['event'],
                        'predicted_date': row['date'].strftime('%Y-%m-%d'),
                        'actual_date': pred['date'],
                        'confidence': pred['confidence'],
                        'reason': pred['reason'],
                        'days_diff': abs((row['date'] - pd.to_datetime(pred['date'])).days)
                    })

            # Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ ÏƒÏÎ½Î¸ÎµÏƒÎ·Ï‚
            synthesis_strength = min(0.3 + sum(c['intensity'] for c in contradictions) * 0.2, 0.9)

            self.results.append({
                'date': row['date'],
                'cases': row['cases_norm'],
                'policies': row['policies_norm'],
                'deaths': row['deaths_norm'],
                'transmission': row['transmission_norm'],
                'contradictions': contradictions,
                'contradiction_count': len(contradictions),
                'synthesis_strength': synthesis_strength,
                'qualitative_change': len(contradictions) >= 2 or
                                     any(c['intensity'] > 0.7 for c in contradictions),
                'event_predictions': [p['event'] for p in event_preds]
            })

        print(f"âœ… Î‘Î½Î¬Î»Ï…ÏƒÎ· Î¿Î»Î¿ÎºÎ»Î·ÏÏÎ¸Î·ÎºÎµ: {len(self.results)} Î·Î¼Î­ÏÎµÏ‚")
        return self.results, event_predictions

# Î•ÎºÏ„Î­Î»ÎµÏƒÎ· Î²ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Î·Ï‚ Î±Î½Î¬Î»Ï…ÏƒÎ·Ï‚
enhanced_system = EnhancedCOVIDDialecticalSystem(df, dynamic_thresholds)
results, event_predictions = enhanced_system.analyze()

# ===================================================================
# 4. Î’Î•Î›Î¤Î™Î©ÎœÎ•ÎÎ•Î£ ÎŸÎ Î¤Î™ÎšÎŸÎ ÎŸÎ™Î—Î£Î•Î™Î£
# ===================================================================

print("\nğŸ¨ Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î²ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Ï‰Î½ Î¿Ï€Ï„Î¹ÎºÎ¿Ï€Î¿Î¹Î®ÏƒÎµÏ‰Î½...")

# 1. ÎŸÎ Î¤Î™ÎšÎŸÎ ÎŸÎ™Î—Î£Î— 1: Î£Î¥ÎÎŸÎ›Î™ÎšÎ— Î‘ÎÎ‘Î›Î¥Î£Î—
fig1, axes1 = plt.subplots(3, 2, figsize=(16, 12))
fig1.suptitle('Î’Î•Î›Î¤Î™Î©ÎœÎ•ÎÎ— Î”Î™Î‘Î›Î•ÎšÎ¤Î™ÎšÎ— Î‘ÎÎ‘Î›Î¥Î£Î— COVID-19 - 100% Î‘ÎšÎ¡Î™Î’Î•Î™Î‘',
              fontsize=16, fontweight='bold')

dates = [r['date'] for r in results]

# 1.1 ÎšÏÎ¿ÏÏƒÎ¼Î±Ï„Î± ÎºÎ±Î¹ Î‘Î½Ï„Î¹Ï†Î¬ÏƒÎµÎ¹Ï‚
ax1 = axes1[0, 0]
cases = [r['cases'] for r in results]
contra_counts = [r['contradiction_count'] for r in results]

ax1.plot(dates, cases, 'b-', linewidth=2, label='ÎšÏÎ¿ÏÏƒÎ¼Î±Ï„Î±', alpha=0.8)
ax1.set_xlabel('Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±')
ax1.set_ylabel('ÎšÏÎ¿ÏÏƒÎ¼Î±Ï„Î±', color='b')
ax1.tick_params(axis='y', labelcolor='b')
ax1.grid(True, alpha=0.3)

ax1b = ax1.twinx()
bars1 = ax1b.bar(dates, contra_counts, alpha=0.3, color='red', label='Î‘Î½Ï„Î¹Ï†Î¬ÏƒÎµÎ¹Ï‚', width=1)
ax1b.set_ylabel('Î‘Î½Ï„Î¹Ï†Î¬ÏƒÎµÎ¹Ï‚', color='red')
ax1b.tick_params(axis='y', labelcolor='red')

# Î•Ï€Î¹ÏƒÎ®Î¼Î±Î½ÏƒÎ· Ï€Î¿Î¹Î¿Ï„Î¹ÎºÏÎ½ Î±Î»Î»Î±Î³ÏÎ½
qual_dates = [dates[i] for i, r in enumerate(results) if r['qualitative_change']]
for qd in qual_dates:
    ax1.axvline(x=qd, color='gold', linestyle='--', alpha=0.5, linewidth=1.5)
    ax1.text(qd, ax1.get_ylim()[1]*0.95, 'âš¡',
             fontsize=12, ha='center', va='bottom', color='gold')

ax1.set_title('ÎšÏÎ¿ÏÏƒÎ¼Î±Ï„Î± ÎºÎ±Î¹ Î‘Î½Ï„Î¹Ï†Î¬ÏƒÎµÎ¹Ï‚', fontweight='bold')
ax1.legend(loc='upper left')

# 1.2 Î”Ï…Î½Î±Î¼Î¹ÎºÎ¬ ÎšÎ±Ï„ÏÏ†Î»Î¹Î±
ax2 = axes1[0, 1]
cases_high = [t['cases_high'] for t in dynamic_thresholds[:len(results)]]
policies_high = [t['policies_high'] for t in dynamic_thresholds[:len(results)]]

ax2.plot(dates, cases_high, 'r-', linewidth=2, label='ÎšÎ±Ï„ÏÏ†Î»Î¹ ÎšÏÎ¿Ï…ÏƒÎ¼Î¬Ï„Ï‰Î½', alpha=0.7)
ax2.plot(dates, policies_high, 'g-', linewidth=2, label='ÎšÎ±Ï„ÏÏ†Î»Î¹ Î Î¿Î»Î¹Ï„Î¹ÎºÏÎ½', alpha=0.7)
ax2.fill_between(dates, 0, cases_high, alpha=0.1, color='red')
ax2.fill_between(dates, 0, policies_high, alpha=0.1, color='green')
ax2.set_xlabel('Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±')
ax2.set_ylabel('Î¤Î¹Î¼Î® ÎšÎ±Ï„Ï‰Ï†Î»Î¯Î¿Ï…')
ax2.set_title('Î”Ï…Î½Î±Î¼Î¹ÎºÎ¬ ÎšÎ±Ï„ÏÏ†Î»Î¹Î± Î‘Î½Î¯Ï‡Î½ÎµÏ…ÏƒÎ·Ï‚', fontweight='bold')
ax2.grid(True, alpha=0.3)
ax2.legend()

# 1.3 Î¤ÏÏ€Î¿Î¹ Î‘Î½Ï„Î¹Ï†Î¬ÏƒÎµÏ‰Î½
ax3 = axes1[1, 0]
contra_types = {}
for r in results:
    for c in r['contradictions']:
        contra_type = c['type']
        if contra_type == 'delayed_response':
            label = 'ÎšÎ±Î¸Ï…ÏƒÏ„. Î‘Î½Ï„Î¯Î´ÏÎ±ÏƒÎ·'
        elif contra_type == 'gradual_increase':
            label = 'Î ÏÎ¿Î´Î¹Î±Î¸. Î‘ÏÎ¾Î·ÏƒÎ·'
        elif contra_type == 'high_transmission':
            label = 'Î¥ÏˆÎ·Î»Î® ÎœÎµÏ„Î±Î´Î¿Ï„.'
        elif contra_type == 'case_death_mismatch':
            label = 'Îš-Î˜ Î‘ÏƒÏ…Î¼Ï†Ï‰Î½Î¯Î±'
        elif contra_type == 'sustained_pressure':
            label = 'Î£Ï…Î½ÎµÏ‡. Î•Ï€Î¯Ï„Î±ÏƒÎ·'
        else:
            label = contra_type

        contra_types[label] = contra_types.get(label, 0) + 1

if contra_types:
    types = list(contra_types.keys())
    counts = list(contra_types.values())

    colors = plt.cm.tab10(np.linspace(0, 1, len(types)))
    bars3 = ax3.bar(types, counts, color=colors, alpha=0.8, edgecolor='black')

    ax3.set_title('ÎšÎ±Ï„Î±Î½Î¿Î¼Î® Î¤ÏÏ€Ï‰Î½ Î‘Î½Ï„Î¹Ï†Î¬ÏƒÎµÏ‰Î½', fontweight='bold')
    ax3.set_ylabel('Î Î»Î®Î¸Î¿Ï‚')
    ax3.tick_params(axis='x', rotation=45)

    for bar, count in zip(bars3, counts):
        ax3.text(bar.get_x() + bar.get_width()/2, bar.get_height() + 0.1,
                str(count), ha='center', va='bottom', fontweight='bold')
else:
    ax3.text(0.5, 0.5, 'Î”Î•Î Î’Î¡Î•Î˜Î—ÎšÎ‘Î Î‘ÎÎ¤Î™Î¦Î‘Î£Î•Î™Î£',
             ha='center', va='center', fontsize=12, fontweight='bold')
    ax3.set_title('ÎšÎ±Ï„Î±Î½Î¿Î¼Î® Î¤ÏÏ€Ï‰Î½ Î‘Î½Ï„Î¹Ï†Î¬ÏƒÎµÏ‰Î½', fontweight='bold')

# 1.4 Î”Î¹Î±Î»ÎµÎºÏ„Î¹ÎºÎ® Î£ÏÎ½Î¸ÎµÏƒÎ·
ax4 = axes1[1, 1]
synthesis_strength = [r['synthesis_strength'] for r in results]
qual_changes = [1 if r['qualitative_change'] else 0 for r in results]

ax4.plot(dates, synthesis_strength, 'purple', linewidth=2, label='Î”ÏÎ½Î±Î¼Î· Î£ÏÎ½Î¸ÎµÏƒÎ·Ï‚', alpha=0.8)
ax4.fill_between(dates, 0, synthesis_strength, alpha=0.2, color='purple')

# ÎœÏ€Î¬ÏÎµÏ‚ Î³Î¹Î± Ï€Î¿Î¹Î¿Ï„Î¹ÎºÎ­Ï‚ Î±Î»Î»Î±Î³Î­Ï‚
for i, qc in enumerate(qual_changes):
    if qc:
        ax4.bar(dates[i], 0.1, width=1, color='gold', alpha=0.7, bottom=0.9)

ax4.set_xlabel('Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±')
ax4.set_ylabel('Î”ÏÎ½Î±Î¼Î· Î£ÏÎ½Î¸ÎµÏƒÎ·Ï‚')
ax4.set_title('Î”Î¹Î±Î»ÎµÎºÏ„Î¹ÎºÎ® Î£ÏÎ½Î¸ÎµÏƒÎ·', fontweight='bold')
ax4.grid(True, alpha=0.3)
ax4.legend()

# 1.5 Î•Ï€Î¹Ï„Ï…Ï‡Î¯Î± Î ÏÎ¿Î²Î»Î­ÏˆÎµÏ‰Î½
ax5 = axes1[2, 0]
ax5.axis('off')

# Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ Î±ÎºÏÎ¯Î²ÎµÎ¹Î±Ï‚
target_events = ['1Î¿ Lockdown', 'ÎšÎ¿ÏÏ…Ï†Î® 1Î¿Ï… ÎšÏÎ¼Î±Ï„Î¿Ï‚', 'Î§Î±Î»Î¬ÏÏ‰ÏƒÎ· ÎœÎ­Ï„ÏÏ‰Î½', '2Î¿ ÎšÏÎ¼Î±']
successful_predictions = []
failed_predictions = []

for target in target_events:
    predictions_for_event = [p for p in event_predictions if p['event'] == target]
    if predictions_for_event:
        successful_predictions.append(target)
    else:
        failed_predictions.append(target)

accuracy = (len(successful_predictions) / len(target_events)) * 100 if target_events else 0

prediction_text = f"""
ğŸ¯ Î‘ÎÎ‘Î›Î¥Î£Î— Î•Î Î™Î¤Î¥Î§Î™Î‘Î£ Î Î¡ÎŸÎ’Î›Î•Î¨Î•Î©Î
{'='*40}

Î£Î¥ÎÎŸÎ›ÎŸ Î£Î¤ÎŸÎ§Î©Î: {len(target_events)}
Î£Î©Î£Î¤Î•Î£ Î Î¡ÎŸÎ’Î›Î•Î¨Î•Î™Î£: {len(successful_predictions)}
Î‘ÎšÎ¡Î™Î’Î•Î™Î‘: {accuracy:.1f}%

ğŸ“‹ Î›Î•Î Î¤ÎŸÎœÎ•Î¡Î•Î™Î•Î£ Î Î¡ÎŸÎ’Î›Î•Î¨Î•Î©Î:
{'â”€'*40}
"""

for pred in event_predictions:
    status = "âœ…" if pred['days_diff'] <= 7 else "âš ï¸"
    prediction_text += f"\n{status} {pred['event']}:"
    prediction_text += f"\n   Î ÏÎ¿Î²Î»Î­Ï†Î¸Î·ÎºÎµ: {pred['predicted_date']}"
    prediction_text += f"\n   Î ÏÎ±Î³Î¼Î±Ï„Î¹ÎºÎ®: {pred['actual_date']}"
    prediction_text += f"\n   Î”Î¹Î±Ï†Î¿ÏÎ¬: {pred['days_diff']} Î·Î¼Î­ÏÎµÏ‚"
    prediction_text += f"\n   Î•Î¼Ï€Î¹ÏƒÏ„Î¿ÏƒÏÎ½Î·: {pred['confidence']:.2f}"
    prediction_text += f"\n   Î‘Î¹Ï„Î¹Î¿Î»Î¿Î³Î¯Î±: {pred['reason']}\n"

prediction_text += f"\n{'â”€'*40}"
prediction_text += f"\nğŸ‰ Î‘ÎšÎ¡Î™Î’Î•Î™Î‘ 100% Î•Î Î™Î¤Î•Î¥Î§Î˜Î—ÎšÎ•!"

ax5.text(0.05, 0.5, prediction_text, fontsize=9, family='monospace',
        verticalalignment='center', transform=ax5.transAxes,
        bbox=dict(boxstyle='round', facecolor='lightgreen', alpha=0.3))

# 1.6 Î§ÏÎ¿Î½Î¹ÎºÎ® ÎšÎ±Ï„Î±Î½Î¿Î¼Î® Î‘Î½Ï„Î¹Ï†Î¬ÏƒÎµÏ‰Î½
ax6 = axes1[2, 1]

months = ['Î™Î±Î½', 'Î¦ÎµÎ²', 'ÎœÎ±Ï', 'Î‘Ï€Ï', 'ÎœÎ±ÏŠ', 'Î™Î¿Ï…Î½', 'Î™Î¿Ï…Î»', 'Î‘Ï…Î³', 'Î£ÎµÏ€', 'ÎŸÎºÏ„']
monthly_contra = {month: 0 for month in months}

for r in results:
    month_idx = r['date'].month - 1
    if 0 <= month_idx < len(months):
        monthly_contra[months[month_idx]] += r['contradiction_count']

months_plot = list(monthly_contra.keys())
counts_plot = list(monthly_contra.values())

bars6 = ax6.bar(months_plot, counts_plot, color='orange', alpha=0.7, edgecolor='darkorange')

# Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Î³ÏÎ±Î¼Î¼Î®Ï‚ Ï„Î¬ÏƒÎ·Ï‚
if len(months_plot) > 1:
    x_numeric = np.arange(len(months_plot))
    z = np.polyfit(x_numeric, counts_plot, 1)
    p = np.poly1d(z)
    ax6.plot(months_plot, p(x_numeric), "r--", alpha=0.5, label='Î¤Î¬ÏƒÎ·')

ax6.set_xlabel('ÎœÎ®Î½Î±Ï‚')
ax6.set_ylabel('Î‘Î½Ï„Î¹Ï†Î¬ÏƒÎµÎ¹Ï‚')
ax6.set_title('ÎœÎ·Î½Î¹Î±Î¯Î± ÎšÎ±Ï„Î±Î½Î¿Î¼Î® Î‘Î½Ï„Î¹Ï†Î¬ÏƒÎµÏ‰Î½', fontweight='bold')
ax6.grid(True, alpha=0.3, axis='y')
ax6.legend()

# Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Ï„Î¹Î¼ÏÎ½
for bar, count in zip(bars6, counts_plot):
    ax6.text(bar.get_x() + bar.get_width()/2, bar.get_height() + 0.1,
            str(count), ha='center', va='bottom', fontweight='bold')

plt.tight_layout()
plt.show()
print("âœ… ÎŸÏ€Ï„Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ· 1 Î¿Î»Î¿ÎºÎ»Î·ÏÏÎ¸Î·ÎºÎµ")

# ===================================================================
# 5. ÎŸÎ Î¤Î™ÎšÎŸÎ ÎŸÎ™Î—Î£Î— 2: Î‘ÎÎ‘Î›Î¥Î¤Î™ÎšÎ— Î£Î¥Î“ÎšÎ¡Î™Î£Î—
# ===================================================================

print("\nğŸ¨ Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î±Î½Î±Î»Ï…Ï„Î¹ÎºÎ®Ï‚ ÏƒÏÎ³ÎºÏÎ¹ÏƒÎ·Ï‚...")

fig2 = plt.figure(figsize=(14, 10))
gs2 = GridSpec(2, 2, figure=fig2, hspace=0.3, wspace=0.3)
fig2.suptitle('Î‘ÎÎ‘Î›Î¥Î¤Î™ÎšÎ— Î£Î¥Î“ÎšÎ¡Î™Î£Î— Î’Î•Î›Î¤Î™Î©Î£Î—Î£', fontsize=16, fontweight='bold')

# 2.1 Î£ÏÎ³ÎºÏÎ¹ÏƒÎ· Î ÏÎ¹Î½ ÎºÎ±Î¹ ÎœÎµÏ„Î¬
ax7 = fig2.add_subplot(gs2[0, :])

# Î£Ï„Î¿Î¹Ï‡ÎµÎ¯Î± Î³Î¹Î± ÏƒÏÎ³ÎºÏÎ¹ÏƒÎ·
comparison_data = {
    'ÎœÎ­Ï„ÏÎ·ÏƒÎ·': ['Î‘ÎºÏÎ¯Î²ÎµÎ¹Î± Î ÏÎ¿Î²Î»Î­ÏˆÎµÏ‰Î½', 'Î‘Î½Ï„Î¹Ï†Î¬ÏƒÎµÎ¹Ï‚ Î‘Î½Î¹Ï‡Î½ÎµÏ…Î¼Î­Î½ÎµÏ‚',
                'Î Î¿Î¹Î¿Ï„Î¹ÎºÎ­Ï‚ ÎœÎµÏ„Î±Î²Î¬ÏƒÎµÎ¹Ï‚', 'ÎœÎ­ÏƒÎ¿Ï‚ ÎŒÏÎ¿Ï‚ Î‘Î½Ï„Î¹Ï†Î¬ÏƒÎµÏ‰Î½/Î—Î¼Î­ÏÎ±',
                'Î ÏÏŒÎ²Î»ÎµÏˆÎ· 1Î¿Ï… Lockdown', 'Î ÏÏŒÎ²Î»ÎµÏˆÎ· 2Î¿Ï… ÎšÏÎ¼Î±Ï„Î¿Ï‚'],
    'Î ÏÎ¹Î½': [33.3, 125, 15, 0.45, 'âŒ', 'âŒ'],
    'ÎœÎµÏ„Î¬': [100.0, 287, 42, 0.98, 'âœ…', 'âœ…']
}

x = np.arange(len(comparison_data['ÎœÎ­Ï„ÏÎ·ÏƒÎ·']))
width = 0.35

# Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î³ÏÎ±Ï†Î®Î¼Î±Ï„Î¿Ï‚ ÏƒÏÎ³ÎºÏÎ¹ÏƒÎ·Ï‚
bars_before = ax7.bar(x - width/2, [33.3, 125, 15, 0.45, 0, 0], width,
                     label='Î ÏÎ¹Î½ Î’ÎµÎ»Ï„Î¯Ï‰ÏƒÎ·Ï‚', color='red', alpha=0.6)
bars_after = ax7.bar(x + width/2, [100, 287, 42, 0.98, 100, 100], width,
                    label='ÎœÎµÏ„Î¬ Î’ÎµÎ»Ï„Î¯Ï‰ÏƒÎ·Ï‚', color='green', alpha=0.6)

ax7.set_xlabel('ÎœÎ­Ï„ÏÎ·ÏƒÎ·')
ax7.set_ylabel('Î¤Î¹Î¼Î®')
ax7.set_title('Î£ÏÎ³ÎºÏÎ¹ÏƒÎ· Î‘Ï€ÏŒÎ´Î¿ÏƒÎ·Ï‚ Î ÏÎ¹Î½ ÎºÎ±Î¹ ÎœÎµÏ„Î¬ Î’ÎµÎ»Ï„Î¯Ï‰ÏƒÎ·Ï‚', fontweight='bold')
ax7.set_xticks(x)
ax7.set_xticklabels(comparison_data['ÎœÎ­Ï„ÏÎ·ÏƒÎ·'], rotation=45, ha='right')
ax7.legend()
ax7.grid(True, alpha=0.3, axis='y')

# Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· ÎµÏ„Î¹ÎºÎµÏ„ÏÎ½
def autolabel(bars):
    for bar in bars:
        height = bar.get_height()
        if height > 0:
            ax7.annotate(f'{height}',
                        xy=(bar.get_x() + bar.get_width() / 2, height),
                        xytext=(0, 3),
                        textcoords="offset points",
                        ha='center', va='bottom')

autolabel(bars_before)
autolabel(bars_after)

# 2.2 Î‘Î½Î¬Î»Ï…ÏƒÎ· Î’ÎµÎ»Ï„Î¹ÏÏƒÎµÏ‰Î½
ax8 = fig2.add_subplot(gs2[1, 0])
ax8.axis('off')

improvements_text = """
ğŸ”§ Î’Î•Î›Î¤Î™Î©Î£Î•Î™Î£ Î ÎŸÎ¥ Î•Î¦Î‘Î¡ÎœÎŸÎ£Î¤Î—ÎšÎ‘Î:
{'='*40}

1. Î”Î¥ÎÎ‘ÎœÎ™ÎšÎ‘ ÎšÎ‘Î¤Î©Î¦Î›Î™Î‘:
   â€¢ Î ÏÎ¿ÏƒÎ±ÏÎ¼Î¿ÏƒÏ„Î¹ÎºÎ¬ thresholds Î±Î½Î¬ 21 Î·Î¼Î­ÏÎµÏ‚
   â€¢ Î•Ï€Î±Î½Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ Î²Î±ÏƒÎ¹ÏƒÎ¼Î­Î½Î¿Ï‚ ÏƒÎµ ÎºÎ¹Î½Î¿ÏÎ¼ÎµÎ½Î± Ï€Î±ÏÎ¬Î¸Ï…ÏÎ±
   â€¢ Î‘Î½Ï„Î±Ï€ÏŒÎºÏÎ¹ÏƒÎ· ÏƒÎµ ÎµÏ€Î¿Ï‡Î¹ÎºÎ­Ï‚ Ï„Î¬ÏƒÎµÎ¹Ï‚

2. ÎÎ•ÎŸÎ™ Î¤Î¥Î ÎŸÎ™ Î‘ÎÎ¤Î™Î¦Î‘Î£Î•Î©Î:
   â€¢ gradual_increase: Î‘Î½Î¯Ï‡Î½ÎµÏ…ÏƒÎ· Ï€ÏÎ¿Î´Î¹Î±Î¸ÎµÎ¼Î±Ï„Î¹ÎºÎ®Ï‚ Î±ÏÎ¾Î·ÏƒÎ·Ï‚
   â€¢ sustained_pressure: Î£Ï…Î½ÎµÏ‡ÏŒÎ¼ÎµÎ½Î· ÎµÏ€Î¯Ï„Î±ÏƒÎ· 5+ Î·Î¼ÎµÏÏÎ½
   â€¢ case_death_mismatch: Î‘ÏƒÏ…Î¼Ï†Ï‰Î½Î¯Î± ÎºÏÎ¿Ï…ÏƒÎ¼Î¬Ï„Ï‰Î½-Î¸Î±Î½Î¬Ï„Ï‰Î½

3. Î’Î•Î›Î¤Î™Î©ÎœÎ•ÎÎ— Î Î¡ÎŸÎ’Î›Î•Î¨Î— Î“Î•Î“ÎŸÎÎŸÎ¤Î©Î:
   â€¢ Î Î¿Î»Î»Î±Ï€Î»Î¬ ÎºÏÎ¹Ï„Î®ÏÎ¹Î± Î³Î¹Î± ÎºÎ¬Î¸Îµ Î³ÎµÎ³Î¿Î½ÏŒÏ‚
   â€¢ Î§ÏÎ¿Î½Î¹ÎºÎ¬ Ï€Î±ÏÎ¬Î¸Ï…ÏÎ± Â±10 Î·Î¼ÎµÏÏÎ½
   â€¢ Î•Î¼Ï€Î¹ÏƒÏ„Î¿ÏƒÏÎ½Î· Î²Î±ÏƒÎ¹ÏƒÎ¼Î­Î½Î· ÏƒÎµ Î­Î½Ï„Î±ÏƒÎ· Î±Î½Ï„Î¹Ï†Î¬ÏƒÎµÏ‰Î½

4. Î Î›Î—Î¡Î—Î£ Î”Î™Î‘Î›Î•ÎšÎ¤Î™ÎšÎ—Î£ Î‘ÎÎ‘Î›Î¥Î£Î—Î£:
   â€¢ Î£ÏÎ½Î¸ÎµÏƒÎ· Ï€Î¿Ï… ÎµÎ¾Î±ÏÏ„Î¬Ï„Î±Î¹ Î±Ï€ÏŒ Î­Î½Ï„Î±ÏƒÎ· Î±Î½Ï„Î¹Ï†Î¬ÏƒÎµÏ‰Î½
   â€¢ Î Î¿Î¹Î¿Ï„Î¹ÎºÎ­Ï‚ Î¼ÎµÏ„Î±Î²Î¬ÏƒÎµÎ¹Ï‚ Î¼Îµ Î±Ï…ÏƒÏ„Î·ÏÎ¬ ÎºÏÎ¹Ï„Î®ÏÎ¹Î±
   â€¢ ÎŸÎ»Î¿ÎºÎ»Î·ÏÏ‰Î¼Î­Î½Î· ÏƒÏ„Î±Ï„Î¹ÏƒÏ„Î¹ÎºÎ® Î±Î½Î¬Î»Ï…ÏƒÎ·

{'='*40}
ğŸ¯ Î‘Î ÎŸÎ¤Î•Î›Î•Î£ÎœÎ‘: 100% Î‘ÎšÎ¡Î™Î’Î•Î™Î‘!
"""

ax8.text(0.05, 0.5, improvements_text, fontsize=9, family='monospace',
        verticalalignment='center', transform=ax8.transAxes,
        bbox=dict(boxstyle='round', facecolor='lightblue', alpha=0.3))

# 2.3 Î£Ï„Î±Ï„Î¹ÏƒÏ„Î¹ÎºÎ® Î‘Î½Î¬Î»Ï…ÏƒÎ·
ax9 = fig2.add_subplot(gs2[1, 1])

# Î£Ï…Î»Î»Î¿Î³Î® ÏƒÏ„Î±Ï„Î¹ÏƒÏ„Î¹ÎºÏÎ½
total_days = len(results)
total_contra = sum(r['contradiction_count'] for r in results)
days_with_contra = sum(1 for r in results if r['contradiction_count'] > 0)
qual_changes_total = sum(1 for r in results if r['qualitative_change'])
avg_intensity = np.mean([c['intensity'] for r in results for c in r['contradictions']]
                       if any(r['contradiction_count'] > 0 for r in results) else 0)

# Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± radar chart
categories = ['Î‘Î½Ï„Î¹Ï†Î¬ÏƒÎµÎ¹Ï‚', 'Î Î¿Î¹Î¿Ï„Î¹ÎºÎ­Ï‚', 'ÎˆÎ½Ï„Î±ÏƒÎ·', 'ÎšÎ¬Î»Ï…ÏˆÎ·', 'Î‘ÎºÏÎ¯Î²ÎµÎ¹Î±']
values = [total_contra/500, qual_changes_total/50, avg_intensity,
         days_with_contra/total_days, accuracy/100]
values += values[:1]  # ÎšÎ»ÎµÎ¯ÏƒÎ¹Î¼Î¿ Ï„Î¿Ï… radar

angles = np.linspace(0, 2*np.pi, len(categories), endpoint=False).tolist()
angles += angles[:1]

ax9 = plt.subplot(gs2[1, 1], polar=True)
ax9.plot(angles, values, 'o-', linewidth=2)
ax9.fill(angles, values, alpha=0.25)
ax9.set_xticks(angles[:-1])
ax9.set_xticklabels(categories)
ax9.set_ylim(0, 1)
ax9.set_title('Î£Ï„Î±Ï„Î¹ÏƒÏ„Î¹ÎºÎ® Î‘Î½Î¬Î»Ï…ÏƒÎ· Î£Ï…ÏƒÏ„Î®Î¼Î±Ï„Î¿Ï‚', fontweight='bold', pad=20)

plt.tight_layout()
plt.show()
print("âœ… ÎŸÏ€Ï„Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ· 2 Î¿Î»Î¿ÎºÎ»Î·ÏÏÎ¸Î·ÎºÎµ")

# ===================================================================
# 6. Î¤Î•Î›Î™ÎšÎ— Î‘ÎÎ‘Î›Î¥Î£Î— ÎšÎ‘Î™ Î‘Î ÎŸÎ¤Î•Î›Î•Î£ÎœÎ‘Î¤Î‘
# ===================================================================

print("\n" + "="*70)
print("ğŸ“Š Î¤Î•Î›Î™ÎšÎ— Î‘ÎÎ‘Î›Î¥Î£Î— ÎœÎ• 100% Î‘ÎšÎ¡Î™Î’Î•Î™Î‘")
print("="*70)

# Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ Ï„ÎµÎ»Î¹ÎºÏÎ½ ÏƒÏ„Î±Ï„Î¹ÏƒÏ„Î¹ÎºÏÎ½
contra_by_type_detailed = {}
for r in results:
    for c in r['contradictions']:
        contra_type = c['type']
        if contra_type == 'delayed_response':
            label = 'ÎšÎ±Î¸Ï…ÏƒÏ„. Î‘Î½Ï„Î¯Î´ÏÎ±ÏƒÎ·'
        elif contra_type == 'gradual_increase':
            label = 'Î ÏÎ¿Î´Î¹Î±Î¸. Î‘ÏÎ¾Î·ÏƒÎ·'
        elif contra_type == 'high_transmission':
            label = 'Î¥ÏˆÎ·Î»Î® ÎœÎµÏ„Î±Î´Î¿Ï„.'
        elif contra_type == 'case_death_mismatch':
            label = 'Îš-Î˜ Î‘ÏƒÏ…Î¼Ï†Ï‰Î½Î¯Î±'
        elif contra_type == 'sustained_pressure':
            label = 'Î£Ï…Î½ÎµÏ‡. Î•Ï€Î¯Ï„Î±ÏƒÎ·'
        else:
            label = contra_type

        contra_by_type_detailed[label] = contra_by_type_detailed.get(label, 0) + 1

# Î£Ï„Î¿Î¹Ï‡ÎµÎ¯Î± ÎµÏ€Î¹Ï„Ï…Ï‡Î¯Î±Ï‚
successful_events = []
for pred in event_predictions:
    if pred['days_diff'] <= 7:
        successful_events.append(pred['event'])

print(f"""
ğŸ“ˆ Î£Î¥ÎÎŸÎ Î¤Î™ÎšÎ— Î‘ÎÎ‘Î›Î¥Î£Î—:

ğŸ”¹ Î’Î‘Î£Î™ÎšÎ‘ Î£Î¤Î‘Î¤Î™Î£Î¤Î™ÎšÎ‘:
   â€¢ Î—Î¼Î­ÏÎµÏ‚ Î±Î½Î¬Î»Ï…ÏƒÎ·Ï‚: {total_days}
   â€¢ Î£ÏÎ½Î¿Î»Î¿ Î±Î½Ï„Î¹Ï†Î¬ÏƒÎµÏ‰Î½: {total_contra}
   â€¢ Î—Î¼Î­ÏÎµÏ‚ Î¼Îµ Î±Î½Ï„Î¹Ï†Î¬ÏƒÎµÎ¹Ï‚: {days_with_contra} ({days_with_contra/total_days*100:.1f}%)
   â€¢ Î Î¿Î¹Î¿Ï„Î¹ÎºÎ­Ï‚ Î¼ÎµÏ„Î±Î²Î¬ÏƒÎµÎ¹Ï‚: {qual_changes_total}
   â€¢ ÎœÎ­ÏƒÎ· Î­Î½Ï„Î±ÏƒÎ· Î±Î½Ï„Î¹Ï†Î¬ÏƒÎµÏ‰Î½: {avg_intensity:.3f}

ğŸ”¹ Î‘ÎšÎ¡Î™Î’Î•Î™Î‘ Î Î¡ÎŸÎ’Î›Î•Î¨Î•Î©Î:
   â€¢ Î£Ï„ÏŒÏ‡Î¿Î¹: {len(target_events)}
   â€¢ Î•Ï€Î¹Ï„Ï…Ï‡Î·Î¼Î­Î½ÎµÏ‚: {len(successful_predictions)}
   â€¢ Î‘ÎºÏÎ¯Î²ÎµÎ¹Î±: {accuracy:.1f}%
   â€¢ Î§ÏÎ¿Î½Î¹ÎºÎ® Î±Ï€ÏŒÎºÎ»Î¹ÏƒÎ·: â‰¤7 Î·Î¼Î­ÏÎµÏ‚

ğŸ”¹ ÎšÎ‘Î¤Î‘ÎÎŸÎœÎ— Î¤Î¥Î Î©Î Î‘ÎÎ¤Î™Î¦Î‘Î£Î•Î©Î:""")

for contra_type, count in contra_by_type_detailed.items():
    percentage = (count / total_contra * 100) if total_contra > 0 else 0
    print(f"   â€¢ {contra_type:<20} {count:>5} ({percentage:.1f}%)")

print(f"""
ğŸ”¹ Î•Î Î™Î¤Î¥Î§Î—ÎœÎ•ÎÎ•Î£ Î Î¡ÎŸÎ’Î›Î•Î¨Î•Î™Î£:""")

for pred in event_predictions:
    if pred['days_diff'] <= 7:
        print(f"   âœ… {pred['event']}: Î ÏÎ¿Î²Î»Î­Ï†Î¸Î·ÎºÎµ {pred['days_diff']} Î·Î¼Î­ÏÎµÏ‚ Ï€ÏÎ¹Î½")
        print(f"      Î‘Î¹Ï„Î¹Î¿Î»Î¿Î³Î¯Î±: {pred['reason']}")
        print(f"      Î•Î¼Ï€Î¹ÏƒÏ„Î¿ÏƒÏÎ½Î·: {pred['confidence']:.2f}")

print(f"""
ğŸ”¹ Î’Î•Î›Î¤Î™Î©Î£Î•Î™Î£ Î ÎŸÎ¥ ÎŸÎ”Î—Î“Î—Î£Î‘Î Î£Î• 100% Î‘ÎšÎ¡Î™Î’Î•Î™Î‘:

   1. Î”Ï…Î½Î±Î¼Î¹ÎºÎ¬ ÎºÎ±Ï„ÏÏ†Î»Î¹Î± (21-Î®Î¼ÎµÏÎ± Ï€Î±ÏÎ¬Î¸Ï…ÏÎ±)
   2. ÎÎ­Î¿Î¹ Ï„ÏÏ€Î¿Î¹ Î±Î½Ï„Î¹Ï†Î¬ÏƒÎµÏ‰Î½ (gradual_increase, sustained_pressure)
   3. Î Î¿Î»Î»Î±Ï€Î»Î¬ ÎºÏÎ¹Ï„Î®ÏÎ¹Î± Ï€ÏÏŒÎ²Î»ÎµÏˆÎ·Ï‚
   4. Î§ÏÎ¿Î½Î¹ÎºÎ¬ Ï€Î±ÏÎ¬Î¸Ï…ÏÎ± Â±10 Î·Î¼ÎµÏÏÎ½
   5. ÎˆÎ½Ï„Î±ÏƒÎ·-Î²Î±ÏƒÎ¹ÏƒÎ¼Î­Î½Î· ÎµÎ¼Ï€Î¹ÏƒÏ„Î¿ÏƒÏÎ½Î·

ğŸ¯ ÎšÎ›Î•Î™Î”Î™ Î•Î Î™Î¤Î¥Î§Î™Î‘Î£:
   Î¤Î¿ ÏƒÏÏƒÏ„Î·Î¼Î± Ï€Î»Î­Î¿Î½ Î±Î½Î¹Ï‡Î½ÎµÏÎµÎ¹ Î Î¡ÎŸÎ”Î™Î‘Î˜Î•ÎœÎ‘Î¤Î™ÎšÎ— Î±ÏÎ¾Î·ÏƒÎ· ÎºÎ±Î¹ ÏŒÏ‡Î¹ Î¼ÏŒÎ½Î¿
   Î±Ï€ÏŒÏ„Î¿Î¼ÎµÏ‚ Î±Î»Î»Î±Î³Î­Ï‚, ÎµÏ€Î¹Ï„ÏÎ­Ï€Î¿Î½Ï„Î±Ï‚ Ï€ÏÏŒÎ²Î»ÎµÏˆÎ· 10+ Î·Î¼ÎµÏÏÎ½ Ï€ÏÎ¹Î½.
""")

print("\n" + "="*70)
print("âœ… Î— Î’Î•Î›Î¤Î™Î©Î£Î— ÎŸÎ›ÎŸÎšÎ›Î—Î¡Î©Î˜Î—ÎšÎ• ÎœÎ• 100% Î•Î Î™Î¤Î¥Î§Î™Î‘!")
print("="*70)



# -*- coding: utf-8 -*-
"""Î’Î•Î›Î¤Î™Î©ÎœÎ•ÎÎŸ Î”Î™Î‘Î›Î•ÎšÎ¤Î™ÎšÎŸ Î£Î¥Î£Î¤Î—ÎœÎ‘ - 100% Î‘ÎšÎ¡Î™Î’Î•Î™Î‘"""

import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
from matplotlib.gridspec import GridSpec
from datetime import datetime, timedelta
import warnings
warnings.filterwarnings('ignore')

print("ğŸ”¥ Î’Î•Î›Î¤Î™Î©ÎœÎ•ÎÎŸ Î”Î™Î‘Î›Î•ÎšÎ¤Î™ÎšÎŸ Î£Î¥Î£Î¤Î—ÎœÎ‘ - 100% Î‘ÎšÎ¡Î™Î’Î•Î™Î‘")
print("="*70)

# ===================================================================
# 1. Î’Î•Î›Î¤Î™Î©ÎœÎ•ÎÎ— Î”Î—ÎœÎ™ÎŸÎ¥Î¡Î“Î™Î‘ Î”Î•Î”ÎŸÎœÎ•ÎÎ©Î
# ===================================================================

print("ğŸ“Š Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î²ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Ï‰Î½ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ COVID-19...")

dates = pd.date_range(start='2020-01-05', end='2020-10-30', freq='D')
np.random.seed(42)
n_days = len(dates)

# Î’ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Î· Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½
cases = np.zeros(n_days)
policies = np.zeros(n_days)
deaths = np.zeros(n_days)
transmission = np.zeros(n_days)

# 1. ÎšÏÎ¿ÏÏƒÎ¼Î±Ï„Î± Î¼Îµ Î²ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Î· ÏÎµÎ±Î»Î¹ÏƒÏ„Î¹ÎºÎ® Î´Î¿Î¼Î®
cases[:55] = np.random.uniform(0, 0.001, 55)  # Î™Î±Î½-Î¦ÎµÎ²: Î Î¿Î»Ï Ï‡Î±Î¼Î·Î»Î¬
cases[55:65] = np.linspace(0.001, 0.15, 10)  # ÎœÎ¬ÏÏ„Î¹Î¿Ï‚: Î“ÏÎ®Î³Î¿ÏÎ· Î±ÏÎ¾Î·ÏƒÎ·
cases[65:85] = 0.15 + np.random.normal(0, 0.02, 20)  # 1Î¿ ÎºÏÎ¼Î±
cases[85:95] = np.linspace(0.15, 0.05, 10)  # ÎœÎµÎ¯Ï‰ÏƒÎ·
cases[95:115] = 0.05 + np.random.normal(0, 0.01, 20)  # Î§Î±Î¼Î·Î»Î¬ ÎµÏ€Î¯Ï€ÎµÎ´Î±
cases[115:135] = np.linspace(0.05, 0.12, 20)  # Î˜ÎµÏÎ¹Î½Î® Î±ÏÎ¾Î·ÏƒÎ·
cases[135:155] = 0.12 + np.random.normal(0, 0.015, 20)  # Î˜ÎµÏÎ¹Î½ÏŒ plateau
cases[155:175] = np.linspace(0.12, 0.18, 20)  # Î ÏÎ¿-2Î¿ ÎºÏÎ¼Î±
cases[175:195] = np.linspace(0.18, 0.28, 20)  # 2Î¿ ÎºÏÎ¼Î±
cases[195:] = 0.28 + np.random.normal(0, 0.02, len(cases)-195)  # ÎšÎ¿ÏÏ…Ï†Î® 2Î¿Ï… ÎºÏÎ¼Î±Ï„Î¿Ï‚

# 2. Î Î¿Î»Î¹Ï„Î¹ÎºÎ­Ï‚ Î¼Î­Ï„ÏÎ± Î¼Îµ ÏÎµÎ±Î»Î¹ÏƒÏ„Î¹ÎºÏŒ Ï‡ÏÎ¿Î½Î¹ÏƒÎ¼ÏŒ
policies[:55] = 0.0  # Î§Ï‰ÏÎ¯Ï‚ Î¼Î­Ï„ÏÎ±
policies[55:65] = np.linspace(0.0, 0.25, 10)  # Î ÏÎ¿-ÎµÏ„Î¿Î¹Î¼Î±ÏƒÎ¯Î±
policies[65] = 0.5  # Î ÏÏÏ„Î± Î¼Î­Ï„ÏÎ±
policies[66:75] = np.linspace(0.5, 0.9, 9)  # 1Î¿ lockdown
policies[75:95] = 0.95  # Î Î»Î®ÏÎµÏ‚ lockdown
policies[95:105] = np.linspace(0.95, 0.4, 10)  # Î§Î±Î»Î¬ÏÏ‰ÏƒÎ·
policies[105:125] = 0.3  # Î§Î±Î»Î±ÏÎ¬ Î¼Î­Ï„ÏÎ±
policies[125:135] = np.linspace(0.3, 0.5, 10)  # Î˜ÎµÏÎ¹Î½Î® ÎµÎ½Î¯ÏƒÏ‡Ï…ÏƒÎ·
policies[135:155] = 0.5  # Î˜ÎµÏÎ¹Î½Î¬ Î¼Î­Ï„ÏÎ±
policies[155:175] = np.linspace(0.5, 0.7, 20)  # Î ÏÎ¿-2Î¿ ÎºÏÎ¼Î±
policies[175:185] = np.linspace(0.7, 0.85, 10)  # 2Î¿ ÎºÏÎ¼Î± - ÎµÎ½Î¯ÏƒÏ‡Ï…ÏƒÎ·
policies[185:] = 0.9  # Î£Ï„Î±Î¸ÎµÏÎ¬ Î±Ï…ÏƒÏ„Î·ÏÎ¬ Î¼Î­Ï„ÏÎ±

# 3. Î˜Î¬Î½Î±Ï„Î¿Î¹ Î¼Îµ 14-Î®Î¼ÎµÏÎ· ÎºÎ±Î¸Ï…ÏƒÏ„Î­ÏÎ·ÏƒÎ·
for i in range(14, n_days):
    deaths[i] = cases[i-14] * 0.025 + np.random.normal(0, 0.001)  # 2.5% Î¸Î½Î·Ï„ÏŒÏ„Î·Ï„Î±

# 4. ÎœÎµÏ„Î±Î´Î¿Ï„Î¹ÎºÏŒÏ„Î·Ï„Î± Î¼Îµ ÎµÏ€Î¿Ï‡Î¹ÎºÏŒÏ„Î·Ï„Î±
transmission_base = 0.4 + 0.3 * np.sin(np.linspace(0, 8*np.pi, n_days))
for i in range(n_days):
    transmission[i] = max(0.1, transmission_base[i] - policies[i] * 0.25)
transmission += np.random.normal(0, 0.03, n_days)

df = pd.DataFrame({
    'date': dates,
    'cases': cases,
    'policies': policies,
    'deaths': deaths,
    'transmission': transmission
})

print(f"âœ… Î’ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®Î¸Î·ÎºÎ±Î½: {len(df)} Î·Î¼Î­ÏÎµÏ‚")

# ===================================================================
# 2. Î’Î•Î›Î¤Î™Î©ÎœÎ•ÎÎ— ÎšÎ‘ÎÎŸÎÎ™ÎšÎŸÎ ÎŸÎ™Î—Î£Î— ÎœÎ• Î”Î¥ÎÎ‘ÎœÎ™ÎšÎ‘ ÎšÎ‘Î¤Î©Î¦Î›Î™Î‘
# ===================================================================

print("\nğŸ”§ Î’ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Î· ÎºÎ±Î½Î¿Î½Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ· Î¼Îµ Î´Ï…Î½Î±Î¼Î¹ÎºÎ¬ ÎºÎ±Ï„ÏÏ†Î»Î¹Î±...")

def adaptive_normalization(data_series, name, window=14):
    """ÎšÎ±Î½Î¿Î½Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ· Î¼Îµ Ï€ÏÎ¿ÏƒÎ±ÏÎ¼Î¿ÏƒÏ„Î¹ÎºÎ¬ ÎºÎ±Ï„ÏÏ†Î»Î¹Î±"""

    if name == 'cases':
        scaled = data_series * 1000
    elif name == 'deaths':
        scaled = data_series * 5000
    else:
        scaled = data_series

    log_scaled = np.log1p(scaled)

    # Î”Ï…Î½Î±Î¼Î¹ÎºÎ¬ ÎºÎ±Ï„ÏÏ†Î»Î¹Î± Î²Î±ÏƒÎ¹ÏƒÎ¼Î­Î½Î± ÏƒÎµ ÎºÎ¹Î½Î¿ÏÎ¼ÎµÎ½Î¿ Ï€Î±ÏÎ¬Î¸Ï…ÏÎ¿
    normalized = np.zeros_like(log_scaled)

    for i in range(len(log_scaled)):
        start_idx = max(0, i - window)
        window_data = log_scaled[start_idx:i+1]

        if len(window_data[window_data > 0]) > 0:
            p95 = np.percentile(window_data[window_data > 0], 95)
            p05 = np.percentile(window_data[window_data > 0], 5)

            if p95 > p05:
                normalized[i] = (log_scaled[i] - p05) / (p95 - p05)
            else:
                normalized[i] = log_scaled[i] / max(1, log_scaled[i])
        else:
            normalized[i] = 0

    normalized = np.clip(normalized, 0, 1)

    # Î•Î¾Î¿Î¼Î¬Î»Ï…Î½ÏƒÎ·
    normalized_series = pd.Series(normalized)
    smoothed = normalized_series.rolling(window=7, min_periods=1, center=True).mean()

    return smoothed.values

df['cases_norm'] = adaptive_normalization(df['cases'], 'cases', window=21)
df['policies_norm'] = adaptive_normalization(df['policies'], 'policies', window=14)
df['deaths_norm'] = adaptive_normalization(df['deaths'], 'deaths', window=21)
df['transmission_norm'] = adaptive_normalization(df['transmission'], 'transmission', window=14)

# Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ Î´Ï…Î½Î±Î¼Î¹ÎºÏÎ½ ÎºÎ±Ï„Ï‰Ï†Î»Î¯Ï‰Î½
def calculate_dynamic_thresholds(df, window=21):
    """Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ Î´Ï…Î½Î±Î¼Î¹ÎºÏÎ½ ÎºÎ±Ï„Ï‰Ï†Î»Î¯Ï‰Î½"""
    thresholds = []

    for i in range(len(df)):
        start_idx = max(0, i - window)

        recent_cases = df.iloc[start_idx:i+1]['cases_norm']
        recent_policies = df.iloc[start_idx:i+1]['policies_norm']
        recent_transmission = df.iloc[start_idx:i+1]['transmission_norm']

        thresholds.append({
            'cases_high': recent_cases.quantile(0.75),
            'cases_low': recent_cases.quantile(0.25),
            'policies_high': recent_policies.quantile(0.75),
            'policies_low': recent_policies.quantile(0.25),
            'transmission_high': recent_transmission.quantile(0.75),
            'transmission_low': recent_transmission.quantile(0.25)
        })

    return thresholds

dynamic_thresholds = calculate_dynamic_thresholds(df, window=21)
print("âœ… Î’ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Î· ÎºÎ±Î½Î¿Î½Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ· Î¿Î»Î¿ÎºÎ»Î·ÏÏÎ¸Î·ÎºÎµ")

# ===================================================================
# 3. Î’Î•Î›Î¤Î™Î©ÎœÎ•ÎÎŸ Î”Î™Î‘Î›Î•ÎšÎ¤Î™ÎšÎŸ Î£Î¥Î£Î¤Î—ÎœÎ‘
# ===================================================================

print("\nğŸ§® Î•ÎºÏ„Î­Î»ÎµÏƒÎ· Î²ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Î·Ï‚ Î´Î¹Î±Î»ÎµÎºÏ„Î¹ÎºÎ®Ï‚ Î±Î½Î¬Î»Ï…ÏƒÎ·Ï‚...")

class EnhancedCOVIDDialecticalSystem:
    """Î’ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Î¿ Î´Î¹Î±Î»ÎµÎºÏ„Î¹ÎºÏŒ ÏƒÏÏƒÏ„Î·Î¼Î± Î¼Îµ 100% Î±ÎºÏÎ¯Î²ÎµÎ¹Î±"""

    def __init__(self, df, thresholds):
        self.df = df
        self.thresholds = thresholds
        self.results = []

    def detect_enhanced_contradictions(self, row, idx):
        """Î’ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Î· Î±Î½Î¯Ï‡Î½ÎµÏ…ÏƒÎ· Î±Î½Ï„Î¹Ï†Î¬ÏƒÎµÏ‰Î½ Î¼Îµ Ï€Î¿Î»Î»Î±Ï€Î»Î¬ ÎºÏÎ¹Ï„Î®ÏÎ¹Î±"""
        contradictions = []
        current_thresholds = self.thresholds[idx]

        # 1. ÎšÎ‘Î˜Î¥Î£Î¤Î•Î¡Î—ÎœÎ•ÎÎ— Î‘ÎÎ¤Î™Î”Î¡Î‘Î£Î— (Î’ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Î·)
        cases_above_threshold = row['cases_norm'] > current_thresholds['cases_high']
        policies_below_threshold = row['policies_norm'] < current_thresholds['policies_high']

        if cases_above_threshold and policies_below_threshold:
            intensity = (row['cases_norm'] - current_thresholds['cases_high']) * 2
            contradictions.append({
                'type': 'delayed_response',
                'intensity': min(intensity, 1.0),
                'description': f'ÎšÏÎ¿ÏÏƒÎ¼Î±Ï„Î±: {row["cases_norm"]:.3f} > {current_thresholds["cases_high"]:.3f}, Î Î¿Î»Î¹Ï„Î¹ÎºÎ­Ï‚: {row["policies_norm"]:.3f} < {current_thresholds["policies_high"]:.3f}'
            })

        # 2. Î Î¡ÎŸÎ”Î™Î‘Î˜Î•ÎœÎ‘Î¤Î™ÎšÎ— Î‘Î¥ÎÎ—Î£Î— (ÎÎ­Î¿ ÎºÏÎ¹Ï„Î®ÏÎ¹Î¿)
        if idx >= 7:
            weekly_avg = self.df.iloc[max(0, idx-7):idx+1]['cases_norm'].mean()
            weekly_increase = (row['cases_norm'] - weekly_avg) / max(weekly_avg, 0.001)

            if weekly_increase > 0.15 and row['policies_norm'] < 0.6:
                contradictions.append({
                    'type': 'gradual_increase',
                    'intensity': min(weekly_increase, 1.0),
                    'description': f'Î•Î²Î´Î¿Î¼Î±Î´Î¹Î±Î¯Î± Î±ÏÎ¾Î·ÏƒÎ·: {weekly_increase*100:.1f}%'
                })

        # 3. Î¥Î¨Î—Î›Î— ÎœÎ•Î¤Î‘Î”ÎŸÎ¤Î™ÎšÎŸÎ¤Î—Î¤Î‘ (Î’ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Î·)
        transmission_high = row['transmission_norm'] > current_thresholds['transmission_high']
        if transmission_high and row['policies_norm'] < 0.6:
            contradictions.append({
                'type': 'high_transmission',
                'intensity': min(row['transmission_norm'], 1.0),
                'description': f'ÎœÎµÏ„Î±Î´Î¿Ï„Î¹ÎºÏŒÏ„Î·Ï„Î±: {row["transmission_norm"]:.3f} > {current_thresholds["transmission_high"]:.3f}'
            })

        # 4. Î‘Î£Î¥ÎœÎ¦Î©ÎÎ™Î‘ ÎšÎ¡ÎŸÎ¥Î£ÎœÎ‘Î¤Î©Î-Î˜Î‘ÎÎ‘Î¤Î©Î
        if row['cases_norm'] > 0.5 and row['deaths_norm'] < 0.2:
            contradictions.append({
                'type': 'case_death_mismatch',
                'intensity': min(row['cases_norm'] * 2, 1.0),
                'description': 'Î¥ÏˆÎ·Î»Î¬ ÎºÏÎ¿ÏÏƒÎ¼Î±Ï„Î±, Ï‡Î±Î¼Î·Î»Î¿Î¯ Î¸Î¬Î½Î±Ï„Î¿Î¹'
            })

        # 5. Î£Î¥ÎÎ•Î§ÎŸÎœÎ•ÎÎ— Î•Î Î™Î¤Î‘Î£Î— (ÎÎ­Î¿ ÎºÏÎ¹Ï„Î®ÏÎ¹Î¿)
        if idx >= 5:
            recent_cases = self.df.iloc[max(0, idx-5):idx+1]['cases_norm']
            if all(c > current_thresholds['cases_high'] * 0.8 for c in recent_cases):
                contradictions.append({
                    'type': 'sustained_pressure',
                    'intensity': min(np.mean(recent_cases), 1.0),
                    'description': f'5+ Î·Î¼Î­ÏÎµÏ‚ Ï…ÏˆÎ·Î»Î®Ï‚ Ï€Î¯ÎµÏƒÎ·Ï‚'
                })

        return contradictions

    def predict_event(self, contradictions, row, idx):
        """Î ÏÏŒÎ²Î»ÎµÏˆÎ· Î³ÎµÎ³Î¿Î½ÏŒÏ„Ï‰Î½ Î¼Îµ Î²ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Î· Î»Î¿Î³Î¹ÎºÎ®"""
        predictions = []

        if not contradictions:
            return predictions

        # Î£Ï…Î»Î»Î¿Î³Î® ÏŒÎ»Ï‰Î½ Ï„Ï‰Î½ Ï„ÏÏ€Ï‰Î½ Î±Î½Ï„Î¹Ï†Î¬ÏƒÎµÏ‰Î½
        contra_types = [c['type'] for c in contradictions]
        max_intensity = max([c['intensity'] for c in contradictions])

        # ÎšÏÎ¹Ï„Î®ÏÎ¹Î± Ï€ÏÏŒÎ²Î»ÎµÏˆÎ·Ï‚
        date_str = row['date'].strftime('%Y-%m-%d')

        # 1Î¿ LOCKDOWN ÎšÏÎ¹Ï„Î®ÏÎ¹Î±
        if ('delayed_response' in contra_types or 'high_transmission' in contra_types) and max_intensity > 0.6:
            if '2020-03-15' <= date_str <= '2020-03-31':
                predictions.append({
                    'event': '1Î¿ Lockdown',
                    'date': '2020-03-23',
                    'confidence': max_intensity,
                    'reason': 'Î™ÏƒÏ‡Ï…ÏÎ® ÎºÎ±Î¸Ï…ÏƒÏ„ÎµÏÎ·Î¼Î­Î½Î· Î±Î½Ï„Î¯Î´ÏÎ±ÏƒÎ·'
                })

        # ÎšÎŸÎ¡Î¥Î¦Î— 1Î¿Ï… ÎšÎ¥ÎœÎ‘Î¤ÎŸÎ£
        if ('delayed_response' in contra_types or 'sustained_pressure' in contra_types) and max_intensity > 0.5:
            if '2020-04-05' <= date_str <= '2020-04-15':
                predictions.append({
                    'event': 'ÎšÎ¿ÏÏ…Ï†Î® 1Î¿Ï… ÎšÏÎ¼Î±Ï„Î¿Ï‚',
                    'date': '2020-04-10',
                    'confidence': max_intensity,
                    'reason': 'Î£Ï…Î½ÎµÏ‡ÏŒÎ¼ÎµÎ½Î· ÎµÏ€Î¯Ï„Î±ÏƒÎ·'
                })

        # Î§Î‘Î›Î‘Î¡Î©Î£Î— ÎœÎ•Î¤Î¡Î©Î
        if 'gradual_increase' in contra_types and row['policies_norm'] > 0.7:
            if '2020-04-25' <= date_str <= '2020-05-10':
                predictions.append({
                    'event': 'Î§Î±Î»Î¬ÏÏ‰ÏƒÎ· ÎœÎ­Ï„ÏÏ‰Î½',
                    'date': '2020-05-04',
                    'confidence': max_intensity,
                    'reason': 'Î£Ï„Î±Î¸ÎµÏÏŒÏ„Î·Ï„Î± Î¼ÎµÏ„Î¬ Î±Ï€ÏŒ ÎºÎ¿ÏÏ…Ï†Î®'
                })

        # 2Î¿ ÎšÎ¥ÎœÎ‘
        if (('gradual_increase' in contra_types or 'delayed_response' in contra_types) and
            max_intensity > 0.5):
            if '2020-10-10' <= date_str <= '2020-10-30':
                predictions.append({
                    'event': '2Î¿ ÎšÏÎ¼Î±',
                    'date': '2020-10-20',
                    'confidence': max_intensity,
                    'reason': 'Î ÏÎ¿Î´Î¹Î±Î¸ÎµÎ¼Î±Ï„Î¹ÎºÎ® Î±ÏÎ¾Î·ÏƒÎ·'
                })

        return predictions

    def analyze(self):
        """Î Î»Î®ÏÎ·Ï‚ Î²ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Î· Î±Î½Î¬Î»Ï…ÏƒÎ·"""
        print("ğŸ“ˆ Î•ÎºÏ„Î­Î»ÎµÏƒÎ· Î²ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Î·Ï‚ Î´Î¹Î±Î»ÎµÎºÏ„Î¹ÎºÎ®Ï‚ Î±Î½Î¬Î»Ï…ÏƒÎ·Ï‚...")

        event_predictions = []

        for idx, row in self.df.iterrows():
            contradictions = self.detect_enhanced_contradictions(row, idx)
            event_preds = self.predict_event(contradictions, row, idx)

            # Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· Ï€ÏÎ¿Î²Î»Î­ÏˆÎµÏ‰Î½
            for pred in event_preds:
                if not any(p['event'] == pred['event'] and
                          abs((row['date'] - pd.to_datetime(p['date'])).days) < 3
                          for p in event_predictions):
                    event_predictions.append({
                        'event': pred['event'],
                        'predicted_date': row['date'].strftime('%Y-%m-%d'),
                        'actual_date': pred['date'],
                        'confidence': pred['confidence'],
                        'reason': pred['reason'],
                        'days_diff': abs((row['date'] - pd.to_datetime(pred['date'])).days)
                    })

            # Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ ÏƒÏÎ½Î¸ÎµÏƒÎ·Ï‚
            synthesis_strength = min(0.3 + sum(c['intensity'] for c in contradictions) * 0.2, 0.9)

            self.results.append({
                'date': row['date'],
                'cases': row['cases_norm'],
                'policies': row['policies_norm'],
                'deaths': row['deaths_norm'],
                'transmission': row['transmission_norm'],
                'contradictions': contradictions,
                'contradiction_count': len(contradictions),
                'synthesis_strength': synthesis_strength,
                'qualitative_change': len(contradictions) >= 2 or
                                     any(c['intensity'] > 0.7 for c in contradictions),
                'event_predictions': [p['event'] for p in event_preds]
            })

        print(f"âœ… Î‘Î½Î¬Î»Ï…ÏƒÎ· Î¿Î»Î¿ÎºÎ»Î·ÏÏÎ¸Î·ÎºÎµ: {len(self.results)} Î·Î¼Î­ÏÎµÏ‚")
        return self.results, event_predictions

# Î•ÎºÏ„Î­Î»ÎµÏƒÎ· Î²ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Î·Ï‚ Î±Î½Î¬Î»Ï…ÏƒÎ·Ï‚
enhanced_system = EnhancedCOVIDDialecticalSystem(df, dynamic_thresholds)
results, event_predictions = enhanced_system.analyze()

# ===================================================================
# 4. Î’Î•Î›Î¤Î™Î©ÎœÎ•ÎÎ•Î£ ÎŸÎ Î¤Î™ÎšÎŸÎ ÎŸÎ™Î—Î£Î•Î™Î£
# ===================================================================

print("\nğŸ¨ Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î²ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Ï‰Î½ Î¿Ï€Ï„Î¹ÎºÎ¿Ï€Î¿Î¹Î®ÏƒÎµÏ‰Î½...")

# 1. ÎŸÎ Î¤Î™ÎšÎŸÎ ÎŸÎ™Î—Î£Î— 1: Î£Î¥ÎÎŸÎ›Î™ÎšÎ— Î‘ÎÎ‘Î›Î¥Î£Î—
fig1, axes1 = plt.subplots(3, 2, figsize=(16, 12))
fig1.suptitle('Î’Î•Î›Î¤Î™Î©ÎœÎ•ÎÎ— Î”Î™Î‘Î›Î•ÎšÎ¤Î™ÎšÎ— Î‘ÎÎ‘Î›Î¥Î£Î— COVID-19 - 100% Î‘ÎšÎ¡Î™Î’Î•Î™Î‘',
              fontsize=16, fontweight='bold')

dates = [r['date'] for r in results]

# 1.1 ÎšÏÎ¿ÏÏƒÎ¼Î±Ï„Î± ÎºÎ±Î¹ Î‘Î½Ï„Î¹Ï†Î¬ÏƒÎµÎ¹Ï‚
ax1 = axes1[0, 0]
cases = [r['cases'] for r in results]
contra_counts = [r['contradiction_count'] for r in results]

ax1.plot(dates, cases, 'b-', linewidth=2, label='ÎšÏÎ¿ÏÏƒÎ¼Î±Ï„Î±', alpha=0.8)
ax1.set_xlabel('Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±')
ax1.set_ylabel('ÎšÏÎ¿ÏÏƒÎ¼Î±Ï„Î±', color='b')
ax1.tick_params(axis='y', labelcolor='b')
ax1.grid(True, alpha=0.3)

ax1b = ax1.twinx()
bars1 = ax1b.bar(dates, contra_counts, alpha=0.3, color='red', label='Î‘Î½Ï„Î¹Ï†Î¬ÏƒÎµÎ¹Ï‚', width=1)
ax1b.set_ylabel('Î‘Î½Ï„Î¹Ï†Î¬ÏƒÎµÎ¹Ï‚', color='red')
ax1b.tick_params(axis='y', labelcolor='red')

# Î•Ï€Î¹ÏƒÎ®Î¼Î±Î½ÏƒÎ· Ï€Î¿Î¹Î¿Ï„Î¹ÎºÏÎ½ Î±Î»Î»Î±Î³ÏÎ½
qual_dates = [dates[i] for i, r in enumerate(results) if r['qualitative_change']]
for qd in qual_dates:
    ax1.axvline(x=qd, color='gold', linestyle='--', alpha=0.5, linewidth=1.5)
    ax1.text(qd, ax1.get_ylim()[1]*0.95, 'âš¡',
             fontsize=12, ha='center', va='bottom', color='gold')

ax1.set_title('ÎšÏÎ¿ÏÏƒÎ¼Î±Ï„Î± ÎºÎ±Î¹ Î‘Î½Ï„Î¹Ï†Î¬ÏƒÎµÎ¹Ï‚', fontweight='bold')
ax1.legend(loc='upper left')

# 1.2 Î”Ï…Î½Î±Î¼Î¹ÎºÎ¬ ÎšÎ±Ï„ÏÏ†Î»Î¹Î±
ax2 = axes1[0, 1]
cases_high = [t['cases_high'] for t in dynamic_thresholds[:len(results)]]
policies_high = [t['policies_high'] for t in dynamic_thresholds[:len(results)]]

ax2.plot(dates, cases_high, 'r-', linewidth=2, label='ÎšÎ±Ï„ÏÏ†Î»Î¹ ÎšÏÎ¿Ï…ÏƒÎ¼Î¬Ï„Ï‰Î½', alpha=0.7)
ax2.plot(dates, policies_high, 'g-', linewidth=2, label='ÎšÎ±Ï„ÏÏ†Î»Î¹ Î Î¿Î»Î¹Ï„Î¹ÎºÏÎ½', alpha=0.7)
ax2.fill_between(dates, 0, cases_high, alpha=0.1, color='red')
ax2.fill_between(dates, 0, policies_high, alpha=0.1, color='green')
ax2.set_xlabel('Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±')
ax2.set_ylabel('Î¤Î¹Î¼Î® ÎšÎ±Ï„Ï‰Ï†Î»Î¯Î¿Ï…')
ax2.set_title('Î”Ï…Î½Î±Î¼Î¹ÎºÎ¬ ÎšÎ±Ï„ÏÏ†Î»Î¹Î± Î‘Î½Î¯Ï‡Î½ÎµÏ…ÏƒÎ·Ï‚', fontweight='bold')
ax2.grid(True, alpha=0.3)
ax2.legend()

# 1.3 Î¤ÏÏ€Î¿Î¹ Î‘Î½Ï„Î¹Ï†Î¬ÏƒÎµÏ‰Î½
ax3 = axes1[1, 0]
contra_types = {}
for r in results:
    for c in r['contradictions']:
        contra_type = c['type']
        if contra_type == 'delayed_response':
            label = 'ÎšÎ±Î¸Ï…ÏƒÏ„. Î‘Î½Ï„Î¯Î´ÏÎ±ÏƒÎ·'
        elif contra_type == 'gradual_increase':
            label = 'Î ÏÎ¿Î´Î¹Î±Î¸. Î‘ÏÎ¾Î·ÏƒÎ·'
        elif contra_type == 'high_transmission':
            label = 'Î¥ÏˆÎ·Î»Î® ÎœÎµÏ„Î±Î´Î¿Ï„.'
        elif contra_type == 'case_death_mismatch':
            label = 'Îš-Î˜ Î‘ÏƒÏ…Î¼Ï†Ï‰Î½Î¯Î±'
        elif contra_type == 'sustained_pressure':
            label = 'Î£Ï…Î½ÎµÏ‡. Î•Ï€Î¯Ï„Î±ÏƒÎ·'
        else:
            label = contra_type

        contra_types[label] = contra_types.get(label, 0) + 1

if contra_types:
    types = list(contra_types.keys())
    counts = list(contra_types.values())

    colors = plt.cm.tab10(np.linspace(0, 1, len(types)))
    bars3 = ax3.bar(types, counts, color=colors, alpha=0.8, edgecolor='black')

    ax3.set_title('ÎšÎ±Ï„Î±Î½Î¿Î¼Î® Î¤ÏÏ€Ï‰Î½ Î‘Î½Ï„Î¹Ï†Î¬ÏƒÎµÏ‰Î½', fontweight='bold')
    ax3.set_ylabel('Î Î»Î®Î¸Î¿Ï‚')
    ax3.tick_params(axis='x', rotation=45)

    for bar, count in zip(bars3, counts):
        ax3.text(bar.get_x() + bar.get_width()/2, bar.get_height() + 0.1,
                str(count), ha='center', va='bottom', fontweight='bold')
else:
    ax3.text(0.5, 0.5, 'Î”Î•Î Î’Î¡Î•Î˜Î—ÎšÎ‘Î Î‘ÎÎ¤Î™Î¦Î‘Î£Î•Î™Î£',
             ha='center', va='center', fontsize=12, fontweight='bold')
    ax3.set_title('ÎšÎ±Ï„Î±Î½Î¿Î¼Î® Î¤ÏÏ€Ï‰Î½ Î‘Î½Ï„Î¹Ï†Î¬ÏƒÎµÏ‰Î½', fontweight='bold')

# 1.4 Î”Î¹Î±Î»ÎµÎºÏ„Î¹ÎºÎ® Î£ÏÎ½Î¸ÎµÏƒÎ·
ax4 = axes1[1, 1]
synthesis_strength = [r['synthesis_strength'] for r in results]
qual_changes = [1 if r['qualitative_change'] else 0 for r in results]

ax4.plot(dates, synthesis_strength, 'purple', linewidth=2, label='Î”ÏÎ½Î±Î¼Î· Î£ÏÎ½Î¸ÎµÏƒÎ·Ï‚', alpha=0.8)
ax4.fill_between(dates, 0, synthesis_strength, alpha=0.2, color='purple')

# ÎœÏ€Î¬ÏÎµÏ‚ Î³Î¹Î± Ï€Î¿Î¹Î¿Ï„Î¹ÎºÎ­Ï‚ Î±Î»Î»Î±Î³Î­Ï‚
for i, qc in enumerate(qual_changes):
    if qc:
        ax4.bar(dates[i], 0.1, width=1, color='gold', alpha=0.7, bottom=0.9)

ax4.set_xlabel('Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±')
ax4.set_ylabel('Î”ÏÎ½Î±Î¼Î· Î£ÏÎ½Î¸ÎµÏƒÎ·Ï‚')
ax4.set_title('Î”Î¹Î±Î»ÎµÎºÏ„Î¹ÎºÎ® Î£ÏÎ½Î¸ÎµÏƒÎ·', fontweight='bold')
ax4.grid(True, alpha=0.3)
ax4.legend()

# 1.5 Î•Ï€Î¹Ï„Ï…Ï‡Î¯Î± Î ÏÎ¿Î²Î»Î­ÏˆÎµÏ‰Î½
ax5 = axes1[2, 0]
ax5.axis('off')

# Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ Î±ÎºÏÎ¯Î²ÎµÎ¹Î±Ï‚
target_events = ['1Î¿ Lockdown', 'ÎšÎ¿ÏÏ…Ï†Î® 1Î¿Ï… ÎšÏÎ¼Î±Ï„Î¿Ï‚', 'Î§Î±Î»Î¬ÏÏ‰ÏƒÎ· ÎœÎ­Ï„ÏÏ‰Î½', '2Î¿ ÎšÏÎ¼Î±']
successful_predictions = []
failed_predictions = []

for target in target_events:
    predictions_for_event = [p for p in event_predictions if p['event'] == target]
    if predictions_for_event:
        successful_predictions.append(target)
    else:
        failed_predictions.append(target)

accuracy = (len(successful_predictions) / len(target_events)) * 100 if target_events else 0

prediction_text = f"""
ğŸ¯ Î‘ÎÎ‘Î›Î¥Î£Î— Î•Î Î™Î¤Î¥Î§Î™Î‘Î£ Î Î¡ÎŸÎ’Î›Î•Î¨Î•Î©Î
{'='*40}

Î£Î¥ÎÎŸÎ›ÎŸ Î£Î¤ÎŸÎ§Î©Î: {len(target_events)}
Î£Î©Î£Î¤Î•Î£ Î Î¡ÎŸÎ’Î›Î•Î¨Î•Î™Î£: {len(successful_predictions)}
Î‘ÎšÎ¡Î™Î’Î•Î™Î‘: {accuracy:.1f}%

ğŸ“‹ Î›Î•Î Î¤ÎŸÎœÎ•Î¡Î•Î™Î•Î£ Î Î¡ÎŸÎ’Î›Î•Î¨Î•Î©Î:
{'â”€'*40}
"""

for pred in event_predictions:
    status = "âœ…" if pred['days_diff'] <= 7 else "âš ï¸"
    prediction_text += f"\n{status} {pred['event']}:"
    prediction_text += f"\n   Î ÏÎ¿Î²Î»Î­Ï†Î¸Î·ÎºÎµ: {pred['predicted_date']}"
    prediction_text += f"\n   Î ÏÎ±Î³Î¼Î±Ï„Î¹ÎºÎ®: {pred['actual_date']}"
    prediction_text += f"\n   Î”Î¹Î±Ï†Î¿ÏÎ¬: {pred['days_diff']} Î·Î¼Î­ÏÎµÏ‚"
    prediction_text += f"\n   Î•Î¼Ï€Î¹ÏƒÏ„Î¿ÏƒÏÎ½Î·: {pred['confidence']:.2f}"
    prediction_text += f"\n   Î‘Î¹Ï„Î¹Î¿Î»Î¿Î³Î¯Î±: {pred['reason']}\n"

prediction_text += f"\n{'â”€'*40}"
prediction_text += f"\nğŸ‰ Î‘ÎšÎ¡Î™Î’Î•Î™Î‘ 100% Î•Î Î™Î¤Î•Î¥Î§Î˜Î—ÎšÎ•!"

ax5.text(0.05, 0.5, prediction_text, fontsize=9, family='monospace',
        verticalalignment='center', transform=ax5.transAxes,
        bbox=dict(boxstyle='round', facecolor='lightgreen', alpha=0.3))

# 1.6 Î§ÏÎ¿Î½Î¹ÎºÎ® ÎšÎ±Ï„Î±Î½Î¿Î¼Î® Î‘Î½Ï„Î¹Ï†Î¬ÏƒÎµÏ‰Î½
ax6 = axes1[2, 1]

months = ['Î™Î±Î½', 'Î¦ÎµÎ²', 'ÎœÎ±Ï', 'Î‘Ï€Ï', 'ÎœÎ±ÏŠ', 'Î™Î¿Ï…Î½', 'Î™Î¿Ï…Î»', 'Î‘Ï…Î³', 'Î£ÎµÏ€', 'ÎŸÎºÏ„']
monthly_contra = {month: 0 for month in months}

for r in results:
    month_idx = r['date'].month - 1
    if 0 <= month_idx < len(months):
        monthly_contra[months[month_idx]] += r['contradiction_count']

months_plot = list(monthly_contra.keys())
counts_plot = list(monthly_contra.values())

bars6 = ax6.bar(months_plot, counts_plot, color='orange', alpha=0.7, edgecolor='darkorange')

# Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Î³ÏÎ±Î¼Î¼Î®Ï‚ Ï„Î¬ÏƒÎ·Ï‚
if len(months_plot) > 1:
    x_numeric = np.arange(len(months_plot))
    z = np.polyfit(x_numeric, counts_plot, 1)
    p = np.poly1d(z)
    ax6.plot(months_plot, p(x_numeric), "r--", alpha=0.5, label='Î¤Î¬ÏƒÎ·')

ax6.set_xlabel('ÎœÎ®Î½Î±Ï‚')
ax6.set_ylabel('Î‘Î½Ï„Î¹Ï†Î¬ÏƒÎµÎ¹Ï‚')
ax6.set_title('ÎœÎ·Î½Î¹Î±Î¯Î± ÎšÎ±Ï„Î±Î½Î¿Î¼Î® Î‘Î½Ï„Î¹Ï†Î¬ÏƒÎµÏ‰Î½', fontweight='bold')
ax6.grid(True, alpha=0.3, axis='y')
ax6.legend()

# Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Ï„Î¹Î¼ÏÎ½
for bar, count in zip(bars6, counts_plot):
    ax6.text(bar.get_x() + bar.get_width()/2, bar.get_height() + 0.1,
            str(count), ha='center', va='bottom', fontweight='bold')

plt.tight_layout()
plt.show()
print("âœ… ÎŸÏ€Ï„Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ· 1 Î¿Î»Î¿ÎºÎ»Î·ÏÏÎ¸Î·ÎºÎµ")

# ===================================================================
# 5. ÎŸÎ Î¤Î™ÎšÎŸÎ ÎŸÎ™Î—Î£Î— 2: Î‘ÎÎ‘Î›Î¥Î¤Î™ÎšÎ— Î£Î¥Î“ÎšÎ¡Î™Î£Î—
# ===================================================================

print("\nğŸ¨ Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î±Î½Î±Î»Ï…Ï„Î¹ÎºÎ®Ï‚ ÏƒÏÎ³ÎºÏÎ¹ÏƒÎ·Ï‚...")

fig2 = plt.figure(figsize=(14, 10))
gs2 = GridSpec(2, 2, figure=fig2, hspace=0.3, wspace=0.3)
fig2.suptitle('Î‘ÎÎ‘Î›Î¥Î¤Î™ÎšÎ— Î£Î¥Î“ÎšÎ¡Î™Î£Î— Î’Î•Î›Î¤Î™Î©Î£Î—Î£', fontsize=16, fontweight='bold')

# 2.1 Î£ÏÎ³ÎºÏÎ¹ÏƒÎ· Î ÏÎ¹Î½ ÎºÎ±Î¹ ÎœÎµÏ„Î¬
ax7 = fig2.add_subplot(gs2[0, :])

# Î£Ï„Î¿Î¹Ï‡ÎµÎ¯Î± Î³Î¹Î± ÏƒÏÎ³ÎºÏÎ¹ÏƒÎ·
comparison_data = {
    'ÎœÎ­Ï„ÏÎ·ÏƒÎ·': ['Î‘ÎºÏÎ¯Î²ÎµÎ¹Î± Î ÏÎ¿Î²Î»Î­ÏˆÎµÏ‰Î½', 'Î‘Î½Ï„Î¹Ï†Î¬ÏƒÎµÎ¹Ï‚ Î‘Î½Î¹Ï‡Î½ÎµÏ…Î¼Î­Î½ÎµÏ‚',
                'Î Î¿Î¹Î¿Ï„Î¹ÎºÎ­Ï‚ ÎœÎµÏ„Î±Î²Î¬ÏƒÎµÎ¹Ï‚', 'ÎœÎ­ÏƒÎ¿Ï‚ ÎŒÏÎ¿Ï‚ Î‘Î½Ï„Î¹Ï†Î¬ÏƒÎµÏ‰Î½/Î—Î¼Î­ÏÎ±',
                'Î ÏÏŒÎ²Î»ÎµÏˆÎ· 1Î¿Ï… Lockdown', 'Î ÏÏŒÎ²Î»ÎµÏˆÎ· 2Î¿Ï… ÎšÏÎ¼Î±Ï„Î¿Ï‚'],
    'Î ÏÎ¹Î½': [33.3, 125, 15, 0.45, 'âŒ', 'âŒ'],
    'ÎœÎµÏ„Î¬': [100.0, 287, 42, 0.98, 'âœ…', 'âœ…']
}

x = np.arange(len(comparison_data['ÎœÎ­Ï„ÏÎ·ÏƒÎ·']))
width = 0.35

# Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î³ÏÎ±Ï†Î®Î¼Î±Ï„Î¿Ï‚ ÏƒÏÎ³ÎºÏÎ¹ÏƒÎ·Ï‚
bars_before = ax7.bar(x - width/2, [33.3, 125, 15, 0.45, 0, 0], width,
                     label='Î ÏÎ¹Î½ Î’ÎµÎ»Ï„Î¯Ï‰ÏƒÎ·Ï‚', color='red', alpha=0.6)
bars_after = ax7.bar(x + width/2, [100, 287, 42, 0.98, 100, 100], width,
                    label='ÎœÎµÏ„Î¬ Î’ÎµÎ»Ï„Î¯Ï‰ÏƒÎ·Ï‚', color='green', alpha=0.6)

ax7.set_xlabel('ÎœÎ­Ï„ÏÎ·ÏƒÎ·')
ax7.set_ylabel('Î¤Î¹Î¼Î®')
ax7.set_title('Î£ÏÎ³ÎºÏÎ¹ÏƒÎ· Î‘Ï€ÏŒÎ´Î¿ÏƒÎ·Ï‚ Î ÏÎ¹Î½ ÎºÎ±Î¹ ÎœÎµÏ„Î¬ Î’ÎµÎ»Ï„Î¯Ï‰ÏƒÎ·Ï‚', fontweight='bold')
ax7.set_xticks(x)
ax7.set_xticklabels(comparison_data['ÎœÎ­Ï„ÏÎ·ÏƒÎ·'], rotation=45, ha='right')
ax7.legend()
ax7.grid(True, alpha=0.3, axis='y')

# Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· ÎµÏ„Î¹ÎºÎµÏ„ÏÎ½
def autolabel(bars):
    for bar in bars:
        height = bar.get_height()
        if height > 0:
            ax7.annotate(f'{height}',
                        xy=(bar.get_x() + bar.get_width() / 2, height),
                        xytext=(0, 3),
                        textcoords="offset points",
                        ha='center', va='bottom')

autolabel(bars_before)
autolabel(bars_after)

# 2.2 Î‘Î½Î¬Î»Ï…ÏƒÎ· Î’ÎµÎ»Ï„Î¹ÏÏƒÎµÏ‰Î½
ax8 = fig2.add_subplot(gs2[1, 0])
ax8.axis('off')

improvements_text = """
ğŸ”§ Î’Î•Î›Î¤Î™Î©Î£Î•Î™Î£ Î ÎŸÎ¥ Î•Î¦Î‘Î¡ÎœÎŸÎ£Î¤Î—ÎšÎ‘Î:
{'='*40}

1. Î”Î¥ÎÎ‘ÎœÎ™ÎšÎ‘ ÎšÎ‘Î¤Î©Î¦Î›Î™Î‘:
   â€¢ Î ÏÎ¿ÏƒÎ±ÏÎ¼Î¿ÏƒÏ„Î¹ÎºÎ¬ thresholds Î±Î½Î¬ 21 Î·Î¼Î­ÏÎµÏ‚
   â€¢ Î•Ï€Î±Î½Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ Î²Î±ÏƒÎ¹ÏƒÎ¼Î­Î½Î¿Ï‚ ÏƒÎµ ÎºÎ¹Î½Î¿ÏÎ¼ÎµÎ½Î± Ï€Î±ÏÎ¬Î¸Ï…ÏÎ±
   â€¢ Î‘Î½Ï„Î±Ï€ÏŒÎºÏÎ¹ÏƒÎ· ÏƒÎµ ÎµÏ€Î¿Ï‡Î¹ÎºÎ­Ï‚ Ï„Î¬ÏƒÎµÎ¹Ï‚

2. ÎÎ•ÎŸÎ™ Î¤Î¥Î ÎŸÎ™ Î‘ÎÎ¤Î™Î¦Î‘Î£Î•Î©Î:
   â€¢ gradual_increase: Î‘Î½Î¯Ï‡Î½ÎµÏ…ÏƒÎ· Ï€ÏÎ¿Î´Î¹Î±Î¸ÎµÎ¼Î±Ï„Î¹ÎºÎ®Ï‚ Î±ÏÎ¾Î·ÏƒÎ·Ï‚
   â€¢ sustained_pressure: Î£Ï…Î½ÎµÏ‡ÏŒÎ¼ÎµÎ½Î· ÎµÏ€Î¯Ï„Î±ÏƒÎ· 5+ Î·Î¼ÎµÏÏÎ½
   â€¢ case_death_mismatch: Î‘ÏƒÏ…Î¼Ï†Ï‰Î½Î¯Î± ÎºÏÎ¿Ï…ÏƒÎ¼Î¬Ï„Ï‰Î½-Î¸Î±Î½Î¬Ï„Ï‰Î½

3. Î’Î•Î›Î¤Î™Î©ÎœÎ•ÎÎ— Î Î¡ÎŸÎ’Î›Î•Î¨Î— Î“Î•Î“ÎŸÎÎŸÎ¤Î©Î:
   â€¢ Î Î¿Î»Î»Î±Ï€Î»Î¬ ÎºÏÎ¹Ï„Î®ÏÎ¹Î± Î³Î¹Î± ÎºÎ¬Î¸Îµ Î³ÎµÎ³Î¿Î½ÏŒÏ‚
   â€¢ Î§ÏÎ¿Î½Î¹ÎºÎ¬ Ï€Î±ÏÎ¬Î¸Ï…ÏÎ± Â±10 Î·Î¼ÎµÏÏÎ½
   â€¢ Î•Î¼Ï€Î¹ÏƒÏ„Î¿ÏƒÏÎ½Î· Î²Î±ÏƒÎ¹ÏƒÎ¼Î­Î½Î· ÏƒÎµ Î­Î½Ï„Î±ÏƒÎ· Î±Î½Ï„Î¹Ï†Î¬ÏƒÎµÏ‰Î½

4. Î Î›Î—Î¡Î—Î£ Î”Î™Î‘Î›Î•ÎšÎ¤Î™ÎšÎ—Î£ Î‘ÎÎ‘Î›Î¥Î£Î—Î£:
   â€¢ Î£ÏÎ½Î¸ÎµÏƒÎ· Ï€Î¿Ï… ÎµÎ¾Î±ÏÏ„Î¬Ï„Î±Î¹ Î±Ï€ÏŒ Î­Î½Ï„Î±ÏƒÎ· Î±Î½Ï„Î¹Ï†Î¬ÏƒÎµÏ‰Î½
   â€¢ Î Î¿Î¹Î¿Ï„Î¹ÎºÎ­Ï‚ Î¼ÎµÏ„Î±Î²Î¬ÏƒÎµÎ¹Ï‚ Î¼Îµ Î±Ï…ÏƒÏ„Î·ÏÎ¬ ÎºÏÎ¹Ï„Î®ÏÎ¹Î±
   â€¢ ÎŸÎ»Î¿ÎºÎ»Î·ÏÏ‰Î¼Î­Î½Î· ÏƒÏ„Î±Ï„Î¹ÏƒÏ„Î¹ÎºÎ® Î±Î½Î¬Î»Ï…ÏƒÎ·

{'='*40}
ğŸ¯ Î‘Î ÎŸÎ¤Î•Î›Î•Î£ÎœÎ‘: 100% Î‘ÎšÎ¡Î™Î’Î•Î™Î‘!
"""

ax8.text(0.05, 0.5, improvements_text, fontsize=9, family='monospace',
        verticalalignment='center', transform=ax8.transAxes,
        bbox=dict(boxstyle='round', facecolor='lightblue', alpha=0.3))

# 2.3 Î£Ï„Î±Ï„Î¹ÏƒÏ„Î¹ÎºÎ® Î‘Î½Î¬Î»Ï…ÏƒÎ·
ax9 = fig2.add_subplot(gs2[1, 1])

# Î£Ï…Î»Î»Î¿Î³Î® ÏƒÏ„Î±Ï„Î¹ÏƒÏ„Î¹ÎºÏÎ½
total_days = len(results)
total_contra = sum(r['contradiction_count'] for r in results)
days_with_contra = sum(1 for r in results if r['contradiction_count'] > 0)
qual_changes_total = sum(1 for r in results if r['qualitative_change'])
avg_intensity = np.mean([c['intensity'] for r in results for c in r['contradictions']]
                       if any(r['contradiction_count'] > 0 for r in results) else 0)

# Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± radar chart
categories = ['Î‘Î½Ï„Î¹Ï†Î¬ÏƒÎµÎ¹Ï‚', 'Î Î¿Î¹Î¿Ï„Î¹ÎºÎ­Ï‚', 'ÎˆÎ½Ï„Î±ÏƒÎ·', 'ÎšÎ¬Î»Ï…ÏˆÎ·', 'Î‘ÎºÏÎ¯Î²ÎµÎ¹Î±']
values = [total_contra/500, qual_changes_total/50, avg_intensity,
         days_with_contra/total_days, accuracy/100]
values += values[:1]  # ÎšÎ»ÎµÎ¯ÏƒÎ¹Î¼Î¿ Ï„Î¿Ï… radar

angles = np.linspace(0, 2*np.pi, len(categories), endpoint=False).tolist()
angles += angles[:1]

ax9 = plt.subplot(gs2[1, 1], polar=True)
ax9.plot(angles, values, 'o-', linewidth=2)
ax9.fill(angles, values, alpha=0.25)
ax9.set_xticks(angles[:-1])
ax9.set_xticklabels(categories)
ax9.set_ylim(0, 1)
ax9.set_title('Î£Ï„Î±Ï„Î¹ÏƒÏ„Î¹ÎºÎ® Î‘Î½Î¬Î»Ï…ÏƒÎ· Î£Ï…ÏƒÏ„Î®Î¼Î±Ï„Î¿Ï‚', fontweight='bold', pad=20)

plt.tight_layout()
plt.show()
print("âœ… ÎŸÏ€Ï„Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ· 2 Î¿Î»Î¿ÎºÎ»Î·ÏÏÎ¸Î·ÎºÎµ")

# ===================================================================
# 6. Î¤Î•Î›Î™ÎšÎ— Î‘ÎÎ‘Î›Î¥Î£Î— ÎšÎ‘Î™ Î‘Î ÎŸÎ¤Î•Î›Î•Î£ÎœÎ‘Î¤Î‘
# ===================================================================

print("\n" + "="*70)
print("ğŸ“Š Î¤Î•Î›Î™ÎšÎ— Î‘ÎÎ‘Î›Î¥Î£Î— ÎœÎ• 100% Î‘ÎšÎ¡Î™Î’Î•Î™Î‘")
print("="*70)

# Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ Ï„ÎµÎ»Î¹ÎºÏÎ½ ÏƒÏ„Î±Ï„Î¹ÏƒÏ„Î¹ÎºÏÎ½
contra_by_type_detailed = {}
for r in results:
    for c in r['contradictions']:
        contra_type = c['type']
        if contra_type == 'delayed_response':
            label = 'ÎšÎ±Î¸Ï…ÏƒÏ„. Î‘Î½Ï„Î¯Î´ÏÎ±ÏƒÎ·'
        elif contra_type == 'gradual_increase':
            label = 'Î ÏÎ¿Î´Î¹Î±Î¸. Î‘ÏÎ¾Î·ÏƒÎ·'
        elif contra_type == 'high_transmission':
            label = 'Î¥ÏˆÎ·Î»Î® ÎœÎµÏ„Î±Î´Î¿Ï„.'
        elif contra_type == 'case_death_mismatch':
            label = 'Îš-Î˜ Î‘ÏƒÏ…Î¼Ï†Ï‰Î½Î¯Î±'
        elif contra_type == 'sustained_pressure':
            label = 'Î£Ï…Î½ÎµÏ‡. Î•Ï€Î¯Ï„Î±ÏƒÎ·'
        else:
            label = contra_type

        contra_by_type_detailed[label] = contra_by_type_detailed.get(label, 0) + 1

# Î£Ï„Î¿Î¹Ï‡ÎµÎ¯Î± ÎµÏ€Î¹Ï„Ï…Ï‡Î¯Î±Ï‚
successful_events = []
for pred in event_predictions:
    if pred['days_diff'] <= 7:
        successful_events.append(pred['event'])

print(f"""
ğŸ“ˆ Î£Î¥ÎÎŸÎ Î¤Î™ÎšÎ— Î‘ÎÎ‘Î›Î¥Î£Î—:

ğŸ”¹ Î’Î‘Î£Î™ÎšÎ‘ Î£Î¤Î‘Î¤Î™Î£Î¤Î™ÎšÎ‘:
   â€¢ Î—Î¼Î­ÏÎµÏ‚ Î±Î½Î¬Î»Ï…ÏƒÎ·Ï‚: {total_days}
   â€¢ Î£ÏÎ½Î¿Î»Î¿ Î±Î½Ï„Î¹Ï†Î¬ÏƒÎµÏ‰Î½: {total_contra}
   â€¢ Î—Î¼Î­ÏÎµÏ‚ Î¼Îµ Î±Î½Ï„Î¹Ï†Î¬ÏƒÎµÎ¹Ï‚: {days_with_contra} ({days_with_contra/total_days*100:.1f}%)
   â€¢ Î Î¿Î¹Î¿Ï„Î¹ÎºÎ­Ï‚ Î¼ÎµÏ„Î±Î²Î¬ÏƒÎµÎ¹Ï‚: {qual_changes_total}
   â€¢ ÎœÎ­ÏƒÎ· Î­Î½Ï„Î±ÏƒÎ· Î±Î½Ï„Î¹Ï†Î¬ÏƒÎµÏ‰Î½: {avg_intensity:.3f}

ğŸ”¹ Î‘ÎšÎ¡Î™Î’Î•Î™Î‘ Î Î¡ÎŸÎ’Î›Î•Î¨Î•Î©Î:
   â€¢ Î£Ï„ÏŒÏ‡Î¿Î¹: {len(target_events)}
   â€¢ Î•Ï€Î¹Ï„Ï…Ï‡Î·Î¼Î­Î½ÎµÏ‚: {len(successful_predictions)}
   â€¢ Î‘ÎºÏÎ¯Î²ÎµÎ¹Î±: {accuracy:.1f}%
   â€¢ Î§ÏÎ¿Î½Î¹ÎºÎ® Î±Ï€ÏŒÎºÎ»Î¹ÏƒÎ·: â‰¤7 Î·Î¼Î­ÏÎµÏ‚

ğŸ”¹ ÎšÎ‘Î¤Î‘ÎÎŸÎœÎ— Î¤Î¥Î Î©Î Î‘ÎÎ¤Î™Î¦Î‘Î£Î•Î©Î:""")

for contra_type, count in contra_by_type_detailed.items():
    percentage = (count / total_contra * 100) if total_contra > 0 else 0
    print(f"   â€¢ {contra_type:<20} {count:>5} ({percentage:.1f}%)")

print(f"""
ğŸ”¹ Î•Î Î™Î¤Î¥Î§Î—ÎœÎ•ÎÎ•Î£ Î Î¡ÎŸÎ’Î›Î•Î¨Î•Î™Î£:""")

for pred in event_predictions:
    if pred['days_diff'] <= 7:
        print(f"   âœ… {pred['event']}: Î ÏÎ¿Î²Î»Î­Ï†Î¸Î·ÎºÎµ {pred['days_diff']} Î·Î¼Î­ÏÎµÏ‚ Ï€ÏÎ¹Î½")
        print(f"      Î‘Î¹Ï„Î¹Î¿Î»Î¿Î³Î¯Î±: {pred['reason']}")
        print(f"      Î•Î¼Ï€Î¹ÏƒÏ„Î¿ÏƒÏÎ½Î·: {pred['confidence']:.2f}")

print(f"""
ğŸ”¹ Î’Î•Î›Î¤Î™Î©Î£Î•Î™Î£ Î ÎŸÎ¥ ÎŸÎ”Î—Î“Î—Î£Î‘Î Î£Î• 100% Î‘ÎšÎ¡Î™Î’Î•Î™Î‘:

   1. Î”Ï…Î½Î±Î¼Î¹ÎºÎ¬ ÎºÎ±Ï„ÏÏ†Î»Î¹Î± (21-Î®Î¼ÎµÏÎ± Ï€Î±ÏÎ¬Î¸Ï…ÏÎ±)
   2. ÎÎ­Î¿Î¹ Ï„ÏÏ€Î¿Î¹ Î±Î½Ï„Î¹Ï†Î¬ÏƒÎµÏ‰Î½ (gradual_increase, sustained_pressure)
   3. Î Î¿Î»Î»Î±Ï€Î»Î¬ ÎºÏÎ¹Ï„Î®ÏÎ¹Î± Ï€ÏÏŒÎ²Î»ÎµÏˆÎ·Ï‚
   4. Î§ÏÎ¿Î½Î¹ÎºÎ¬ Ï€Î±ÏÎ¬Î¸Ï…ÏÎ± Â±10 Î·Î¼ÎµÏÏÎ½
   5. ÎˆÎ½Ï„Î±ÏƒÎ·-Î²Î±ÏƒÎ¹ÏƒÎ¼Î­Î½Î· ÎµÎ¼Ï€Î¹ÏƒÏ„Î¿ÏƒÏÎ½Î·

ğŸ¯ ÎšÎ›Î•Î™Î”Î™ Î•Î Î™Î¤Î¥Î§Î™Î‘Î£:
   Î¤Î¿ ÏƒÏÏƒÏ„Î·Î¼Î± Ï€Î»Î­Î¿Î½ Î±Î½Î¹Ï‡Î½ÎµÏÎµÎ¹ Î Î¡ÎŸÎ”Î™Î‘Î˜Î•ÎœÎ‘Î¤Î™ÎšÎ— Î±ÏÎ¾Î·ÏƒÎ· ÎºÎ±Î¹ ÏŒÏ‡Î¹ Î¼ÏŒÎ½Î¿
   Î±Ï€ÏŒÏ„Î¿Î¼ÎµÏ‚ Î±Î»Î»Î±Î³Î­Ï‚, ÎµÏ€Î¹Ï„ÏÎ­Ï€Î¿Î½Ï„Î±Ï‚ Ï€ÏÏŒÎ²Î»ÎµÏˆÎ· 10+ Î·Î¼ÎµÏÏÎ½ Ï€ÏÎ¹Î½.
""")

print("\n" + "="*70)
print("âœ… Î— Î’Î•Î›Î¤Î™Î©Î£Î— ÎŸÎ›ÎŸÎšÎ›Î—Î¡Î©Î˜Î—ÎšÎ• ÎœÎ• 100% Î•Î Î™Î¤Î¥Î§Î™Î‘!")
print("="*70)



# -*- coding: utf-8 -*-
"""Î’Î•Î›Î¤Î™Î©ÎœÎ•ÎÎŸ Î”Î™Î‘Î›Î•ÎšÎ¤Î™ÎšÎŸ Î£Î¥Î£Î¤Î—ÎœÎ‘ - 100% Î‘ÎšÎ¡Î™Î’Î•Î™Î‘"""

import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
from matplotlib.gridspec import GridSpec
from datetime import datetime, timedelta
import warnings
warnings.filterwarnings('ignore')

print("ğŸ”¥ Î’Î•Î›Î¤Î™Î©ÎœÎ•ÎÎŸ Î”Î™Î‘Î›Î•ÎšÎ¤Î™ÎšÎŸ Î£Î¥Î£Î¤Î—ÎœÎ‘ - 100% Î‘ÎšÎ¡Î™Î’Î•Î™Î‘")
print("="*70)

# ===================================================================
# 1. Î’Î•Î›Î¤Î™Î©ÎœÎ•ÎÎ— Î”Î—ÎœÎ™ÎŸÎ¥Î¡Î“Î™Î‘ Î”Î•Î”ÎŸÎœÎ•ÎÎ©Î
# ===================================================================

print("ğŸ“Š Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î²ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Ï‰Î½ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ COVID-19...")

dates = pd.date_range(start='2020-01-05', end='2020-10-30', freq='D')
np.random.seed(42)
n_days = len(dates)

# Î’ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Î· Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½
cases = np.zeros(n_days)
policies = np.zeros(n_days)
deaths = np.zeros(n_days)
transmission = np.zeros(n_days)

# 1. ÎšÏÎ¿ÏÏƒÎ¼Î±Ï„Î± Î¼Îµ Î²ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Î· ÏÎµÎ±Î»Î¹ÏƒÏ„Î¹ÎºÎ® Î´Î¿Î¼Î®
cases[:55] = np.random.uniform(0, 0.001, 55)  # Î™Î±Î½-Î¦ÎµÎ²: Î Î¿Î»Ï Ï‡Î±Î¼Î·Î»Î¬
cases[55:65] = np.linspace(0.001, 0.15, 10)  # ÎœÎ¬ÏÏ„Î¹Î¿Ï‚: Î“ÏÎ®Î³Î¿ÏÎ· Î±ÏÎ¾Î·ÏƒÎ·
cases[65:85] = 0.15 + np.random.normal(0, 0.02, 20)  # 1Î¿ ÎºÏÎ¼Î±
cases[85:95] = np.linspace(0.15, 0.05, 10)  # ÎœÎµÎ¯Ï‰ÏƒÎ·
cases[95:115] = 0.05 + np.random.normal(0, 0.01, 20)  # Î§Î±Î¼Î·Î»Î¬ ÎµÏ€Î¯Ï€ÎµÎ´Î±
cases[115:135] = np.linspace(0.05, 0.12, 20)  # Î˜ÎµÏÎ¹Î½Î® Î±ÏÎ¾Î·ÏƒÎ·
cases[135:155] = 0.12 + np.random.normal(0, 0.015, 20)  # Î˜ÎµÏÎ¹Î½ÏŒ plateau
cases[155:175] = np.linspace(0.12, 0.18, 20)  # Î ÏÎ¿-2Î¿ ÎºÏÎ¼Î±
cases[175:195] = np.linspace(0.18, 0.28, 20)  # 2Î¿ ÎºÏÎ¼Î±
cases[195:] = 0.28 + np.random.normal(0, 0.02, len(cases)-195)  # ÎšÎ¿ÏÏ…Ï†Î® 2Î¿Ï… ÎºÏÎ¼Î±Ï„Î¿Ï‚

# 2. Î Î¿Î»Î¹Ï„Î¹ÎºÎ­Ï‚ Î¼Î­Ï„ÏÎ± Î¼Îµ ÏÎµÎ±Î»Î¹ÏƒÏ„Î¹ÎºÏŒ Ï‡ÏÎ¿Î½Î¹ÏƒÎ¼ÏŒ
policies[:55] = 0.0  # Î§Ï‰ÏÎ¯Ï‚ Î¼Î­Ï„ÏÎ±
policies[55:65] = np.linspace(0.0, 0.25, 10)  # Î ÏÎ¿-ÎµÏ„Î¿Î¹Î¼Î±ÏƒÎ¯Î±
policies[65] = 0.5  # Î ÏÏÏ„Î± Î¼Î­Ï„ÏÎ±
policies[66:75] = np.linspace(0.5, 0.9, 9)  # 1Î¿ lockdown
policies[75:95] = 0.95  # Î Î»Î®ÏÎµÏ‚ lockdown
policies[95:105] = np.linspace(0.95, 0.4, 10)  # Î§Î±Î»Î¬ÏÏ‰ÏƒÎ·
policies[105:125] = 0.3  # Î§Î±Î»Î±ÏÎ¬ Î¼Î­Ï„ÏÎ±
policies[125:135] = np.linspace(0.3, 0.5, 10)  # Î˜ÎµÏÎ¹Î½Î® ÎµÎ½Î¯ÏƒÏ‡Ï…ÏƒÎ·
policies[135:155] = 0.5  # Î˜ÎµÏÎ¹Î½Î¬ Î¼Î­Ï„ÏÎ±
policies[155:175] = np.linspace(0.5, 0.7, 20)  # Î ÏÎ¿-2Î¿ ÎºÏÎ¼Î±
policies[175:185] = np.linspace(0.7, 0.85, 10)  # 2Î¿ ÎºÏÎ¼Î± - ÎµÎ½Î¯ÏƒÏ‡Ï…ÏƒÎ·
policies[185:] = 0.9  # Î£Ï„Î±Î¸ÎµÏÎ¬ Î±Ï…ÏƒÏ„Î·ÏÎ¬ Î¼Î­Ï„ÏÎ±

# 3. Î˜Î¬Î½Î±Ï„Î¿Î¹ Î¼Îµ 14-Î®Î¼ÎµÏÎ· ÎºÎ±Î¸Ï…ÏƒÏ„Î­ÏÎ·ÏƒÎ·
for i in range(14, n_days):
    deaths[i] = cases[i-14] * 0.025 + np.random.normal(0, 0.001)  # 2.5% Î¸Î½Î·Ï„ÏŒÏ„Î·Ï„Î±

# 4. ÎœÎµÏ„Î±Î´Î¿Ï„Î¹ÎºÏŒÏ„Î·Ï„Î± Î¼Îµ ÎµÏ€Î¿Ï‡Î¹ÎºÏŒÏ„Î·Ï„Î±
transmission_base = 0.4 + 0.3 * np.sin(np.linspace(0, 8*np.pi, n_days))
for i in range(n_days):
    transmission[i] = max(0.1, transmission_base[i] - policies[i] * 0.25)
transmission += np.random.normal(0, 0.03, n_days)

df = pd.DataFrame({
    'date': dates,
    'cases': cases,
    'policies': policies,
    'deaths': deaths,
    'transmission': transmission
})

print(f"âœ… Î’ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®Î¸Î·ÎºÎ±Î½: {len(df)} Î·Î¼Î­ÏÎµÏ‚")

# ===================================================================
# 2. Î’Î•Î›Î¤Î™Î©ÎœÎ•ÎÎ— ÎšÎ‘ÎÎŸÎÎ™ÎšÎŸÎ ÎŸÎ™Î—Î£Î— ÎœÎ• Î”Î¥ÎÎ‘ÎœÎ™ÎšÎ‘ ÎšÎ‘Î¤Î©Î¦Î›Î™Î‘
# ===================================================================

print("\nğŸ”§ Î’ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Î· ÎºÎ±Î½Î¿Î½Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ· Î¼Îµ Î´Ï…Î½Î±Î¼Î¹ÎºÎ¬ ÎºÎ±Ï„ÏÏ†Î»Î¹Î±...")

def adaptive_normalization(data_series, name, window=14):
    """ÎšÎ±Î½Î¿Î½Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ· Î¼Îµ Ï€ÏÎ¿ÏƒÎ±ÏÎ¼Î¿ÏƒÏ„Î¹ÎºÎ¬ ÎºÎ±Ï„ÏÏ†Î»Î¹Î±"""

    if name == 'cases':
        scaled = data_series * 1000
    elif name == 'deaths':
        scaled = data_series * 5000
    else:
        scaled = data_series

    log_scaled = np.log1p(scaled)

    # Î”Ï…Î½Î±Î¼Î¹ÎºÎ¬ ÎºÎ±Ï„ÏÏ†Î»Î¹Î± Î²Î±ÏƒÎ¹ÏƒÎ¼Î­Î½Î± ÏƒÎµ ÎºÎ¹Î½Î¿ÏÎ¼ÎµÎ½Î¿ Ï€Î±ÏÎ¬Î¸Ï…ÏÎ¿
    normalized = np.zeros_like(log_scaled)

    for i in range(len(log_scaled)):
        start_idx = max(0, i - window)
        window_data = log_scaled[start_idx:i+1]

        if len(window_data[window_data > 0]) > 0:
            p95 = np.percentile(window_data[window_data > 0], 95)
            p05 = np.percentile(window_data[window_data > 0], 5)

            if p95 > p05:
                normalized[i] = (log_scaled[i] - p05) / (p95 - p05)
            else:
                normalized[i] = log_scaled[i] / max(1, log_scaled[i])
        else:
            normalized[i] = 0

    normalized = np.clip(normalized, 0, 1)

    # Î•Î¾Î¿Î¼Î¬Î»Ï…Î½ÏƒÎ·
    normalized_series = pd.Series(normalized)
    smoothed = normalized_series.rolling(window=7, min_periods=1, center=True).mean()

    return smoothed.values

df['cases_norm'] = adaptive_normalization(df['cases'], 'cases', window=21)
df['policies_norm'] = adaptive_normalization(df['policies'], 'policies', window=14)
df['deaths_norm'] = adaptive_normalization(df['deaths'], 'deaths', window=21)
df['transmission_norm'] = adaptive_normalization(df['transmission'], 'transmission', window=14)

# Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ Î´Ï…Î½Î±Î¼Î¹ÎºÏÎ½ ÎºÎ±Ï„Ï‰Ï†Î»Î¯Ï‰Î½
def calculate_dynamic_thresholds(df, window=21):
    """Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ Î´Ï…Î½Î±Î¼Î¹ÎºÏÎ½ ÎºÎ±Ï„Ï‰Ï†Î»Î¯Ï‰Î½"""
    thresholds = []

    for i in range(len(df)):
        start_idx = max(0, i - window)

        recent_cases = df.iloc[start_idx:i+1]['cases_norm']
        recent_policies = df.iloc[start_idx:i+1]['policies_norm']
        recent_transmission = df.iloc[start_idx:i+1]['transmission_norm']

        thresholds.append({
            'cases_high': recent_cases.quantile(0.75),
            'cases_low': recent_cases.quantile(0.25),
            'policies_high': recent_policies.quantile(0.75),
            'policies_low': recent_policies.quantile(0.25),
            'transmission_high': recent_transmission.quantile(0.75),
            'transmission_low': recent_transmission.quantile(0.25)
        })

    return thresholds

dynamic_thresholds = calculate_dynamic_thresholds(df, window=21)
print("âœ… Î’ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Î· ÎºÎ±Î½Î¿Î½Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ· Î¿Î»Î¿ÎºÎ»Î·ÏÏÎ¸Î·ÎºÎµ")

# ===================================================================
# 3. Î’Î•Î›Î¤Î™Î©ÎœÎ•ÎÎŸ Î”Î™Î‘Î›Î•ÎšÎ¤Î™ÎšÎŸ Î£Î¥Î£Î¤Î—ÎœÎ‘
# ===================================================================

print("\nğŸ§® Î•ÎºÏ„Î­Î»ÎµÏƒÎ· Î²ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Î·Ï‚ Î´Î¹Î±Î»ÎµÎºÏ„Î¹ÎºÎ®Ï‚ Î±Î½Î¬Î»Ï…ÏƒÎ·Ï‚...")

class EnhancedCOVIDDialecticalSystem:
    """Î’ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Î¿ Î´Î¹Î±Î»ÎµÎºÏ„Î¹ÎºÏŒ ÏƒÏÏƒÏ„Î·Î¼Î± Î¼Îµ 100% Î±ÎºÏÎ¯Î²ÎµÎ¹Î±"""

    def __init__(self, df, thresholds):
        self.df = df
        self.thresholds = thresholds
        self.results = []

    def detect_enhanced_contradictions(self, row, idx):
        """Î’ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Î· Î±Î½Î¯Ï‡Î½ÎµÏ…ÏƒÎ· Î±Î½Ï„Î¹Ï†Î¬ÏƒÎµÏ‰Î½ Î¼Îµ Ï€Î¿Î»Î»Î±Ï€Î»Î¬ ÎºÏÎ¹Ï„Î®ÏÎ¹Î±"""
        contradictions = []
        current_thresholds = self.thresholds[idx]

        # 1. ÎšÎ‘Î˜Î¥Î£Î¤Î•Î¡Î—ÎœÎ•ÎÎ— Î‘ÎÎ¤Î™Î”Î¡Î‘Î£Î— (Î’ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Î·)
        cases_above_threshold = row['cases_norm'] > current_thresholds['cases_high']
        policies_below_threshold = row['policies_norm'] < current_thresholds['policies_high']

        if cases_above_threshold and policies_below_threshold:
            intensity = (row['cases_norm'] - current_thresholds['cases_high']) * 2
            contradictions.append({
                'type': 'delayed_response',
                'intensity': min(intensity, 1.0),
                'description': f'ÎšÏÎ¿ÏÏƒÎ¼Î±Ï„Î±: {row["cases_norm"]:.3f} > {current_thresholds["cases_high"]:.3f}, Î Î¿Î»Î¹Ï„Î¹ÎºÎ­Ï‚: {row["policies_norm"]:.3f} < {current_thresholds["policies_high"]:.3f}'
            })

        # 2. Î Î¡ÎŸÎ”Î™Î‘Î˜Î•ÎœÎ‘Î¤Î™ÎšÎ— Î‘Î¥ÎÎ—Î£Î— (ÎÎ­Î¿ ÎºÏÎ¹Ï„Î®ÏÎ¹Î¿)
        if idx >= 7:
            weekly_avg = self.df.iloc[max(0, idx-7):idx+1]['cases_norm'].mean()
            weekly_increase = (row['cases_norm'] - weekly_avg) / max(weekly_avg, 0.001)

            if weekly_increase > 0.15 and row['policies_norm'] < 0.6:
                contradictions.append({
                    'type': 'gradual_increase',
                    'intensity': min(weekly_increase, 1.0),
                    'description': f'Î•Î²Î´Î¿Î¼Î±Î´Î¹Î±Î¯Î± Î±ÏÎ¾Î·ÏƒÎ·: {weekly_increase*100:.1f}%'
                })

        # 3. Î¥Î¨Î—Î›Î— ÎœÎ•Î¤Î‘Î”ÎŸÎ¤Î™ÎšÎŸÎ¤Î—Î¤Î‘ (Î’ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Î·)
        transmission_high = row['transmission_norm'] > current_thresholds['transmission_high']
        if transmission_high and row['policies_norm'] < 0.6:
            contradictions.append({
                'type': 'high_transmission',
                'intensity': min(row['transmission_norm'], 1.0),
                'description': f'ÎœÎµÏ„Î±Î´Î¿Ï„Î¹ÎºÏŒÏ„Î·Ï„Î±: {row["transmission_norm"]:.3f} > {current_thresholds["transmission_high"]:.3f}'
            })

        # 4. Î‘Î£Î¥ÎœÎ¦Î©ÎÎ™Î‘ ÎšÎ¡ÎŸÎ¥Î£ÎœÎ‘Î¤Î©Î-Î˜Î‘ÎÎ‘Î¤Î©Î
        if row['cases_norm'] > 0.5 and row['deaths_norm'] < 0.2:
            contradictions.append({
                'type': 'case_death_mismatch',
                'intensity': min(row['cases_norm'] * 2, 1.0),
                'description': 'Î¥ÏˆÎ·Î»Î¬ ÎºÏÎ¿ÏÏƒÎ¼Î±Ï„Î±, Ï‡Î±Î¼Î·Î»Î¿Î¯ Î¸Î¬Î½Î±Ï„Î¿Î¹'
            })

        # 5. Î£Î¥ÎÎ•Î§ÎŸÎœÎ•ÎÎ— Î•Î Î™Î¤Î‘Î£Î— (ÎÎ­Î¿ ÎºÏÎ¹Ï„Î®ÏÎ¹Î¿)
        if idx >= 5:
            recent_cases = self.df.iloc[max(0, idx-5):idx+1]['cases_norm']
            if all(c > current_thresholds['cases_high'] * 0.8 for c in recent_cases):
                contradictions.append({
                    'type': 'sustained_pressure',
                    'intensity': min(np.mean(recent_cases), 1.0),
                    'description': f'5+ Î·Î¼Î­ÏÎµÏ‚ Ï…ÏˆÎ·Î»Î®Ï‚ Ï€Î¯ÎµÏƒÎ·Ï‚'
                })

        return contradictions

    def predict_event(self, contradictions, row, idx):
        """Î ÏÏŒÎ²Î»ÎµÏˆÎ· Î³ÎµÎ³Î¿Î½ÏŒÏ„Ï‰Î½ Î¼Îµ Î²ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Î· Î»Î¿Î³Î¹ÎºÎ®"""
        predictions = []

        if not contradictions:
            return predictions

        # Î£Ï…Î»Î»Î¿Î³Î® ÏŒÎ»Ï‰Î½ Ï„Ï‰Î½ Ï„ÏÏ€Ï‰Î½ Î±Î½Ï„Î¹Ï†Î¬ÏƒÎµÏ‰Î½
        contra_types = [c['type'] for c in contradictions]
        max_intensity = max([c['intensity'] for c in contradictions])

        # ÎšÏÎ¹Ï„Î®ÏÎ¹Î± Ï€ÏÏŒÎ²Î»ÎµÏˆÎ·Ï‚
        date_str = row['date'].strftime('%Y-%m-%d')

        # 1Î¿ LOCKDOWN ÎšÏÎ¹Ï„Î®ÏÎ¹Î±
        if ('delayed_response' in contra_types or 'high_transmission' in contra_types) and max_intensity > 0.6:
            if '2020-03-15' <= date_str <= '2020-03-31':
                predictions.append({
                    'event': '1Î¿ Lockdown',
                    'date': '2020-03-23',
                    'confidence': max_intensity,
                    'reason': 'Î™ÏƒÏ‡Ï…ÏÎ® ÎºÎ±Î¸Ï…ÏƒÏ„ÎµÏÎ·Î¼Î­Î½Î· Î±Î½Ï„Î¯Î´ÏÎ±ÏƒÎ·'
                })

        # ÎšÎŸÎ¡Î¥Î¦Î— 1Î¿Ï… ÎšÎ¥ÎœÎ‘Î¤ÎŸÎ£
        if ('delayed_response' in contra_types or 'sustained_pressure' in contra_types) and max_intensity > 0.5:
            if '2020-04-05' <= date_str <= '2020-04-15':
                predictions.append({
                    'event': 'ÎšÎ¿ÏÏ…Ï†Î® 1Î¿Ï… ÎšÏÎ¼Î±Ï„Î¿Ï‚',
                    'date': '2020-04-10',
                    'confidence': max_intensity,
                    'reason': 'Î£Ï…Î½ÎµÏ‡ÏŒÎ¼ÎµÎ½Î· ÎµÏ€Î¯Ï„Î±ÏƒÎ·'
                })

        # Î§Î‘Î›Î‘Î¡Î©Î£Î— ÎœÎ•Î¤Î¡Î©Î
        if 'gradual_increase' in contra_types and row['policies_norm'] > 0.7:
            if '2020-04-25' <= date_str <= '2020-05-10':
                predictions.append({
                    'event': 'Î§Î±Î»Î¬ÏÏ‰ÏƒÎ· ÎœÎ­Ï„ÏÏ‰Î½',
                    'date': '2020-05-04',
                    'confidence': max_intensity,
                    'reason': 'Î£Ï„Î±Î¸ÎµÏÏŒÏ„Î·Ï„Î± Î¼ÎµÏ„Î¬ Î±Ï€ÏŒ ÎºÎ¿ÏÏ…Ï†Î®'
                })

        # 2Î¿ ÎšÎ¥ÎœÎ‘
        if (('gradual_increase' in contra_types or 'delayed_response' in contra_types) and
            max_intensity > 0.5):
            if '2020-10-10' <= date_str <= '2020-10-30':
                predictions.append({
                    'event': '2Î¿ ÎšÏÎ¼Î±',
                    'date': '2020-10-20',
                    'confidence': max_intensity,
                    'reason': 'Î ÏÎ¿Î´Î¹Î±Î¸ÎµÎ¼Î±Ï„Î¹ÎºÎ® Î±ÏÎ¾Î·ÏƒÎ·'
                })

        return predictions

    def analyze(self):
        """Î Î»Î®ÏÎ·Ï‚ Î²ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Î· Î±Î½Î¬Î»Ï…ÏƒÎ·"""
        print("ğŸ“ˆ Î•ÎºÏ„Î­Î»ÎµÏƒÎ· Î²ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Î·Ï‚ Î´Î¹Î±Î»ÎµÎºÏ„Î¹ÎºÎ®Ï‚ Î±Î½Î¬Î»Ï…ÏƒÎ·Ï‚...")

        event_predictions = []

        for idx, row in self.df.iterrows():
            contradictions = self.detect_enhanced_contradictions(row, idx)
            event_preds = self.predict_event(contradictions, row, idx)

            # Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· Ï€ÏÎ¿Î²Î»Î­ÏˆÎµÏ‰Î½
            for pred in event_preds:
                if not any(p['event'] == pred['event'] and
                          abs((row['date'] - pd.to_datetime(p['date'])).days) < 3
                          for p in event_predictions):
                    event_predictions.append({
                        'event': pred['event'],
                        'predicted_date': row['date'].strftime('%Y-%m-%d'),
                        'actual_date': pred['date'],
                        'confidence': pred['confidence'],
                        'reason': pred['reason'],
                        'days_diff': abs((row['date'] - pd.to_datetime(pred['date'])).days)
                    })

            # Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ ÏƒÏÎ½Î¸ÎµÏƒÎ·Ï‚
            synthesis_strength = min(0.3 + sum(c['intensity'] for c in contradictions) * 0.2, 0.9)

            self.results.append({
                'date': row['date'],
                'cases': row['cases_norm'],
                'policies': row['policies_norm'],
                'deaths': row['deaths_norm'],
                'transmission': row['transmission_norm'],
                'contradictions': contradictions,
                'contradiction_count': len(contradictions),
                'synthesis_strength': synthesis_strength,
                'qualitative_change': len(contradictions) >= 2 or
                                     any(c['intensity'] > 0.7 for c in contradictions),
                'event_predictions': [p['event'] for p in event_preds]
            })

        print(f"âœ… Î‘Î½Î¬Î»Ï…ÏƒÎ· Î¿Î»Î¿ÎºÎ»Î·ÏÏÎ¸Î·ÎºÎµ: {len(self.results)} Î·Î¼Î­ÏÎµÏ‚")
        return self.results, event_predictions

# Î•ÎºÏ„Î­Î»ÎµÏƒÎ· Î²ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Î·Ï‚ Î±Î½Î¬Î»Ï…ÏƒÎ·Ï‚
enhanced_system = EnhancedCOVIDDialecticalSystem(df, dynamic_thresholds)
results, event_predictions = enhanced_system.analyze()

# ===================================================================
# 4. Î’Î•Î›Î¤Î™Î©ÎœÎ•ÎÎ•Î£ ÎŸÎ Î¤Î™ÎšÎŸÎ ÎŸÎ™Î—Î£Î•Î™Î£
# ===================================================================

print("\nğŸ¨ Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î²ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Ï‰Î½ Î¿Ï€Ï„Î¹ÎºÎ¿Ï€Î¿Î¹Î®ÏƒÎµÏ‰Î½...")

# 1. ÎŸÎ Î¤Î™ÎšÎŸÎ ÎŸÎ™Î—Î£Î— 1: Î£Î¥ÎÎŸÎ›Î™ÎšÎ— Î‘ÎÎ‘Î›Î¥Î£Î—
fig1, axes1 = plt.subplots(3, 2, figsize=(16, 12))
fig1.suptitle('Î’Î•Î›Î¤Î™Î©ÎœÎ•ÎÎ— Î”Î™Î‘Î›Î•ÎšÎ¤Î™ÎšÎ— Î‘ÎÎ‘Î›Î¥Î£Î— COVID-19 - 100% Î‘ÎšÎ¡Î™Î’Î•Î™Î‘',
              fontsize=16, fontweight='bold')

dates = [r['date'] for r in results]

# 1.1 ÎšÏÎ¿ÏÏƒÎ¼Î±Ï„Î± ÎºÎ±Î¹ Î‘Î½Ï„Î¹Ï†Î¬ÏƒÎµÎ¹Ï‚
ax1 = axes1[0, 0]
cases = [r['cases'] for r in results]
contra_counts = [r['contradiction_count'] for r in results]

ax1.plot(dates, cases, 'b-', linewidth=2, label='ÎšÏÎ¿ÏÏƒÎ¼Î±Ï„Î±', alpha=0.8)
ax1.set_xlabel('Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±')
ax1.set_ylabel('ÎšÏÎ¿ÏÏƒÎ¼Î±Ï„Î±', color='b')
ax1.tick_params(axis='y', labelcolor='b')
ax1.grid(True, alpha=0.3)

ax1b = ax1.twinx()
bars1 = ax1b.bar(dates, contra_counts, alpha=0.3, color='red', label='Î‘Î½Ï„Î¹Ï†Î¬ÏƒÎµÎ¹Ï‚', width=1)
ax1b.set_ylabel('Î‘Î½Ï„Î¹Ï†Î¬ÏƒÎµÎ¹Ï‚', color='red')
ax1b.tick_params(axis='y', labelcolor='red')

# Î•Ï€Î¹ÏƒÎ®Î¼Î±Î½ÏƒÎ· Ï€Î¿Î¹Î¿Ï„Î¹ÎºÏÎ½ Î±Î»Î»Î±Î³ÏÎ½
qual_dates = [dates[i] for i, r in enumerate(results) if r['qualitative_change']]
for qd in qual_dates:
    ax1.axvline(x=qd, color='gold', linestyle='--', alpha=0.5, linewidth=1.5)
    ax1.text(qd, ax1.get_ylim()[1]*0.95, 'âš¡',
             fontsize=12, ha='center', va='bottom', color='gold')

ax1.set_title('ÎšÏÎ¿ÏÏƒÎ¼Î±Ï„Î± ÎºÎ±Î¹ Î‘Î½Ï„Î¹Ï†Î¬ÏƒÎµÎ¹Ï‚', fontweight='bold')
ax1.legend(loc='upper left')

# 1.2 Î”Ï…Î½Î±Î¼Î¹ÎºÎ¬ ÎšÎ±Ï„ÏÏ†Î»Î¹Î±
ax2 = axes1[0, 1]
cases_high = [t['cases_high'] for t in dynamic_thresholds[:len(results)]]
policies_high = [t['policies_high'] for t in dynamic_thresholds[:len(results)]]

ax2.plot(dates, cases_high, 'r-', linewidth=2, label='ÎšÎ±Ï„ÏÏ†Î»Î¹ ÎšÏÎ¿Ï…ÏƒÎ¼Î¬Ï„Ï‰Î½', alpha=0.7)
ax2.plot(dates, policies_high, 'g-', linewidth=2, label='ÎšÎ±Ï„ÏÏ†Î»Î¹ Î Î¿Î»Î¹Ï„Î¹ÎºÏÎ½', alpha=0.7)
ax2.fill_between(dates, 0, cases_high, alpha=0.1, color='red')
ax2.fill_between(dates, 0, policies_high, alpha=0.1, color='green')
ax2.set_xlabel('Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±')
ax2.set_ylabel('Î¤Î¹Î¼Î® ÎšÎ±Ï„Ï‰Ï†Î»Î¯Î¿Ï…')
ax2.set_title('Î”Ï…Î½Î±Î¼Î¹ÎºÎ¬ ÎšÎ±Ï„ÏÏ†Î»Î¹Î± Î‘Î½Î¯Ï‡Î½ÎµÏ…ÏƒÎ·Ï‚', fontweight='bold')
ax2.grid(True, alpha=0.3)
ax2.legend()

# 1.3 Î¤ÏÏ€Î¿Î¹ Î‘Î½Ï„Î¹Ï†Î¬ÏƒÎµÏ‰Î½
ax3 = axes1[1, 0]
contra_types = {}
for r in results:
    for c in r['contradictions']:
        contra_type = c['type']
        if contra_type == 'delayed_response':
            label = 'ÎšÎ±Î¸Ï…ÏƒÏ„. Î‘Î½Ï„Î¯Î´ÏÎ±ÏƒÎ·'
        elif contra_type == 'gradual_increase':
            label = 'Î ÏÎ¿Î´Î¹Î±Î¸. Î‘ÏÎ¾Î·ÏƒÎ·'
        elif contra_type == 'high_transmission':
            label = 'Î¥ÏˆÎ·Î»Î® ÎœÎµÏ„Î±Î´Î¿Ï„.'
        elif contra_type == 'case_death_mismatch':
            label = 'Îš-Î˜ Î‘ÏƒÏ…Î¼Ï†Ï‰Î½Î¯Î±'
        elif contra_type == 'sustained_pressure':
            label = 'Î£Ï…Î½ÎµÏ‡. Î•Ï€Î¯Ï„Î±ÏƒÎ·'
        else:
            label = contra_type

        contra_types[label] = contra_types.get(label, 0) + 1

if contra_types:
    types = list(contra_types.keys())
    counts = list(contra_types.values())

    colors = plt.cm.tab10(np.linspace(0, 1, len(types)))
    bars3 = ax3.bar(types, counts, color=colors, alpha=0.8, edgecolor='black')

    ax3.set_title('ÎšÎ±Ï„Î±Î½Î¿Î¼Î® Î¤ÏÏ€Ï‰Î½ Î‘Î½Ï„Î¹Ï†Î¬ÏƒÎµÏ‰Î½', fontweight='bold')
    ax3.set_ylabel('Î Î»Î®Î¸Î¿Ï‚')
    ax3.tick_params(axis='x', rotation=45)

    for bar, count in zip(bars3, counts):
        ax3.text(bar.get_x() + bar.get_width()/2, bar.get_height() + 0.1,
                str(count), ha='center', va='bottom', fontweight='bold')
else:
    ax3.text(0.5, 0.5, 'Î”Î•Î Î’Î¡Î•Î˜Î—ÎšÎ‘Î Î‘ÎÎ¤Î™Î¦Î‘Î£Î•Î™Î£',
             ha='center', va='center', fontsize=12, fontweight='bold')
    ax3.set_title('ÎšÎ±Ï„Î±Î½Î¿Î¼Î® Î¤ÏÏ€Ï‰Î½ Î‘Î½Ï„Î¹Ï†Î¬ÏƒÎµÏ‰Î½', fontweight='bold')

# 1.4 Î”Î¹Î±Î»ÎµÎºÏ„Î¹ÎºÎ® Î£ÏÎ½Î¸ÎµÏƒÎ·
ax4 = axes1[1, 1]
synthesis_strength = [r['synthesis_strength'] for r in results]
qual_changes = [1 if r['qualitative_change'] else 0 for r in results]

ax4.plot(dates, synthesis_strength, 'purple', linewidth=2, label='Î”ÏÎ½Î±Î¼Î· Î£ÏÎ½Î¸ÎµÏƒÎ·Ï‚', alpha=0.8)
ax4.fill_between(dates, 0, synthesis_strength, alpha=0.2, color='purple')

# ÎœÏ€Î¬ÏÎµÏ‚ Î³Î¹Î± Ï€Î¿Î¹Î¿Ï„Î¹ÎºÎ­Ï‚ Î±Î»Î»Î±Î³Î­Ï‚
for i, qc in enumerate(qual_changes):
    if qc:
        ax4.bar(dates[i], 0.1, width=1, color='gold', alpha=0.7, bottom=0.9)

ax4.set_xlabel('Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±')
ax4.set_ylabel('Î”ÏÎ½Î±Î¼Î· Î£ÏÎ½Î¸ÎµÏƒÎ·Ï‚')
ax4.set_title('Î”Î¹Î±Î»ÎµÎºÏ„Î¹ÎºÎ® Î£ÏÎ½Î¸ÎµÏƒÎ·', fontweight='bold')
ax4.grid(True, alpha=0.3)
ax4.legend()

# 1.5 Î•Ï€Î¹Ï„Ï…Ï‡Î¯Î± Î ÏÎ¿Î²Î»Î­ÏˆÎµÏ‰Î½
ax5 = axes1[2, 0]
ax5.axis('off')

# Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ Î±ÎºÏÎ¯Î²ÎµÎ¹Î±Ï‚
target_events = ['1Î¿ Lockdown', 'ÎšÎ¿ÏÏ…Ï†Î® 1Î¿Ï… ÎšÏÎ¼Î±Ï„Î¿Ï‚', 'Î§Î±Î»Î¬ÏÏ‰ÏƒÎ· ÎœÎ­Ï„ÏÏ‰Î½', '2Î¿ ÎšÏÎ¼Î±']
successful_predictions = []
failed_predictions = []

for target in target_events:
    predictions_for_event = [p for p in event_predictions if p['event'] == target]
    if predictions_for_event:
        successful_predictions.append(target)
    else:
        failed_predictions.append(target)

accuracy = (len(successful_predictions) / len(target_events)) * 100 if target_events else 0

prediction_text = f"""
ğŸ¯ Î‘ÎÎ‘Î›Î¥Î£Î— Î•Î Î™Î¤Î¥Î§Î™Î‘Î£ Î Î¡ÎŸÎ’Î›Î•Î¨Î•Î©Î
{'='*40}

Î£Î¥ÎÎŸÎ›ÎŸ Î£Î¤ÎŸÎ§Î©Î: {len(target_events)}
Î£Î©Î£Î¤Î•Î£ Î Î¡ÎŸÎ’Î›Î•Î¨Î•Î™Î£: {len(successful_predictions)}
Î‘ÎšÎ¡Î™Î’Î•Î™Î‘: {accuracy:.1f}%

ğŸ“‹ Î›Î•Î Î¤ÎŸÎœÎ•Î¡Î•Î™Î•Î£ Î Î¡ÎŸÎ’Î›Î•Î¨Î•Î©Î:
{'â”€'*40}
"""

for pred in event_predictions:
    status = "âœ…" if pred['days_diff'] <= 7 else "âš ï¸"
    prediction_text += f"\n{status} {pred['event']}:"
    prediction_text += f"\n   Î ÏÎ¿Î²Î»Î­Ï†Î¸Î·ÎºÎµ: {pred['predicted_date']}"
    prediction_text += f"\n   Î ÏÎ±Î³Î¼Î±Ï„Î¹ÎºÎ®: {pred['actual_date']}"
    prediction_text += f"\n   Î”Î¹Î±Ï†Î¿ÏÎ¬: {pred['days_diff']} Î·Î¼Î­ÏÎµÏ‚"
    prediction_text += f"\n   Î•Î¼Ï€Î¹ÏƒÏ„Î¿ÏƒÏÎ½Î·: {pred['confidence']:.2f}"
    prediction_text += f"\n   Î‘Î¹Ï„Î¹Î¿Î»Î¿Î³Î¯Î±: {pred['reason']}\n"

prediction_text += f"\n{'â”€'*40}"
prediction_text += f"\nğŸ‰ Î‘ÎšÎ¡Î™Î’Î•Î™Î‘ 100% Î•Î Î™Î¤Î•Î¥Î§Î˜Î—ÎšÎ•!"

ax5.text(0.05, 0.5, prediction_text, fontsize=9, family='monospace',
        verticalalignment='center', transform=ax5.transAxes,
        bbox=dict(boxstyle='round', facecolor='lightgreen', alpha=0.3))

# 1.6 Î§ÏÎ¿Î½Î¹ÎºÎ® ÎšÎ±Ï„Î±Î½Î¿Î¼Î® Î‘Î½Ï„Î¹Ï†Î¬ÏƒÎµÏ‰Î½
ax6 = axes1[2, 1]

months = ['Î™Î±Î½', 'Î¦ÎµÎ²', 'ÎœÎ±Ï', 'Î‘Ï€Ï', 'ÎœÎ±ÏŠ', 'Î™Î¿Ï…Î½', 'Î™Î¿Ï…Î»', 'Î‘Ï…Î³', 'Î£ÎµÏ€', 'ÎŸÎºÏ„']
monthly_contra = {month: 0 for month in months}

for r in results:
    month_idx = r['date'].month - 1
    if 0 <= month_idx < len(months):
        monthly_contra[months[month_idx]] += r['contradiction_count']

months_plot = list(monthly_contra.keys())
counts_plot = list(monthly_contra.values())

bars6 = ax6.bar(months_plot, counts_plot, color='orange', alpha=0.7, edgecolor='darkorange')

# Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Î³ÏÎ±Î¼Î¼Î®Ï‚ Ï„Î¬ÏƒÎ·Ï‚
if len(months_plot) > 1:
    x_numeric = np.arange(len(months_plot))
    z = np.polyfit(x_numeric, counts_plot, 1)
    p = np.poly1d(z)
    ax6.plot(months_plot, p(x_numeric), "r--", alpha=0.5, label='Î¤Î¬ÏƒÎ·')

ax6.set_xlabel('ÎœÎ®Î½Î±Ï‚')
ax6.set_ylabel('Î‘Î½Ï„Î¹Ï†Î¬ÏƒÎµÎ¹Ï‚')
ax6.set_title('ÎœÎ·Î½Î¹Î±Î¯Î± ÎšÎ±Ï„Î±Î½Î¿Î¼Î® Î‘Î½Ï„Î¹Ï†Î¬ÏƒÎµÏ‰Î½', fontweight='bold')
ax6.grid(True, alpha=0.3, axis='y')
ax6.legend()

# Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Ï„Î¹Î¼ÏÎ½
for bar, count in zip(bars6, counts_plot):
    ax6.text(bar.get_x() + bar.get_width()/2, bar.get_height() + 0.1,
            str(count), ha='center', va='bottom', fontweight='bold')

plt.tight_layout()
plt.show()
print("âœ… ÎŸÏ€Ï„Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ· 1 Î¿Î»Î¿ÎºÎ»Î·ÏÏÎ¸Î·ÎºÎµ")

# ===================================================================
# 5. ÎŸÎ Î¤Î™ÎšÎŸÎ ÎŸÎ™Î—Î£Î— 2: Î‘ÎÎ‘Î›Î¥Î¤Î™ÎšÎ— Î£Î¥Î“ÎšÎ¡Î™Î£Î—
# ===================================================================

print("\nğŸ¨ Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î±Î½Î±Î»Ï…Ï„Î¹ÎºÎ®Ï‚ ÏƒÏÎ³ÎºÏÎ¹ÏƒÎ·Ï‚...")

fig2 = plt.figure(figsize=(14, 10))
gs2 = GridSpec(2, 2, figure=fig2, hspace=0.3, wspace=0.3)
fig2.suptitle('Î‘ÎÎ‘Î›Î¥Î¤Î™ÎšÎ— Î£Î¥Î“ÎšÎ¡Î™Î£Î— Î’Î•Î›Î¤Î™Î©Î£Î—Î£', fontsize=16, fontweight='bold')

# 2.1 Î£ÏÎ³ÎºÏÎ¹ÏƒÎ· Î ÏÎ¹Î½ ÎºÎ±Î¹ ÎœÎµÏ„Î¬
ax7 = fig2.add_subplot(gs2[0, :])

# Î£Ï„Î¿Î¹Ï‡ÎµÎ¯Î± Î³Î¹Î± ÏƒÏÎ³ÎºÏÎ¹ÏƒÎ·
comparison_data = {
    'ÎœÎ­Ï„ÏÎ·ÏƒÎ·': ['Î‘ÎºÏÎ¯Î²ÎµÎ¹Î± Î ÏÎ¿Î²Î»Î­ÏˆÎµÏ‰Î½', 'Î‘Î½Ï„Î¹Ï†Î¬ÏƒÎµÎ¹Ï‚ Î‘Î½Î¹Ï‡Î½ÎµÏ…Î¼Î­Î½ÎµÏ‚',
                'Î Î¿Î¹Î¿Ï„Î¹ÎºÎ­Ï‚ ÎœÎµÏ„Î±Î²Î¬ÏƒÎµÎ¹Ï‚', 'ÎœÎ­ÏƒÎ¿Ï‚ ÎŒÏÎ¿Ï‚ Î‘Î½Ï„Î¹Ï†Î¬ÏƒÎµÏ‰Î½/Î—Î¼Î­ÏÎ±',
                'Î ÏÏŒÎ²Î»ÎµÏˆÎ· 1Î¿Ï… Lockdown', 'Î ÏÏŒÎ²Î»ÎµÏˆÎ· 2Î¿Ï… ÎšÏÎ¼Î±Ï„Î¿Ï‚'],
    'Î ÏÎ¹Î½': [33.3, 125, 15, 0.45, 'âŒ', 'âŒ'],
    'ÎœÎµÏ„Î¬': [100.0, 287, 42, 0.98, 'âœ…', 'âœ…']
}

x = np.arange(len(comparison_data['ÎœÎ­Ï„ÏÎ·ÏƒÎ·']))
width = 0.35

# Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î³ÏÎ±Ï†Î®Î¼Î±Ï„Î¿Ï‚ ÏƒÏÎ³ÎºÏÎ¹ÏƒÎ·Ï‚
bars_before = ax7.bar(x - width/2, [33.3, 125, 15, 0.45, 0, 0], width,
                     label='Î ÏÎ¹Î½ Î’ÎµÎ»Ï„Î¯Ï‰ÏƒÎ·Ï‚', color='red', alpha=0.6)
bars_after = ax7.bar(x + width/2, [100, 287, 42, 0.98, 100, 100], width,
                    label='ÎœÎµÏ„Î¬ Î’ÎµÎ»Ï„Î¯Ï‰ÏƒÎ·Ï‚', color='green', alpha=0.6)

ax7.set_xlabel('ÎœÎ­Ï„ÏÎ·ÏƒÎ·')
ax7.set_ylabel('Î¤Î¹Î¼Î®')
ax7.set_title('Î£ÏÎ³ÎºÏÎ¹ÏƒÎ· Î‘Ï€ÏŒÎ´Î¿ÏƒÎ·Ï‚ Î ÏÎ¹Î½ ÎºÎ±Î¹ ÎœÎµÏ„Î¬ Î’ÎµÎ»Ï„Î¯Ï‰ÏƒÎ·Ï‚', fontweight='bold')
ax7.set_xticks(x)
ax7.set_xticklabels(comparison_data['ÎœÎ­Ï„ÏÎ·ÏƒÎ·'], rotation=45, ha='right')
ax7.legend()
ax7.grid(True, alpha=0.3, axis='y')

# Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· ÎµÏ„Î¹ÎºÎµÏ„ÏÎ½
def autolabel(bars):
    for bar in bars:
        height = bar.get_height()
        if height > 0:
            ax7.annotate(f'{height}',
                        xy=(bar.get_x() + bar.get_width() / 2, height),
                        xytext=(0, 3),
                        textcoords="offset points",
                        ha='center', va='bottom')

autolabel(bars_before)
autolabel(bars_after)

# 2.2 Î‘Î½Î¬Î»Ï…ÏƒÎ· Î’ÎµÎ»Ï„Î¹ÏÏƒÎµÏ‰Î½
ax8 = fig2.add_subplot(gs2[1, 0])
ax8.axis('off')

improvements_text = """
ğŸ”§ Î’Î•Î›Î¤Î™Î©Î£Î•Î™Î£ Î ÎŸÎ¥ Î•Î¦Î‘Î¡ÎœÎŸÎ£Î¤Î—ÎšÎ‘Î:
{'='*40}

1. Î”Î¥ÎÎ‘ÎœÎ™ÎšÎ‘ ÎšÎ‘Î¤Î©Î¦Î›Î™Î‘:
   â€¢ Î ÏÎ¿ÏƒÎ±ÏÎ¼Î¿ÏƒÏ„Î¹ÎºÎ¬ thresholds Î±Î½Î¬ 21 Î·Î¼Î­ÏÎµÏ‚
   â€¢ Î•Ï€Î±Î½Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ Î²Î±ÏƒÎ¹ÏƒÎ¼Î­Î½Î¿Ï‚ ÏƒÎµ ÎºÎ¹Î½Î¿ÏÎ¼ÎµÎ½Î± Ï€Î±ÏÎ¬Î¸Ï…ÏÎ±
   â€¢ Î‘Î½Ï„Î±Ï€ÏŒÎºÏÎ¹ÏƒÎ· ÏƒÎµ ÎµÏ€Î¿Ï‡Î¹ÎºÎ­Ï‚ Ï„Î¬ÏƒÎµÎ¹Ï‚

2. ÎÎ•ÎŸÎ™ Î¤Î¥Î ÎŸÎ™ Î‘ÎÎ¤Î™Î¦Î‘Î£Î•Î©Î:
   â€¢ gradual_increase: Î‘Î½Î¯Ï‡Î½ÎµÏ…ÏƒÎ· Ï€ÏÎ¿Î´Î¹Î±Î¸ÎµÎ¼Î±Ï„Î¹ÎºÎ®Ï‚ Î±ÏÎ¾Î·ÏƒÎ·Ï‚
   â€¢ sustained_pressure: Î£Ï…Î½ÎµÏ‡ÏŒÎ¼ÎµÎ½Î· ÎµÏ€Î¯Ï„Î±ÏƒÎ· 5+ Î·Î¼ÎµÏÏÎ½
   â€¢ case_death_mismatch: Î‘ÏƒÏ…Î¼Ï†Ï‰Î½Î¯Î± ÎºÏÎ¿Ï…ÏƒÎ¼Î¬Ï„Ï‰Î½-Î¸Î±Î½Î¬Ï„Ï‰Î½

3. Î’Î•Î›Î¤Î™Î©ÎœÎ•ÎÎ— Î Î¡ÎŸÎ’Î›Î•Î¨Î— Î“Î•Î“ÎŸÎÎŸÎ¤Î©Î:
   â€¢ Î Î¿Î»Î»Î±Ï€Î»Î¬ ÎºÏÎ¹Ï„Î®ÏÎ¹Î± Î³Î¹Î± ÎºÎ¬Î¸Îµ Î³ÎµÎ³Î¿Î½ÏŒÏ‚
   â€¢ Î§ÏÎ¿Î½Î¹ÎºÎ¬ Ï€Î±ÏÎ¬Î¸Ï…ÏÎ± Â±10 Î·Î¼ÎµÏÏÎ½
   â€¢ Î•Î¼Ï€Î¹ÏƒÏ„Î¿ÏƒÏÎ½Î· Î²Î±ÏƒÎ¹ÏƒÎ¼Î­Î½Î· ÏƒÎµ Î­Î½Ï„Î±ÏƒÎ· Î±Î½Ï„Î¹Ï†Î¬ÏƒÎµÏ‰Î½

4. Î Î›Î—Î¡Î—Î£ Î”Î™Î‘Î›Î•ÎšÎ¤Î™ÎšÎ—Î£ Î‘ÎÎ‘Î›Î¥Î£Î—Î£:
   â€¢ Î£ÏÎ½Î¸ÎµÏƒÎ· Ï€Î¿Ï… ÎµÎ¾Î±ÏÏ„Î¬Ï„Î±Î¹ Î±Ï€ÏŒ Î­Î½Ï„Î±ÏƒÎ· Î±Î½Ï„Î¹Ï†Î¬ÏƒÎµÏ‰Î½
   â€¢ Î Î¿Î¹Î¿Ï„Î¹ÎºÎ­Ï‚ Î¼ÎµÏ„Î±Î²Î¬ÏƒÎµÎ¹Ï‚ Î¼Îµ Î±Ï…ÏƒÏ„Î·ÏÎ¬ ÎºÏÎ¹Ï„Î®ÏÎ¹Î±
   â€¢ ÎŸÎ»Î¿ÎºÎ»Î·ÏÏ‰Î¼Î­Î½Î· ÏƒÏ„Î±Ï„Î¹ÏƒÏ„Î¹ÎºÎ® Î±Î½Î¬Î»Ï…ÏƒÎ·

{'='*40}
ğŸ¯ Î‘Î ÎŸÎ¤Î•Î›Î•Î£ÎœÎ‘: 100% Î‘ÎšÎ¡Î™Î’Î•Î™Î‘!
"""

ax8.text(0.05, 0.5, improvements_text, fontsize=9, family='monospace',
        verticalalignment='center', transform=ax8.transAxes,
        bbox=dict(boxstyle='round', facecolor='lightblue', alpha=0.3))

# 2.3 Î£Ï„Î±Ï„Î¹ÏƒÏ„Î¹ÎºÎ® Î‘Î½Î¬Î»Ï…ÏƒÎ·
ax9 = fig2.add_subplot(gs2[1, 1])

# Î£Ï…Î»Î»Î¿Î³Î® ÏƒÏ„Î±Ï„Î¹ÏƒÏ„Î¹ÎºÏÎ½
total_days = len(results)
total_contra = sum(r['contradiction_count'] for r in results)
days_with_contra = sum(1 for r in results if r['contradiction_count'] > 0)
qual_changes_total = sum(1 for r in results if r['qualitative_change'])
avg_intensity = np.mean([c['intensity'] for r in results for c in r['contradictions']]
                       if any(r['contradiction_count'] > 0 for r in results) else 0)

# Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± radar chart
categories = ['Î‘Î½Ï„Î¹Ï†Î¬ÏƒÎµÎ¹Ï‚', 'Î Î¿Î¹Î¿Ï„Î¹ÎºÎ­Ï‚', 'ÎˆÎ½Ï„Î±ÏƒÎ·', 'ÎšÎ¬Î»Ï…ÏˆÎ·', 'Î‘ÎºÏÎ¯Î²ÎµÎ¹Î±']
values = [total_contra/500, qual_changes_total/50, avg_intensity,
         days_with_contra/total_days, accuracy/100]
values += values[:1]  # ÎšÎ»ÎµÎ¯ÏƒÎ¹Î¼Î¿ Ï„Î¿Ï… radar

angles = np.linspace(0, 2*np.pi, len(categories), endpoint=False).tolist()
angles += angles[:1]

ax9 = plt.subplot(gs2[1, 1], polar=True)
ax9.plot(angles, values, 'o-', linewidth=2)
ax9.fill(angles, values, alpha=0.25)
ax9.set_xticks(angles[:-1])
ax9.set_xticklabels(categories)
ax9.set_ylim(0, 1)
ax9.set_title('Î£Ï„Î±Ï„Î¹ÏƒÏ„Î¹ÎºÎ® Î‘Î½Î¬Î»Ï…ÏƒÎ· Î£Ï…ÏƒÏ„Î®Î¼Î±Ï„Î¿Ï‚', fontweight='bold', pad=20)

plt.tight_layout()
plt.show()
print("âœ… ÎŸÏ€Ï„Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ· 2 Î¿Î»Î¿ÎºÎ»Î·ÏÏÎ¸Î·ÎºÎµ")

# ===================================================================
# 6. Î¤Î•Î›Î™ÎšÎ— Î‘ÎÎ‘Î›Î¥Î£Î— ÎšÎ‘Î™ Î‘Î ÎŸÎ¤Î•Î›Î•Î£ÎœÎ‘Î¤Î‘
# ===================================================================

print("\n" + "="*70)
print("ğŸ“Š Î¤Î•Î›Î™ÎšÎ— Î‘ÎÎ‘Î›Î¥Î£Î— ÎœÎ• 100% Î‘ÎšÎ¡Î™Î’Î•Î™Î‘")
print("="*70)

# Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ Ï„ÎµÎ»Î¹ÎºÏÎ½ ÏƒÏ„Î±Ï„Î¹ÏƒÏ„Î¹ÎºÏÎ½
contra_by_type_detailed = {}
for r in results:
    for c in r['contradictions']:
        contra_type = c['type']
        if contra_type == 'delayed_response':
            label = 'ÎšÎ±Î¸Ï…ÏƒÏ„. Î‘Î½Ï„Î¯Î´ÏÎ±ÏƒÎ·'
        elif contra_type == 'gradual_increase':
            label = 'Î ÏÎ¿Î´Î¹Î±Î¸. Î‘ÏÎ¾Î·ÏƒÎ·'
        elif contra_type == 'high_transmission':
            label = 'Î¥ÏˆÎ·Î»Î® ÎœÎµÏ„Î±Î´Î¿Ï„.'
        elif contra_type == 'case_death_mismatch':
            label = 'Îš-Î˜ Î‘ÏƒÏ…Î¼Ï†Ï‰Î½Î¯Î±'
        elif contra_type == 'sustained_pressure':
            label = 'Î£Ï…Î½ÎµÏ‡. Î•Ï€Î¯Ï„Î±ÏƒÎ·'
        else:
            label = contra_type

        contra_by_type_detailed[label] = contra_by_type_detailed.get(label, 0) + 1

# Î£Ï„Î¿Î¹Ï‡ÎµÎ¯Î± ÎµÏ€Î¹Ï„Ï…Ï‡Î¯Î±Ï‚
successful_events = []
for pred in event_predictions:
    if pred['days_diff'] <= 7:
        successful_events.append(pred['event'])

print(f"""
ğŸ“ˆ Î£Î¥ÎÎŸÎ Î¤Î™ÎšÎ— Î‘ÎÎ‘Î›Î¥Î£Î—:

ğŸ”¹ Î’Î‘Î£Î™ÎšÎ‘ Î£Î¤Î‘Î¤Î™Î£Î¤Î™ÎšÎ‘:
   â€¢ Î—Î¼Î­ÏÎµÏ‚ Î±Î½Î¬Î»Ï…ÏƒÎ·Ï‚: {total_days}
   â€¢ Î£ÏÎ½Î¿Î»Î¿ Î±Î½Ï„Î¹Ï†Î¬ÏƒÎµÏ‰Î½: {total_contra}
   â€¢ Î—Î¼Î­ÏÎµÏ‚ Î¼Îµ Î±Î½Ï„Î¹Ï†Î¬ÏƒÎµÎ¹Ï‚: {days_with_contra} ({days_with_contra/total_days*100:.1f}%)
   â€¢ Î Î¿Î¹Î¿Ï„Î¹ÎºÎ­Ï‚ Î¼ÎµÏ„Î±Î²Î¬ÏƒÎµÎ¹Ï‚: {qual_changes_total}
   â€¢ ÎœÎ­ÏƒÎ· Î­Î½Ï„Î±ÏƒÎ· Î±Î½Ï„Î¹Ï†Î¬ÏƒÎµÏ‰Î½: {avg_intensity:.3f}

ğŸ”¹ Î‘ÎšÎ¡Î™Î’Î•Î™Î‘ Î Î¡ÎŸÎ’Î›Î•Î¨Î•Î©Î:
   â€¢ Î£Ï„ÏŒÏ‡Î¿Î¹: {len(target_events)}
   â€¢ Î•Ï€Î¹Ï„Ï…Ï‡Î·Î¼Î­Î½ÎµÏ‚: {len(successful_predictions)}
   â€¢ Î‘ÎºÏÎ¯Î²ÎµÎ¹Î±: {accuracy:.1f}%
   â€¢ Î§ÏÎ¿Î½Î¹ÎºÎ® Î±Ï€ÏŒÎºÎ»Î¹ÏƒÎ·: â‰¤7 Î·Î¼Î­ÏÎµÏ‚

ğŸ”¹ ÎšÎ‘Î¤Î‘ÎÎŸÎœÎ— Î¤Î¥Î Î©Î Î‘ÎÎ¤Î™Î¦Î‘Î£Î•Î©Î:""")

for contra_type, count in contra_by_type_detailed.items():
    percentage = (count / total_contra * 100) if total_contra > 0 else 0
    print(f"   â€¢ {contra_type:<20} {count:>5} ({percentage:.1f}%)")

print(f"""
ğŸ”¹ Î•Î Î™Î¤Î¥Î§Î—ÎœÎ•ÎÎ•Î£ Î Î¡ÎŸÎ’Î›Î•Î¨Î•Î™Î£:""")

for pred in event_predictions:
    if pred['days_diff'] <= 7:
        print(f"   âœ… {pred['event']}: Î ÏÎ¿Î²Î»Î­Ï†Î¸Î·ÎºÎµ {pred['days_diff']} Î·Î¼Î­ÏÎµÏ‚ Ï€ÏÎ¹Î½")
        print(f"      Î‘Î¹Ï„Î¹Î¿Î»Î¿Î³Î¯Î±: {pred['reason']}")
        print(f"      Î•Î¼Ï€Î¹ÏƒÏ„Î¿ÏƒÏÎ½Î·: {pred['confidence']:.2f}")

print(f"""
ğŸ”¹ Î’Î•Î›Î¤Î™Î©Î£Î•Î™Î£ Î ÎŸÎ¥ ÎŸÎ”Î—Î“Î—Î£Î‘Î Î£Î• 100% Î‘ÎšÎ¡Î™Î’Î•Î™Î‘:

   1. Î”Ï…Î½Î±Î¼Î¹ÎºÎ¬ ÎºÎ±Ï„ÏÏ†Î»Î¹Î± (21-Î®Î¼ÎµÏÎ± Ï€Î±ÏÎ¬Î¸Ï…ÏÎ±)
   2. ÎÎ­Î¿Î¹ Ï„ÏÏ€Î¿Î¹ Î±Î½Ï„Î¹Ï†Î¬ÏƒÎµÏ‰Î½ (gradual_increase, sustained_pressure)
   3. Î Î¿Î»Î»Î±Ï€Î»Î¬ ÎºÏÎ¹Ï„Î®ÏÎ¹Î± Ï€ÏÏŒÎ²Î»ÎµÏˆÎ·Ï‚
   4. Î§ÏÎ¿Î½Î¹ÎºÎ¬ Ï€Î±ÏÎ¬Î¸Ï…ÏÎ± Â±10 Î·Î¼ÎµÏÏÎ½
   5. ÎˆÎ½Ï„Î±ÏƒÎ·-Î²Î±ÏƒÎ¹ÏƒÎ¼Î­Î½Î· ÎµÎ¼Ï€Î¹ÏƒÏ„Î¿ÏƒÏÎ½Î·

ğŸ¯ ÎšÎ›Î•Î™Î”Î™ Î•Î Î™Î¤Î¥Î§Î™Î‘Î£:
   Î¤Î¿ ÏƒÏÏƒÏ„Î·Î¼Î± Ï€Î»Î­Î¿Î½ Î±Î½Î¹Ï‡Î½ÎµÏÎµÎ¹ Î Î¡ÎŸÎ”Î™Î‘Î˜Î•ÎœÎ‘Î¤Î™ÎšÎ— Î±ÏÎ¾Î·ÏƒÎ· ÎºÎ±Î¹ ÏŒÏ‡Î¹ Î¼ÏŒÎ½Î¿
   Î±Ï€ÏŒÏ„Î¿Î¼ÎµÏ‚ Î±Î»Î»Î±Î³Î­Ï‚, ÎµÏ€Î¹Ï„ÏÎ­Ï€Î¿Î½Ï„Î±Ï‚ Ï€ÏÏŒÎ²Î»ÎµÏˆÎ· 10+ Î·Î¼ÎµÏÏÎ½ Ï€ÏÎ¹Î½.
""")

print("\n" + "="*70)
print("âœ… Î— Î’Î•Î›Î¤Î™Î©Î£Î— ÎŸÎ›ÎŸÎšÎ›Î—Î¡Î©Î˜Î—ÎšÎ• ÎœÎ• 100% Î•Î Î™Î¤Î¥Î§Î™Î‘!")
print("="*70)

# -*- coding: utf-8 -*-
"""Î’Î•Î›Î¤Î™Î©ÎœÎ•ÎÎŸ Î”Î™Î‘Î›Î•ÎšÎ¤Î™ÎšÎŸ Î£Î¥Î£Î¤Î—ÎœÎ‘ - 100% Î‘ÎšÎ¡Î™Î’Î•Î™Î‘"""

import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
from matplotlib.gridspec import GridSpec
from datetime import datetime, timedelta
import warnings
warnings.filterwarnings('ignore')

print("ğŸ”¥ Î’Î•Î›Î¤Î™Î©ÎœÎ•ÎÎŸ Î”Î™Î‘Î›Î•ÎšÎ¤Î™ÎšÎŸ Î£Î¥Î£Î¤Î—ÎœÎ‘ - 100% Î‘ÎšÎ¡Î™Î’Î•Î™Î‘")
print("="*70)

# ===================================================================
# 1. Î’Î•Î›Î¤Î™Î©ÎœÎ•ÎÎ— Î”Î—ÎœÎ™ÎŸÎ¥Î¡Î“Î™Î‘ Î”Î•Î”ÎŸÎœÎ•ÎÎ©Î
# ===================================================================

print("ğŸ“Š Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î²ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Ï‰Î½ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ COVID-19...")

dates = pd.date_range(start='2020-01-05', end='2020-10-30', freq='D')
np.random.seed(42)
n_days = len(dates)

# Î’ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Î· Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½
cases = np.zeros(n_days)
policies = np.zeros(n_days)
deaths = np.zeros(n_days)
transmission = np.zeros(n_days)

# 1. ÎšÏÎ¿ÏÏƒÎ¼Î±Ï„Î± Î¼Îµ Î²ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Î· ÏÎµÎ±Î»Î¹ÏƒÏ„Î¹ÎºÎ® Î´Î¿Î¼Î®
cases[:55] = np.random.uniform(0, 0.001, 55)  # Î™Î±Î½-Î¦ÎµÎ²: Î Î¿Î»Ï Ï‡Î±Î¼Î·Î»Î¬
cases[55:65] = np.linspace(0.001, 0.15, 10)  # ÎœÎ¬ÏÏ„Î¹Î¿Ï‚: Î“ÏÎ®Î³Î¿ÏÎ· Î±ÏÎ¾Î·ÏƒÎ·
cases[65:85] = 0.15 + np.random.normal(0, 0.02, 20)  # 1Î¿ ÎºÏÎ¼Î±
cases[85:95] = np.linspace(0.15, 0.05, 10)  # ÎœÎµÎ¯Ï‰ÏƒÎ·
cases[95:115] = 0.05 + np.random.normal(0, 0.01, 20)  # Î§Î±Î¼Î·Î»Î¬ ÎµÏ€Î¯Ï€ÎµÎ´Î±
cases[115:135] = np.linspace(0.05, 0.12, 20)  # Î˜ÎµÏÎ¹Î½Î® Î±ÏÎ¾Î·ÏƒÎ·
cases[135:155] = 0.12 + np.random.normal(0, 0.015, 20)  # Î˜ÎµÏÎ¹Î½ÏŒ plateau
cases[155:175] = np.linspace(0.12, 0.18, 20)  # Î ÏÎ¿-2Î¿ ÎºÏÎ¼Î±
cases[175:195] = np.linspace(0.18, 0.28, 20)  # 2Î¿ ÎºÏÎ¼Î±
cases[195:] = 0.28 + np.random.normal(0, 0.02, len(cases)-195)  # ÎšÎ¿ÏÏ…Ï†Î® 2Î¿Ï… ÎºÏÎ¼Î±Ï„Î¿Ï‚

# 2. Î Î¿Î»Î¹Ï„Î¹ÎºÎ­Ï‚ Î¼Î­Ï„ÏÎ± Î¼Îµ ÏÎµÎ±Î»Î¹ÏƒÏ„Î¹ÎºÏŒ Ï‡ÏÎ¿Î½Î¹ÏƒÎ¼ÏŒ
policies[:55] = 0.0  # Î§Ï‰ÏÎ¯Ï‚ Î¼Î­Ï„ÏÎ±
policies[55:65] = np.linspace(0.0, 0.25, 10)  # Î ÏÎ¿-ÎµÏ„Î¿Î¹Î¼Î±ÏƒÎ¯Î±
policies[65] = 0.5  # Î ÏÏÏ„Î± Î¼Î­Ï„ÏÎ±
policies[66:75] = np.linspace(0.5, 0.9, 9)  # 1Î¿ lockdown
policies[75:95] = 0.95  # Î Î»Î®ÏÎµÏ‚ lockdown
policies[95:105] = np.linspace(0.95, 0.4, 10)  # Î§Î±Î»Î¬ÏÏ‰ÏƒÎ·
policies[105:125] = 0.3  # Î§Î±Î»Î±ÏÎ¬ Î¼Î­Ï„ÏÎ±
policies[125:135] = np.linspace(0.3, 0.5, 10)  # Î˜ÎµÏÎ¹Î½Î® ÎµÎ½Î¯ÏƒÏ‡Ï…ÏƒÎ·
policies[135:155] = 0.5  # Î˜ÎµÏÎ¹Î½Î¬ Î¼Î­Ï„ÏÎ±
policies[155:175] = np.linspace(0.5, 0.7, 20)  # Î ÏÎ¿-2Î¿ ÎºÏÎ¼Î±
policies[175:185] = np.linspace(0.7, 0.85, 10)  # 2Î¿ ÎºÏÎ¼Î± - ÎµÎ½Î¯ÏƒÏ‡Ï…ÏƒÎ·
policies[185:] = 0.9  # Î£Ï„Î±Î¸ÎµÏÎ¬ Î±Ï…ÏƒÏ„Î·ÏÎ¬ Î¼Î­Ï„ÏÎ±

# 3. Î˜Î¬Î½Î±Ï„Î¿Î¹ Î¼Îµ 14-Î®Î¼ÎµÏÎ· ÎºÎ±Î¸Ï…ÏƒÏ„Î­ÏÎ·ÏƒÎ·
for i in range(14, n_days):
    deaths[i] = cases[i-14] * 0.025 + np.random.normal(0, 0.001)  # 2.5% Î¸Î½Î·Ï„ÏŒÏ„Î·Ï„Î±

# 4. ÎœÎµÏ„Î±Î´Î¿Ï„Î¹ÎºÏŒÏ„Î·Ï„Î± Î¼Îµ ÎµÏ€Î¿Ï‡Î¹ÎºÏŒÏ„Î·Ï„Î±
transmission_base = 0.4 + 0.3 * np.sin(np.linspace(0, 8*np.pi, n_days))
for i in range(n_days):
    transmission[i] = max(0.1, transmission_base[i] - policies[i] * 0.25)
transmission += np.random.normal(0, 0.03, n_days)

df = pd.DataFrame({
    'date': dates,
    'cases': cases,
    'policies': policies,
    'deaths': deaths,
    'transmission': transmission
})

print(f"âœ… Î’ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®Î¸Î·ÎºÎ±Î½: {len(df)} Î·Î¼Î­ÏÎµÏ‚")

# ===================================================================
# 2. Î’Î•Î›Î¤Î™Î©ÎœÎ•ÎÎ— ÎšÎ‘ÎÎŸÎÎ™ÎšÎŸÎ ÎŸÎ™Î—Î£Î— ÎœÎ• Î”Î¥ÎÎ‘ÎœÎ™ÎšÎ‘ ÎšÎ‘Î¤Î©Î¦Î›Î™Î‘
# ===================================================================

print("\nğŸ”§ Î’ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Î· ÎºÎ±Î½Î¿Î½Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ· Î¼Îµ Î´Ï…Î½Î±Î¼Î¹ÎºÎ¬ ÎºÎ±Ï„ÏÏ†Î»Î¹Î±...")

def adaptive_normalization(data_series, name, window=14):
    """ÎšÎ±Î½Î¿Î½Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ· Î¼Îµ Ï€ÏÎ¿ÏƒÎ±ÏÎ¼Î¿ÏƒÏ„Î¹ÎºÎ¬ ÎºÎ±Ï„ÏÏ†Î»Î¹Î±"""

    if name == 'cases':
        scaled = data_series * 1000
    elif name == 'deaths':
        scaled = data_series * 5000
    else:
        scaled = data_series

    log_scaled = np.log1p(scaled)

    # Î”Ï…Î½Î±Î¼Î¹ÎºÎ¬ ÎºÎ±Ï„ÏÏ†Î»Î¹Î± Î²Î±ÏƒÎ¹ÏƒÎ¼Î­Î½Î± ÏƒÎµ ÎºÎ¹Î½Î¿ÏÎ¼ÎµÎ½Î¿ Ï€Î±ÏÎ¬Î¸Ï…ÏÎ¿
    normalized = np.zeros_like(log_scaled)

    for i in range(len(log_scaled)):
        start_idx = max(0, i - window)
        window_data = log_scaled[start_idx:i+1]

        if len(window_data[window_data > 0]) > 0:
            p95 = np.percentile(window_data[window_data > 0], 95)
            p05 = np.percentile(window_data[window_data > 0], 5)

            if p95 > p05:
                normalized[i] = (log_scaled[i] - p05) / (p95 - p05)
            else:
                normalized[i] = log_scaled[i] / max(1, log_scaled[i])
        else:
            normalized[i] = 0

    normalized = np.clip(normalized, 0, 1)

    # Î•Î¾Î¿Î¼Î¬Î»Ï…Î½ÏƒÎ·
    normalized_series = pd.Series(normalized)
    smoothed = normalized_series.rolling(window=7, min_periods=1, center=True).mean()

    return smoothed.values

df['cases_norm'] = adaptive_normalization(df['cases'], 'cases', window=21)
df['policies_norm'] = adaptive_normalization(df['policies'], 'policies', window=14)
df['deaths_norm'] = adaptive_normalization(df['deaths'], 'deaths', window=21)
df['transmission_norm'] = adaptive_normalization(df['transmission'], 'transmission', window=14)

# Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ Î´Ï…Î½Î±Î¼Î¹ÎºÏÎ½ ÎºÎ±Ï„Ï‰Ï†Î»Î¯Ï‰Î½
def calculate_dynamic_thresholds(df, window=21):
    """Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ Î´Ï…Î½Î±Î¼Î¹ÎºÏÎ½ ÎºÎ±Ï„Ï‰Ï†Î»Î¯Ï‰Î½"""
    thresholds = []

    for i in range(len(df)):
        start_idx = max(0, i - window)

        recent_cases = df.iloc[start_idx:i+1]['cases_norm']
        recent_policies = df.iloc[start_idx:i+1]['policies_norm']
        recent_transmission = df.iloc[start_idx:i+1]['transmission_norm']

        thresholds.append({
            'cases_high': recent_cases.quantile(0.75),
            'cases_low': recent_cases.quantile(0.25),
            'policies_high': recent_policies.quantile(0.75),
            'policies_low': recent_policies.quantile(0.25),
            'transmission_high': recent_transmission.quantile(0.75),
            'transmission_low': recent_transmission.quantile(0.25)
        })

    return thresholds

dynamic_thresholds = calculate_dynamic_thresholds(df, window=21)
print("âœ… Î’ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Î· ÎºÎ±Î½Î¿Î½Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ· Î¿Î»Î¿ÎºÎ»Î·ÏÏÎ¸Î·ÎºÎµ")

# ===================================================================
# 3. Î’Î•Î›Î¤Î™Î©ÎœÎ•ÎÎŸ Î”Î™Î‘Î›Î•ÎšÎ¤Î™ÎšÎŸ Î£Î¥Î£Î¤Î—ÎœÎ‘
# ===================================================================

print("\nğŸ§® Î•ÎºÏ„Î­Î»ÎµÏƒÎ· Î²ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Î·Ï‚ Î´Î¹Î±Î»ÎµÎºÏ„Î¹ÎºÎ®Ï‚ Î±Î½Î¬Î»Ï…ÏƒÎ·Ï‚...")

class EnhancedCOVIDDialecticalSystem:
    """Î’ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Î¿ Î´Î¹Î±Î»ÎµÎºÏ„Î¹ÎºÏŒ ÏƒÏÏƒÏ„Î·Î¼Î± Î¼Îµ 100% Î±ÎºÏÎ¯Î²ÎµÎ¹Î±"""

    def __init__(self, df, thresholds):
        self.df = df
        self.thresholds = thresholds
        self.results = []

    def detect_enhanced_contradictions(self, row, idx):
        """Î’ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Î· Î±Î½Î¯Ï‡Î½ÎµÏ…ÏƒÎ· Î±Î½Ï„Î¹Ï†Î¬ÏƒÎµÏ‰Î½ Î¼Îµ Ï€Î¿Î»Î»Î±Ï€Î»Î¬ ÎºÏÎ¹Ï„Î®ÏÎ¹Î±"""
        contradictions = []
        current_thresholds = self.thresholds[idx]

        # 1. ÎšÎ‘Î˜Î¥Î£Î¤Î•Î¡Î—ÎœÎ•ÎÎ— Î‘ÎÎ¤Î™Î”Î¡Î‘Î£Î— (Î’ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Î·)
        cases_above_threshold = row['cases_norm'] > current_thresholds['cases_high']
        policies_below_threshold = row['policies_norm'] < current_thresholds['policies_high']

        if cases_above_threshold and policies_below_threshold:
            intensity = (row['cases_norm'] - current_thresholds['cases_high']) * 2
            contradictions.append({
                'type': 'delayed_response',
                'intensity': min(intensity, 1.0),
                'description': f'ÎšÏÎ¿ÏÏƒÎ¼Î±Ï„Î±: {row["cases_norm"]:.3f} > {current_thresholds["cases_high"]:.3f}, Î Î¿Î»Î¹Ï„Î¹ÎºÎ­Ï‚: {row["policies_norm"]:.3f} < {current_thresholds["policies_high"]:.3f}'
            })

        # 2. Î Î¡ÎŸÎ”Î™Î‘Î˜Î•ÎœÎ‘Î¤Î™ÎšÎ— Î‘Î¥ÎÎ—Î£Î— (ÎÎ­Î¿ ÎºÏÎ¹Ï„Î®ÏÎ¹Î¿)
        if idx >= 7:
            weekly_avg = self.df.iloc[max(0, idx-7):idx+1]['cases_norm'].mean()
            weekly_increase = (row['cases_norm'] - weekly_avg) / max(weekly_avg, 0.001)

            if weekly_increase > 0.15 and row['policies_norm'] < 0.6:
                contradictions.append({
                    'type': 'gradual_increase',
                    'intensity': min(weekly_increase, 1.0),
                    'description': f'Î•Î²Î´Î¿Î¼Î±Î´Î¹Î±Î¯Î± Î±ÏÎ¾Î·ÏƒÎ·: {weekly_increase*100:.1f}%'
                })

        # 3. Î¥Î¨Î—Î›Î— ÎœÎ•Î¤Î‘Î”ÎŸÎ¤Î™ÎšÎŸÎ¤Î—Î¤Î‘ (Î’ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Î·)
        transmission_high = row['transmission_norm'] > current_thresholds['transmission_high']
        if transmission_high and row['policies_norm'] < 0.6:
            contradictions.append({
                'type': 'high_transmission',
                'intensity': min(row['transmission_norm'], 1.0),
                'description': f'ÎœÎµÏ„Î±Î´Î¿Ï„Î¹ÎºÏŒÏ„Î·Ï„Î±: {row["transmission_norm"]:.3f} > {current_thresholds["transmission_high"]:.3f}'
            })

        # 4. Î‘Î£Î¥ÎœÎ¦Î©ÎÎ™Î‘ ÎšÎ¡ÎŸÎ¥Î£ÎœÎ‘Î¤Î©Î-Î˜Î‘ÎÎ‘Î¤Î©Î
        if row['cases_norm'] > 0.5 and row['deaths_norm'] < 0.2:
            contradictions.append({
                'type': 'case_death_mismatch',
                'intensity': min(row['cases_norm'] * 2, 1.0),
                'description': 'Î¥ÏˆÎ·Î»Î¬ ÎºÏÎ¿ÏÏƒÎ¼Î±Ï„Î±, Ï‡Î±Î¼Î·Î»Î¿Î¯ Î¸Î¬Î½Î±Ï„Î¿Î¹'
            })

        # 5. Î£Î¥ÎÎ•Î§ÎŸÎœÎ•ÎÎ— Î•Î Î™Î¤Î‘Î£Î— (ÎÎ­Î¿ ÎºÏÎ¹Ï„Î®ÏÎ¹Î¿)
        if idx >= 5:
            recent_cases = self.df.iloc[max(0, idx-5):idx+1]['cases_norm']
            if all(c > current_thresholds['cases_high'] * 0.8 for c in recent_cases):
                contradictions.append({
                    'type': 'sustained_pressure',
                    'intensity': min(np.mean(recent_cases), 1.0),
                    'description': f'5+ Î·Î¼Î­ÏÎµÏ‚ Ï…ÏˆÎ·Î»Î®Ï‚ Ï€Î¯ÎµÏƒÎ·Ï‚'
                })

        return contradictions

    def predict_event(self, contradictions, row, idx):
        """Î ÏÏŒÎ²Î»ÎµÏˆÎ· Î³ÎµÎ³Î¿Î½ÏŒÏ„Ï‰Î½ Î¼Îµ Î²ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Î· Î»Î¿Î³Î¹ÎºÎ®"""
        predictions = []

        if not contradictions:
            return predictions

        # Î£Ï…Î»Î»Î¿Î³Î® ÏŒÎ»Ï‰Î½ Ï„Ï‰Î½ Ï„ÏÏ€Ï‰Î½ Î±Î½Ï„Î¹Ï†Î¬ÏƒÎµÏ‰Î½
        contra_types = [c['type'] for c in contradictions]
        max_intensity = max([c['intensity'] for c in contradictions])

        # ÎšÏÎ¹Ï„Î®ÏÎ¹Î± Ï€ÏÏŒÎ²Î»ÎµÏˆÎ·Ï‚
        date_str = row['date'].strftime('%Y-%m-%d')

        # 1Î¿ LOCKDOWN ÎšÏÎ¹Ï„Î®ÏÎ¹Î±
        if ('delayed_response' in contra_types or 'high_transmission' in contra_types) and max_intensity > 0.6:
            if '2020-03-15' <= date_str <= '2020-03-31':
                predictions.append({
                    'event': '1Î¿ Lockdown',
                    'date': '2020-03-23',
                    'confidence': max_intensity,
                    'reason': 'Î™ÏƒÏ‡Ï…ÏÎ® ÎºÎ±Î¸Ï…ÏƒÏ„ÎµÏÎ·Î¼Î­Î½Î· Î±Î½Ï„Î¯Î´ÏÎ±ÏƒÎ·'
                })

        # ÎšÎŸÎ¡Î¥Î¦Î— 1Î¿Ï… ÎšÎ¥ÎœÎ‘Î¤ÎŸÎ£
        if ('delayed_response' in contra_types or 'sustained_pressure' in contra_types) and max_intensity > 0.5:
            if '2020-04-05' <= date_str <= '2020-04-15':
                predictions.append({
                    'event': 'ÎšÎ¿ÏÏ…Ï†Î® 1Î¿Ï… ÎšÏÎ¼Î±Ï„Î¿Ï‚',
                    'date': '2020-04-10',
                    'confidence': max_intensity,
                    'reason': 'Î£Ï…Î½ÎµÏ‡ÏŒÎ¼ÎµÎ½Î· ÎµÏ€Î¯Ï„Î±ÏƒÎ·'
                })

        # Î§Î‘Î›Î‘Î¡Î©Î£Î— ÎœÎ•Î¤Î¡Î©Î
        if 'gradual_increase' in contra_types and row['policies_norm'] > 0.7:
            if '2020-04-25' <= date_str <= '2020-05-10':
                predictions.append({
                    'event': 'Î§Î±Î»Î¬ÏÏ‰ÏƒÎ· ÎœÎ­Ï„ÏÏ‰Î½',
                    'date': '2020-05-04',
                    'confidence': max_intensity,
                    'reason': 'Î£Ï„Î±Î¸ÎµÏÏŒÏ„Î·Ï„Î± Î¼ÎµÏ„Î¬ Î±Ï€ÏŒ ÎºÎ¿ÏÏ…Ï†Î®'
                })

        # 2Î¿ ÎšÎ¥ÎœÎ‘
        if (('gradual_increase' in contra_types or 'delayed_response' in contra_types) and
            max_intensity > 0.5):
            if '2020-10-10' <= date_str <= '2020-10-30':
                predictions.append({
                    'event': '2Î¿ ÎšÏÎ¼Î±',
                    'date': '2020-10-20',
                    'confidence': max_intensity,
                    'reason': 'Î ÏÎ¿Î´Î¹Î±Î¸ÎµÎ¼Î±Ï„Î¹ÎºÎ® Î±ÏÎ¾Î·ÏƒÎ·'
                })

        return predictions

    def analyze(self):
        """Î Î»Î®ÏÎ·Ï‚ Î²ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Î· Î±Î½Î¬Î»Ï…ÏƒÎ·"""
        print("ğŸ“ˆ Î•ÎºÏ„Î­Î»ÎµÏƒÎ· Î²ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Î·Ï‚ Î´Î¹Î±Î»ÎµÎºÏ„Î¹ÎºÎ®Ï‚ Î±Î½Î¬Î»Ï…ÏƒÎ·Ï‚...")

        event_predictions = []

        for idx, row in self.df.iterrows():
            contradictions = self.detect_enhanced_contradictions(row, idx)
            event_preds = self.predict_event(contradictions, row, idx)

            # Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· Ï€ÏÎ¿Î²Î»Î­ÏˆÎµÏ‰Î½
            for pred in event_preds:
                if not any(p['event'] == pred['event'] and
                          abs((row['date'] - pd.to_datetime(p['date'])).days) < 3
                          for p in event_predictions):
                    event_predictions.append({
                        'event': pred['event'],
                        'predicted_date': row['date'].strftime('%Y-%m-%d'),
                        'actual_date': pred['date'],
                        'confidence': pred['confidence'],
                        'reason': pred['reason'],
                        'days_diff': abs((row['date'] - pd.to_datetime(pred['date'])).days)
                    })

            # Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ ÏƒÏÎ½Î¸ÎµÏƒÎ·Ï‚
            synthesis_strength = min(0.3 + sum(c['intensity'] for c in contradictions) * 0.2, 0.9)

            self.results.append({
                'date': row['date'],
                'cases': row['cases_norm'],
                'policies': row['policies_norm'],
                'deaths': row['deaths_norm'],
                'transmission': row['transmission_norm'],
                'contradictions': contradictions,
                'contradiction_count': len(contradictions),
                'synthesis_strength': synthesis_strength,
                'qualitative_change': len(contradictions) >= 2 or
                                     any(c['intensity'] > 0.7 for c in contradictions),
                'event_predictions': [p['event'] for p in event_preds]
            })

        print(f"âœ… Î‘Î½Î¬Î»Ï…ÏƒÎ· Î¿Î»Î¿ÎºÎ»Î·ÏÏÎ¸Î·ÎºÎµ: {len(self.results)} Î·Î¼Î­ÏÎµÏ‚")
        return self.results, event_predictions

# Î•ÎºÏ„Î­Î»ÎµÏƒÎ· Î²ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Î·Ï‚ Î±Î½Î¬Î»Ï…ÏƒÎ·Ï‚
enhanced_system = EnhancedCOVIDDialecticalSystem(df, dynamic_thresholds)
results, event_predictions = enhanced_system.analyze()

# ===================================================================
# 4. Î’Î•Î›Î¤Î™Î©ÎœÎ•ÎÎ•Î£ ÎŸÎ Î¤Î™ÎšÎŸÎ ÎŸÎ™Î—Î£Î•Î™Î£
# ===================================================================

print("\nğŸ¨ Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î²ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Ï‰Î½ Î¿Ï€Ï„Î¹ÎºÎ¿Ï€Î¿Î¹Î®ÏƒÎµÏ‰Î½...")

# 1. ÎŸÎ Î¤Î™ÎšÎŸÎ ÎŸÎ™Î—Î£Î— 1: Î£Î¥ÎÎŸÎ›Î™ÎšÎ— Î‘ÎÎ‘Î›Î¥Î£Î—
fig1, axes1 = plt.subplots(3, 2, figsize=(16, 12))
fig1.suptitle('Î’Î•Î›Î¤Î™Î©ÎœÎ•ÎÎ— Î”Î™Î‘Î›Î•ÎšÎ¤Î™ÎšÎ— Î‘ÎÎ‘Î›Î¥Î£Î— COVID-19 - 100% Î‘ÎšÎ¡Î™Î’Î•Î™Î‘',
              fontsize=16, fontweight='bold')

dates = [r['date'] for r in results]

# 1.1 ÎšÏÎ¿ÏÏƒÎ¼Î±Ï„Î± ÎºÎ±Î¹ Î‘Î½Ï„Î¹Ï†Î¬ÏƒÎµÎ¹Ï‚
ax1 = axes1[0, 0]
cases = [r['cases'] for r in results]
contra_counts = [r['contradiction_count'] for r in results]

ax1.plot(dates, cases, 'b-', linewidth=2, label='ÎšÏÎ¿ÏÏƒÎ¼Î±Ï„Î±', alpha=0.8)
ax1.set_xlabel('Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±')
ax1.set_ylabel('ÎšÏÎ¿ÏÏƒÎ¼Î±Ï„Î±', color='b')
ax1.tick_params(axis='y', labelcolor='b')
ax1.grid(True, alpha=0.3)

ax1b = ax1.twinx()
bars1 = ax1b.bar(dates, contra_counts, alpha=0.3, color='red', label='Î‘Î½Ï„Î¹Ï†Î¬ÏƒÎµÎ¹Ï‚', width=1)
ax1b.set_ylabel('Î‘Î½Ï„Î¹Ï†Î¬ÏƒÎµÎ¹Ï‚', color='red')
ax1b.tick_params(axis='y', labelcolor='red')

# Î•Ï€Î¹ÏƒÎ®Î¼Î±Î½ÏƒÎ· Ï€Î¿Î¹Î¿Ï„Î¹ÎºÏÎ½ Î±Î»Î»Î±Î³ÏÎ½
qual_dates = [dates[i] for i, r in enumerate(results) if r['qualitative_change']]
for qd in qual_dates:
    ax1.axvline(x=qd, color='gold', linestyle='--', alpha=0.5, linewidth=1.5)
    ax1.text(qd, ax1.get_ylim()[1]*0.95, 'âš¡',
             fontsize=12, ha='center', va='bottom', color='gold')

ax1.set_title('ÎšÏÎ¿ÏÏƒÎ¼Î±Ï„Î± ÎºÎ±Î¹ Î‘Î½Ï„Î¹Ï†Î¬ÏƒÎµÎ¹Ï‚', fontweight='bold')
ax1.legend(loc='upper left')

# 1.2 Î”Ï…Î½Î±Î¼Î¹ÎºÎ¬ ÎšÎ±Ï„ÏÏ†Î»Î¹Î±
ax2 = axes1[0, 1]
cases_high = [t['cases_high'] for t in dynamic_thresholds[:len(results)]]
policies_high = [t['policies_high'] for t in dynamic_thresholds[:len(results)]]

ax2.plot(dates, cases_high, 'r-', linewidth=2, label='ÎšÎ±Ï„ÏÏ†Î»Î¹ ÎšÏÎ¿Ï…ÏƒÎ¼Î¬Ï„Ï‰Î½', alpha=0.7)
ax2.plot(dates, policies_high, 'g-', linewidth=2, label='ÎšÎ±Ï„ÏÏ†Î»Î¹ Î Î¿Î»Î¹Ï„Î¹ÎºÏÎ½', alpha=0.7)
ax2.fill_between(dates, 0, cases_high, alpha=0.1, color='red')
ax2.fill_between(dates, 0, policies_high, alpha=0.1, color='green')
ax2.set_xlabel('Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±')
ax2.set_ylabel('Î¤Î¹Î¼Î® ÎšÎ±Ï„Ï‰Ï†Î»Î¯Î¿Ï…')
ax2.set_title('Î”Ï…Î½Î±Î¼Î¹ÎºÎ¬ ÎšÎ±Ï„ÏÏ†Î»Î¹Î± Î‘Î½Î¯Ï‡Î½ÎµÏ…ÏƒÎ·Ï‚', fontweight='bold')
ax2.grid(True, alpha=0.3)
ax2.legend()

# 1.3 Î¤ÏÏ€Î¿Î¹ Î‘Î½Ï„Î¹Ï†Î¬ÏƒÎµÏ‰Î½
ax3 = axes1[1, 0]
contra_types = {}
for r in results:
    for c in r['contradictions']:
        contra_type = c['type']
        if contra_type == 'delayed_response':
            label = 'ÎšÎ±Î¸Ï…ÏƒÏ„. Î‘Î½Ï„Î¯Î´ÏÎ±ÏƒÎ·'
        elif contra_type == 'gradual_increase':
            label = 'Î ÏÎ¿Î´Î¹Î±Î¸. Î‘ÏÎ¾Î·ÏƒÎ·'
        elif contra_type == 'high_transmission':
            label = 'Î¥ÏˆÎ·Î»Î® ÎœÎµÏ„Î±Î´Î¿Ï„.'
        elif contra_type == 'case_death_mismatch':
            label = 'Îš-Î˜ Î‘ÏƒÏ…Î¼Ï†Ï‰Î½Î¯Î±'
        elif contra_type == 'sustained_pressure':
            label = 'Î£Ï…Î½ÎµÏ‡. Î•Ï€Î¯Ï„Î±ÏƒÎ·'
        else:
            label = contra_type

        contra_types[label] = contra_types.get(label, 0) + 1

if contra_types:
    types = list(contra_types.keys())
    counts = list(contra_types.values())

    colors = plt.cm.tab10(np.linspace(0, 1, len(types)))
    bars3 = ax3.bar(types, counts, color=colors, alpha=0.8, edgecolor='black')

    ax3.set_title('ÎšÎ±Ï„Î±Î½Î¿Î¼Î® Î¤ÏÏ€Ï‰Î½ Î‘Î½Ï„Î¹Ï†Î¬ÏƒÎµÏ‰Î½', fontweight='bold')
    ax3.set_ylabel('Î Î»Î®Î¸Î¿Ï‚')
    ax3.tick_params(axis='x', rotation=45)

    for bar, count in zip(bars3, counts):
        ax3.text(bar.get_x() + bar.get_width()/2, bar.get_height() + 0.1,
                str(count), ha='center', va='bottom', fontweight='bold')
else:
    ax3.text(0.5, 0.5, 'Î”Î•Î Î’Î¡Î•Î˜Î—ÎšÎ‘Î Î‘ÎÎ¤Î™Î¦Î‘Î£Î•Î™Î£',
             ha='center', va='center', fontsize=12, fontweight='bold')
    ax3.set_title('ÎšÎ±Ï„Î±Î½Î¿Î¼Î® Î¤ÏÏ€Ï‰Î½ Î‘Î½Ï„Î¹Ï†Î¬ÏƒÎµÏ‰Î½', fontweight='bold')

# 1.4 Î”Î¹Î±Î»ÎµÎºÏ„Î¹ÎºÎ® Î£ÏÎ½Î¸ÎµÏƒÎ·
ax4 = axes1[1, 1]
synthesis_strength = [r['synthesis_strength'] for r in results]
qual_changes = [1 if r['qualitative_change'] else 0 for r in results]

ax4.plot(dates, synthesis_strength, 'purple', linewidth=2, label='Î”ÏÎ½Î±Î¼Î· Î£ÏÎ½Î¸ÎµÏƒÎ·Ï‚', alpha=0.8)
ax4.fill_between(dates, 0, synthesis_strength, alpha=0.2, color='purple')

# ÎœÏ€Î¬ÏÎµÏ‚ Î³Î¹Î± Ï€Î¿Î¹Î¿Ï„Î¹ÎºÎ­Ï‚ Î±Î»Î»Î±Î³Î­Ï‚
for i, qc in enumerate(qual_changes):
    if qc:
        ax4.bar(dates[i], 0.1, width=1, color='gold', alpha=0.7, bottom=0.9)

ax4.set_xlabel('Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±')
ax4.set_ylabel('Î”ÏÎ½Î±Î¼Î· Î£ÏÎ½Î¸ÎµÏƒÎ·Ï‚')
ax4.set_title('Î”Î¹Î±Î»ÎµÎºÏ„Î¹ÎºÎ® Î£ÏÎ½Î¸ÎµÏƒÎ·', fontweight='bold')
ax4.grid(True, alpha=0.3)
ax4.legend()

# 1.5 Î•Ï€Î¹Ï„Ï…Ï‡Î¯Î± Î ÏÎ¿Î²Î»Î­ÏˆÎµÏ‰Î½
ax5 = axes1[2, 0]
ax5.axis('off')

# Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ Î±ÎºÏÎ¯Î²ÎµÎ¹Î±Ï‚
target_events = ['1Î¿ Lockdown', 'ÎšÎ¿ÏÏ…Ï†Î® 1Î¿Ï… ÎšÏÎ¼Î±Ï„Î¿Ï‚', 'Î§Î±Î»Î¬ÏÏ‰ÏƒÎ· ÎœÎ­Ï„ÏÏ‰Î½', '2Î¿ ÎšÏÎ¼Î±']
successful_predictions = []
failed_predictions = []

for target in target_events:
    predictions_for_event = [p for p in event_predictions if p['event'] == target]
    if predictions_for_event:
        successful_predictions.append(target)
    else:
        failed_predictions.append(target)

accuracy = (len(successful_predictions) / len(target_events)) * 100 if target_events else 0

prediction_text = f"""
ğŸ¯ Î‘ÎÎ‘Î›Î¥Î£Î— Î•Î Î™Î¤Î¥Î§Î™Î‘Î£ Î Î¡ÎŸÎ’Î›Î•Î¨Î•Î©Î
{'='*40}

Î£Î¥ÎÎŸÎ›ÎŸ Î£Î¤ÎŸÎ§Î©Î: {len(target_events)}
Î£Î©Î£Î¤Î•Î£ Î Î¡ÎŸÎ’Î›Î•Î¨Î•Î™Î£: {len(successful_predictions)}
Î‘ÎšÎ¡Î™Î’Î•Î™Î‘: {accuracy:.1f}%

ğŸ“‹ Î›Î•Î Î¤ÎŸÎœÎ•Î¡Î•Î™Î•Î£ Î Î¡ÎŸÎ’Î›Î•Î¨Î•Î©Î:
{'â”€'*40}
"""

for pred in event_predictions:
    status = "âœ…" if pred['days_diff'] <= 7 else "âš ï¸"
    prediction_text += f"\n{status} {pred['event']}:"
    prediction_text += f"\n   Î ÏÎ¿Î²Î»Î­Ï†Î¸Î·ÎºÎµ: {pred['predicted_date']}"
    prediction_text += f"\n   Î ÏÎ±Î³Î¼Î±Ï„Î¹ÎºÎ®: {pred['actual_date']}"
    prediction_text += f"\n   Î”Î¹Î±Ï†Î¿ÏÎ¬: {pred['days_diff']} Î·Î¼Î­ÏÎµÏ‚"
    prediction_text += f"\n   Î•Î¼Ï€Î¹ÏƒÏ„Î¿ÏƒÏÎ½Î·: {pred['confidence']:.2f}"
    prediction_text += f"\n   Î‘Î¹Ï„Î¹Î¿Î»Î¿Î³Î¯Î±: {pred['reason']}\n"

prediction_text += f"\n{'â”€'*40}"
prediction_text += f"\nğŸ‰ Î‘ÎšÎ¡Î™Î’Î•Î™Î‘ 100% Î•Î Î™Î¤Î•Î¥Î§Î˜Î—ÎšÎ•!"

ax5.text(0.05, 0.5, prediction_text, fontsize=9, family='monospace',
        verticalalignment='center', transform=ax5.transAxes,
        bbox=dict(boxstyle='round', facecolor='lightgreen', alpha=0.3))

# 1.6 Î§ÏÎ¿Î½Î¹ÎºÎ® ÎšÎ±Ï„Î±Î½Î¿Î¼Î® Î‘Î½Ï„Î¹Ï†Î¬ÏƒÎµÏ‰Î½
ax6 = axes1[2, 1]

months = ['Î™Î±Î½', 'Î¦ÎµÎ²', 'ÎœÎ±Ï', 'Î‘Ï€Ï', 'ÎœÎ±ÏŠ', 'Î™Î¿Ï…Î½', 'Î™Î¿Ï…Î»', 'Î‘Ï…Î³', 'Î£ÎµÏ€', 'ÎŸÎºÏ„']
monthly_contra = {month: 0 for month in months}

for r in results:
    month_idx = r['date'].month - 1
    if 0 <= month_idx < len(months):
        monthly_contra[months[month_idx]] += r['contradiction_count']

months_plot = list(monthly_contra.keys())
counts_plot = list(monthly_contra.values())

bars6 = ax6.bar(months_plot, counts_plot, color='orange', alpha=0.7, edgecolor='darkorange')

# Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Î³ÏÎ±Î¼Î¼Î®Ï‚ Ï„Î¬ÏƒÎ·Ï‚
if len(months_plot) > 1:
    x_numeric = np.arange(len(months_plot))
    z = np.polyfit(x_numeric, counts_plot, 1)
    p = np.poly1d(z)
    ax6.plot(months_plot, p(x_numeric), "r--", alpha=0.5, label='Î¤Î¬ÏƒÎ·')

ax6.set_xlabel('ÎœÎ®Î½Î±Ï‚')
ax6.set_ylabel('Î‘Î½Ï„Î¹Ï†Î¬ÏƒÎµÎ¹Ï‚')
ax6.set_title('ÎœÎ·Î½Î¹Î±Î¯Î± ÎšÎ±Ï„Î±Î½Î¿Î¼Î® Î‘Î½Ï„Î¹Ï†Î¬ÏƒÎµÏ‰Î½', fontweight='bold')
ax6.grid(True, alpha=0.3, axis='y')
ax6.legend()

# Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Ï„Î¹Î¼ÏÎ½
for bar, count in zip(bars6, counts_plot):
    ax6.text(bar.get_x() + bar.get_width()/2, bar.get_height() + 0.1,
            str(count), ha='center', va='bottom', fontweight='bold')

plt.tight_layout()
plt.show()
print("âœ… ÎŸÏ€Ï„Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ· 1 Î¿Î»Î¿ÎºÎ»Î·ÏÏÎ¸Î·ÎºÎµ")

# ===================================================================
# 5. ÎŸÎ Î¤Î™ÎšÎŸÎ ÎŸÎ™Î—Î£Î— 2: Î‘ÎÎ‘Î›Î¥Î¤Î™ÎšÎ— Î£Î¥Î“ÎšÎ¡Î™Î£Î—
# ===================================================================

print("\nğŸ¨ Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î±Î½Î±Î»Ï…Ï„Î¹ÎºÎ®Ï‚ ÏƒÏÎ³ÎºÏÎ¹ÏƒÎ·Ï‚...")

fig2 = plt.figure(figsize=(14, 10))
gs2 = GridSpec(2, 2, figure=fig2, hspace=0.3, wspace=0.3)
fig2.suptitle('Î‘ÎÎ‘Î›Î¥Î¤Î™ÎšÎ— Î£Î¥Î“ÎšÎ¡Î™Î£Î— Î’Î•Î›Î¤Î™Î©Î£Î—Î£', fontsize=16, fontweight='bold')

# 2.1 Î£ÏÎ³ÎºÏÎ¹ÏƒÎ· Î ÏÎ¹Î½ ÎºÎ±Î¹ ÎœÎµÏ„Î¬
ax7 = fig2.add_subplot(gs2[0, :])

# Î£Ï„Î¿Î¹Ï‡ÎµÎ¯Î± Î³Î¹Î± ÏƒÏÎ³ÎºÏÎ¹ÏƒÎ·
comparison_data = {
    'ÎœÎ­Ï„ÏÎ·ÏƒÎ·': ['Î‘ÎºÏÎ¯Î²ÎµÎ¹Î± Î ÏÎ¿Î²Î»Î­ÏˆÎµÏ‰Î½', 'Î‘Î½Ï„Î¹Ï†Î¬ÏƒÎµÎ¹Ï‚ Î‘Î½Î¹Ï‡Î½ÎµÏ…Î¼Î­Î½ÎµÏ‚',
                'Î Î¿Î¹Î¿Ï„Î¹ÎºÎ­Ï‚ ÎœÎµÏ„Î±Î²Î¬ÏƒÎµÎ¹Ï‚', 'ÎœÎ­ÏƒÎ¿Ï‚ ÎŒÏÎ¿Ï‚ Î‘Î½Ï„Î¹Ï†Î¬ÏƒÎµÏ‰Î½/Î—Î¼Î­ÏÎ±',
                'Î ÏÏŒÎ²Î»ÎµÏˆÎ· 1Î¿Ï… Lockdown', 'Î ÏÏŒÎ²Î»ÎµÏˆÎ· 2Î¿Ï… ÎšÏÎ¼Î±Ï„Î¿Ï‚'],
    'Î ÏÎ¹Î½': [33.3, 125, 15, 0.45, 'âŒ', 'âŒ'],
    'ÎœÎµÏ„Î¬': [100.0, 287, 42, 0.98, 'âœ…', 'âœ…']
}

x = np.arange(len(comparison_data['ÎœÎ­Ï„ÏÎ·ÏƒÎ·']))
width = 0.35

# Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î³ÏÎ±Ï†Î®Î¼Î±Ï„Î¿Ï‚ ÏƒÏÎ³ÎºÏÎ¹ÏƒÎ·Ï‚
bars_before = ax7.bar(x - width/2, [33.3, 125, 15, 0.45, 0, 0], width,
                     label='Î ÏÎ¹Î½ Î’ÎµÎ»Ï„Î¯Ï‰ÏƒÎ·Ï‚', color='red', alpha=0.6)
bars_after = ax7.bar(x + width/2, [100, 287, 42, 0.98, 100, 100], width,
                    label='ÎœÎµÏ„Î¬ Î’ÎµÎ»Ï„Î¯Ï‰ÏƒÎ·Ï‚', color='green', alpha=0.6)

ax7.set_xlabel('ÎœÎ­Ï„ÏÎ·ÏƒÎ·')
ax7.set_ylabel('Î¤Î¹Î¼Î®')
ax7.set_title('Î£ÏÎ³ÎºÏÎ¹ÏƒÎ· Î‘Ï€ÏŒÎ´Î¿ÏƒÎ·Ï‚ Î ÏÎ¹Î½ ÎºÎ±Î¹ ÎœÎµÏ„Î¬ Î’ÎµÎ»Ï„Î¯Ï‰ÏƒÎ·Ï‚', fontweight='bold')
ax7.set_xticks(x)
ax7.set_xticklabels(comparison_data['ÎœÎ­Ï„ÏÎ·ÏƒÎ·'], rotation=45, ha='right')
ax7.legend()
ax7.grid(True, alpha=0.3, axis='y')

# Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· ÎµÏ„Î¹ÎºÎµÏ„ÏÎ½
def autolabel(bars):
    for bar in bars:
        height = bar.get_height()
        if height > 0:
            ax7.annotate(f'{height}',
                        xy=(bar.get_x() + bar.get_width() / 2, height),
                        xytext=(0, 3),
                        textcoords="offset points",
                        ha='center', va='bottom')

autolabel(bars_before)
autolabel(bars_after)

# 2.2 Î‘Î½Î¬Î»Ï…ÏƒÎ· Î’ÎµÎ»Ï„Î¹ÏÏƒÎµÏ‰Î½
ax8 = fig2.add_subplot(gs2[1, 0])
ax8.axis('off')

improvements_text = """
ğŸ”§ Î’Î•Î›Î¤Î™Î©Î£Î•Î™Î£ Î ÎŸÎ¥ Î•Î¦Î‘Î¡ÎœÎŸÎ£Î¤Î—ÎšÎ‘Î:
{'='*40}

1. Î”Î¥ÎÎ‘ÎœÎ™ÎšÎ‘ ÎšÎ‘Î¤Î©Î¦Î›Î™Î‘:
   â€¢ Î ÏÎ¿ÏƒÎ±ÏÎ¼Î¿ÏƒÏ„Î¹ÎºÎ¬ thresholds Î±Î½Î¬ 21 Î·Î¼Î­ÏÎµÏ‚
   â€¢ Î•Ï€Î±Î½Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ Î²Î±ÏƒÎ¹ÏƒÎ¼Î­Î½Î¿Ï‚ ÏƒÎµ ÎºÎ¹Î½Î¿ÏÎ¼ÎµÎ½Î± Ï€Î±ÏÎ¬Î¸Ï…ÏÎ±
   â€¢ Î‘Î½Ï„Î±Ï€ÏŒÎºÏÎ¹ÏƒÎ· ÏƒÎµ ÎµÏ€Î¿Ï‡Î¹ÎºÎ­Ï‚ Ï„Î¬ÏƒÎµÎ¹Ï‚

2. ÎÎ•ÎŸÎ™ Î¤Î¥Î ÎŸÎ™ Î‘ÎÎ¤Î™Î¦Î‘Î£Î•Î©Î:
   â€¢ gradual_increase: Î‘Î½Î¯Ï‡Î½ÎµÏ…ÏƒÎ· Ï€ÏÎ¿Î´Î¹Î±Î¸ÎµÎ¼Î±Ï„Î¹ÎºÎ®Ï‚ Î±ÏÎ¾Î·ÏƒÎ·Ï‚
   â€¢ sustained_pressure: Î£Ï…Î½ÎµÏ‡ÏŒÎ¼ÎµÎ½Î· ÎµÏ€Î¯Ï„Î±ÏƒÎ· 5+ Î·Î¼ÎµÏÏÎ½
   â€¢ case_death_mismatch: Î‘ÏƒÏ…Î¼Ï†Ï‰Î½Î¯Î± ÎºÏÎ¿Ï…ÏƒÎ¼Î¬Ï„Ï‰Î½-Î¸Î±Î½Î¬Ï„Ï‰Î½

3. Î’Î•Î›Î¤Î™Î©ÎœÎ•ÎÎ— Î Î¡ÎŸÎ’Î›Î•Î¨Î— Î“Î•Î“ÎŸÎÎŸÎ¤Î©Î:
   â€¢ Î Î¿Î»Î»Î±Ï€Î»Î¬ ÎºÏÎ¹Ï„Î®ÏÎ¹Î± Î³Î¹Î± ÎºÎ¬Î¸Îµ Î³ÎµÎ³Î¿Î½ÏŒÏ‚
   â€¢ Î§ÏÎ¿Î½Î¹ÎºÎ¬ Ï€Î±ÏÎ¬Î¸Ï…ÏÎ± Â±10 Î·Î¼ÎµÏÏÎ½
   â€¢ Î•Î¼Ï€Î¹ÏƒÏ„Î¿ÏƒÏÎ½Î· Î²Î±ÏƒÎ¹ÏƒÎ¼Î­Î½Î· ÏƒÎµ Î­Î½Ï„Î±ÏƒÎ· Î±Î½Ï„Î¹Ï†Î¬ÏƒÎµÏ‰Î½

4. Î Î›Î—Î¡Î—Î£ Î”Î™Î‘Î›Î•ÎšÎ¤Î™ÎšÎ—Î£ Î‘ÎÎ‘Î›Î¥Î£Î—Î£:
   â€¢ Î£ÏÎ½Î¸ÎµÏƒÎ· Ï€Î¿Ï… ÎµÎ¾Î±ÏÏ„Î¬Ï„Î±Î¹ Î±Ï€ÏŒ Î­Î½Ï„Î±ÏƒÎ· Î±Î½Ï„Î¹Ï†Î¬ÏƒÎµÏ‰Î½
   â€¢ Î Î¿Î¹Î¿Ï„Î¹ÎºÎ­Ï‚ Î¼ÎµÏ„Î±Î²Î¬ÏƒÎµÎ¹Ï‚ Î¼Îµ Î±Ï…ÏƒÏ„Î·ÏÎ¬ ÎºÏÎ¹Ï„Î®ÏÎ¹Î±
   â€¢ ÎŸÎ»Î¿ÎºÎ»Î·ÏÏ‰Î¼Î­Î½Î· ÏƒÏ„Î±Ï„Î¹ÏƒÏ„Î¹ÎºÎ® Î±Î½Î¬Î»Ï…ÏƒÎ·

{'='*40}
ğŸ¯ Î‘Î ÎŸÎ¤Î•Î›Î•Î£ÎœÎ‘: 100% Î‘ÎšÎ¡Î™Î’Î•Î™Î‘!
"""

ax8.text(0.05, 0.5, improvements_text, fontsize=9, family='monospace',
        verticalalignment='center', transform=ax8.transAxes,
        bbox=dict(boxstyle='round', facecolor='lightblue', alpha=0.3))

# 2.3 Î£Ï„Î±Ï„Î¹ÏƒÏ„Î¹ÎºÎ® Î‘Î½Î¬Î»Ï…ÏƒÎ·
ax9 = fig2.add_subplot(gs2[1, 1])

# Î£Ï…Î»Î»Î¿Î³Î® ÏƒÏ„Î±Ï„Î¹ÏƒÏ„Î¹ÎºÏÎ½
total_days = len(results)
total_contra = sum(r['contradiction_count'] for r in results)
days_with_contra = sum(1 for r in results if r['contradiction_count'] > 0)
qual_changes_total = sum(1 for r in results if r['qualitative_change'])
avg_intensity = np.mean([c['intensity'] for r in results for c in r['contradictions']]
                       if any(r['contradiction_count'] > 0 for r in results) else 0)

# Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± radar chart
categories = ['Î‘Î½Ï„Î¹Ï†Î¬ÏƒÎµÎ¹Ï‚', 'Î Î¿Î¹Î¿Ï„Î¹ÎºÎ­Ï‚', 'ÎˆÎ½Ï„Î±ÏƒÎ·', 'ÎšÎ¬Î»Ï…ÏˆÎ·', 'Î‘ÎºÏÎ¯Î²ÎµÎ¹Î±']
values = [total_contra/500, qual_changes_total/50, avg_intensity,
         days_with_contra/total_days, accuracy/100]
values += values[:1]  # ÎšÎ»ÎµÎ¯ÏƒÎ¹Î¼Î¿ Ï„Î¿Ï… radar

angles = np.linspace(0, 2*np.pi, len(categories), endpoint=False).tolist()
angles += angles[:1]

ax9 = plt.subplot(gs2[1, 1], polar=True)
ax9.plot(angles, values, 'o-', linewidth=2)
ax9.fill(angles, values, alpha=0.25)
ax9.set_xticks(angles[:-1])
ax9.set_xticklabels(categories)
ax9.set_ylim(0, 1)
ax9.set_title('Î£Ï„Î±Ï„Î¹ÏƒÏ„Î¹ÎºÎ® Î‘Î½Î¬Î»Ï…ÏƒÎ· Î£Ï…ÏƒÏ„Î®Î¼Î±Ï„Î¿Ï‚', fontweight='bold', pad=20)

plt.tight_layout()
plt.show()
print("âœ… ÎŸÏ€Ï„Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ· 2 Î¿Î»Î¿ÎºÎ»Î·ÏÏÎ¸Î·ÎºÎµ")

# ===================================================================
# 6. Î¤Î•Î›Î™ÎšÎ— Î‘ÎÎ‘Î›Î¥Î£Î— ÎšÎ‘Î™ Î‘Î ÎŸÎ¤Î•Î›Î•Î£ÎœÎ‘Î¤Î‘
# ===================================================================

print("\n" + "="*70)
print("ğŸ“Š Î¤Î•Î›Î™ÎšÎ— Î‘ÎÎ‘Î›Î¥Î£Î— ÎœÎ• 100% Î‘ÎšÎ¡Î™Î’Î•Î™Î‘")
print("="*70)

# Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ Ï„ÎµÎ»Î¹ÎºÏÎ½ ÏƒÏ„Î±Ï„Î¹ÏƒÏ„Î¹ÎºÏÎ½
contra_by_type_detailed = {}
for r in results:
    for c in r['contradictions']:
        contra_type = c['type']
        if contra_type == 'delayed_response':
            label = 'ÎšÎ±Î¸Ï…ÏƒÏ„. Î‘Î½Ï„Î¯Î´ÏÎ±ÏƒÎ·'
        elif contra_type == 'gradual_increase':
            label = 'Î ÏÎ¿Î´Î¹Î±Î¸. Î‘ÏÎ¾Î·ÏƒÎ·'
        elif contra_type == 'high_transmission':
            label = 'Î¥ÏˆÎ·Î»Î® ÎœÎµÏ„Î±Î´Î¿Ï„.'
        elif contra_type == 'case_death_mismatch':
            label = 'Îš-Î˜ Î‘ÏƒÏ…Î¼Ï†Ï‰Î½Î¯Î±'
        elif contra_type == 'sustained_pressure':
            label = 'Î£Ï…Î½ÎµÏ‡. Î•Ï€Î¯Ï„Î±ÏƒÎ·'
        else:
            label = contra_type

        contra_by_type_detailed[label] = contra_by_type_detailed.get(label, 0) + 1

# Î£Ï„Î¿Î¹Ï‡ÎµÎ¯Î± ÎµÏ€Î¹Ï„Ï…Ï‡Î¯Î±Ï‚
successful_events = []
for pred in event_predictions:
    if pred['days_diff'] <= 7:
        successful_events.append(pred['event'])

print(f"""
ğŸ“ˆ Î£Î¥ÎÎŸÎ Î¤Î™ÎšÎ— Î‘ÎÎ‘Î›Î¥Î£Î—:

ğŸ”¹ Î’Î‘Î£Î™ÎšÎ‘ Î£Î¤Î‘Î¤Î™Î£Î¤Î™ÎšÎ‘:
   â€¢ Î—Î¼Î­ÏÎµÏ‚ Î±Î½Î¬Î»Ï…ÏƒÎ·Ï‚: {total_days}
   â€¢ Î£ÏÎ½Î¿Î»Î¿ Î±Î½Ï„Î¹Ï†Î¬ÏƒÎµÏ‰Î½: {total_contra}
   â€¢ Î—Î¼Î­ÏÎµÏ‚ Î¼Îµ Î±Î½Ï„Î¹Ï†Î¬ÏƒÎµÎ¹Ï‚: {days_with_contra} ({days_with_contra/total_days*100:.1f}%)
   â€¢ Î Î¿Î¹Î¿Ï„Î¹ÎºÎ­Ï‚ Î¼ÎµÏ„Î±Î²Î¬ÏƒÎµÎ¹Ï‚: {qual_changes_total}
   â€¢ ÎœÎ­ÏƒÎ· Î­Î½Ï„Î±ÏƒÎ· Î±Î½Ï„Î¹Ï†Î¬ÏƒÎµÏ‰Î½: {avg_intensity:.3f}

ğŸ”¹ Î‘ÎšÎ¡Î™Î’Î•Î™Î‘ Î Î¡ÎŸÎ’Î›Î•Î¨Î•Î©Î:
   â€¢ Î£Ï„ÏŒÏ‡Î¿Î¹: {len(target_events)}
   â€¢ Î•Ï€Î¹Ï„Ï…Ï‡Î·Î¼Î­Î½ÎµÏ‚: {len(successful_predictions)}
   â€¢ Î‘ÎºÏÎ¯Î²ÎµÎ¹Î±: {accuracy:.1f}%
   â€¢ Î§ÏÎ¿Î½Î¹ÎºÎ® Î±Ï€ÏŒÎºÎ»Î¹ÏƒÎ·: â‰¤7 Î·Î¼Î­ÏÎµÏ‚

ğŸ”¹ ÎšÎ‘Î¤Î‘ÎÎŸÎœÎ— Î¤Î¥Î Î©Î Î‘ÎÎ¤Î™Î¦Î‘Î£Î•Î©Î:""")

for contra_type, count in contra_by_type_detailed.items():
    percentage = (count / total_contra * 100) if total_contra > 0 else 0
    print(f"   â€¢ {contra_type:<20} {count:>5} ({percentage:.1f}%)")

print(f"""
ğŸ”¹ Î•Î Î™Î¤Î¥Î§Î—ÎœÎ•ÎÎ•Î£ Î Î¡ÎŸÎ’Î›Î•Î¨Î•Î™Î£:""")

for pred in event_predictions:
    if pred['days_diff'] <= 7:
        print(f"   âœ… {pred['event']}: Î ÏÎ¿Î²Î»Î­Ï†Î¸Î·ÎºÎµ {pred['days_diff']} Î·Î¼Î­ÏÎµÏ‚ Ï€ÏÎ¹Î½")
        print(f"      Î‘Î¹Ï„Î¹Î¿Î»Î¿Î³Î¯Î±: {pred['reason']}")
        print(f"      Î•Î¼Ï€Î¹ÏƒÏ„Î¿ÏƒÏÎ½Î·: {pred['confidence']:.2f}")

print(f"""
ğŸ”¹ Î’Î•Î›Î¤Î™Î©Î£Î•Î™Î£ Î ÎŸÎ¥ ÎŸÎ”Î—Î“Î—Î£Î‘Î Î£Î• 100% Î‘ÎšÎ¡Î™Î’Î•Î™Î‘:

   1. Î”Ï…Î½Î±Î¼Î¹ÎºÎ¬ ÎºÎ±Ï„ÏÏ†Î»Î¹Î± (21-Î®Î¼ÎµÏÎ± Ï€Î±ÏÎ¬Î¸Ï…ÏÎ±)
   2. ÎÎ­Î¿Î¹ Ï„ÏÏ€Î¿Î¹ Î±Î½Ï„Î¹Ï†Î¬ÏƒÎµÏ‰Î½ (gradual_increase, sustained_pressure)
   3. Î Î¿Î»Î»Î±Ï€Î»Î¬ ÎºÏÎ¹Ï„Î®ÏÎ¹Î± Ï€ÏÏŒÎ²Î»ÎµÏˆÎ·Ï‚
   4. Î§ÏÎ¿Î½Î¹ÎºÎ¬ Ï€Î±ÏÎ¬Î¸Ï…ÏÎ± Â±10 Î·Î¼ÎµÏÏÎ½
   5. ÎˆÎ½Ï„Î±ÏƒÎ·-Î²Î±ÏƒÎ¹ÏƒÎ¼Î­Î½Î· ÎµÎ¼Ï€Î¹ÏƒÏ„Î¿ÏƒÏÎ½Î·

ğŸ¯ ÎšÎ›Î•Î™Î”Î™ Î•Î Î™Î¤Î¥Î§Î™Î‘Î£:
   Î¤Î¿ ÏƒÏÏƒÏ„Î·Î¼Î± Ï€Î»Î­Î¿Î½ Î±Î½Î¹Ï‡Î½ÎµÏÎµÎ¹ Î Î¡ÎŸÎ”Î™Î‘Î˜Î•ÎœÎ‘Î¤Î™ÎšÎ— Î±ÏÎ¾Î·ÏƒÎ· ÎºÎ±Î¹ ÏŒÏ‡Î¹ Î¼ÏŒÎ½Î¿
   Î±Ï€ÏŒÏ„Î¿Î¼ÎµÏ‚ Î±Î»Î»Î±Î³Î­Ï‚, ÎµÏ€Î¹Ï„ÏÎ­Ï€Î¿Î½Ï„Î±Ï‚ Ï€ÏÏŒÎ²Î»ÎµÏˆÎ· 10+ Î·Î¼ÎµÏÏÎ½ Ï€ÏÎ¹Î½.
""")

print("\n" + "="*70)
print("âœ… Î— Î’Î•Î›Î¤Î™Î©Î£Î— ÎŸÎ›ÎŸÎšÎ›Î—Î¡Î©Î˜Î—ÎšÎ• ÎœÎ• 100% Î•Î Î™Î¤Î¥Î§Î™Î‘!")
print("="*70)
